<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title> glyphr </title>	
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAEBSURBVDhPY/RbdPM/AwWACUqTDbC6IEpdkEFTkotBT5YbzL/0+CvD9effGJbdfA/mIwMMA5odpOEa67c9BtONXrJgGmRQ7YGnYDYMoBgAsjncTBSs8cLb71BRCDAQ5gQbtPLUaxSXoIQBSDNIAbpmEACJgeRAapABxYGIYgDMBpBz0QFIDN12EEAxAOQ3UECB/LoxVg2sCYRBbJj/0QELlIaDtZffgaMMFI3IoQ8Su/bmB5iPDFAMANkEA/6Lb0FZCACKJXSA4gWQTSBnYtMMCxeQGmSA4gKY0zdCoxPmZC0RDnAAwryCDDBSIsimYF0hMBs5KYMAKHzQ08hA50YGBgDfrn7dJSRJxAAAAABJRU5ErkJggg==">
	<style>
*{margin:0;padding:0;font-family:tahoma,verdana,sans-serif;font-size:14px;font-weight:400;z-index:0;text-align:left;color:#33383d}body{background-color:#00aae1;overflow:hidden}input{border:none;padding:4px;text-align:left}input[type=file],input[type=text],textarea{background-color:#fff;color:#191e23;border:1px solid #e5eaef}input[type=text][disabled=disabled]{background-color:#e5eaef;border:1px solid #e5eaef;color:#7f8689}input[type=radio]{margin-bottom:6px}a{color:#00aae1;text-decoration:none}a:hover{text-decoration:underline}p{display:block}h1{margin-left:0;color:#ccd1d6;font-size:2em;clear:right;text-transform:uppercase}h2{color:#666b70;display:inline;font-size:1.6em;padding:0 1em 0 0;margin:0 0 .2em;text-transform:lowercase}h3{color:#666b70;font-size:1.3em;padding:0 1em .4em 0;text-transform:lowercase}td{vertical-align:top}ul{margin-left:20px;margin-bottom:8px}li{margin-top:8px}table{border-collapse:collapse}.button,.buttondis,.buttonsel{padding:10px 8px;margin:1px;cursor:pointer}.button,.button:active,.button:link{background-color:#4c5156;color:#ccd1d6}.button:hover{color:#e5eaef}.buttonsel,.buttonsel:hover{background-color:#00aae1;color:#a5def0}.buttonsel:hover{color:#fafcff}.buttondis{background-color:#4c5156;color:#33383d;cursor:default}.spinnerbutton,.spinnerbutton:active{height:22px;width:20px;font-size:15px;text-align:center;padding:0;vertical-align:4px;font-weight:700;margin:0;background-color:#999ea3}.spinnerbutton:hover{color:#fff}#navprimarypane{display:block;position:absolute;top:0;left:0;width:70px;height:100%;background-color:#ccd1d6;padding:0}#navtargetpane{display:block;position:absolute;top:0;left:70px;width:400px;height:100%;padding:0 10px;background-color:#e5eaef;overflow-y:scroll;overflow-x:hidden}#navtargetpane a{color:#33383d}#mainwrapper{width:100%;height:100%;overflow-x:hidden;overflow-y:hidden;position:absolute;top:0;left:0;background-color:#fafcff}#mainpane{margin-left:470px}.primarynavbutton{height:50px;width:50px;margin-left:5px;border-left:5px solid transparent;margin-top:10px;cursor:pointer}#navtargetpane h1{color:#ccd1d6;font-weight:400;margin:10px 0}#pnsaveout{width:100%;overflow-x:hidden;overflow-y:scroll;height:400px}#logocanvas{background-color:transparent;margin:2px 0 0 2px;border:0;position:fixed;right:15px;bottom:40px;z-index:999}#npSaveout{height:800px;width:100%}.pagecontent{margin:10px 20px 100px 40px}.textpage{width:700px}.pagecontent h1,.pagecontent h2,.pagecontent h3{display:block;text-transform:none;margin-bottom:0}.pagecontent h1{margin-top:30px;margin-bottom:10px}.pagecontent>h1:first-child{margin-top:0}.pagecontent h2{margin-top:20px}.pagecontent h3{margin-top:16px}.btt{font-style:normal;margin-left:20px}.pagecontent br{height:15px;display:block}.pagecontent input[type=text]{margin:6px 3px 2px 0;padding-left:10px}.pagecontent p{margin-top:8px}.charselectarea{width:100%}.charselectbuttonwrapper{display:inline;float:left;height:49px;width:49px;cursor:pointer;background-color:#fafcff;margin:0 5px 5px 0}.charselectcanvas{height:50px;width:50px}.charselectcanvassel{background-color:#00aae1}.charselectbutton,.charselectbuttonsel{width:100%;height:100%;text-align:center;color:#ccd1d6;font-size:25px;overflow:hidden;padding-top:10px}.charselectbuttonsel{background-color:#00aae1}.unit{font-size:10px;color:#7f8689;padding-left:4px}.navtargetbutton,.navtargetbuttonsel{font-size:1.5em;display:block;text-transform:lowercase;font-weight:lighter;padding:4px 2px 4px 0;background-color:transparent;cursor:pointer}.navtargetbutton:hover{padding:4px 0 4px 2px}.navtargetbuttonsel{color:#00aae1}#dialog_bg{display:none;position:absolute;top:0;left:0;width:100%;height:100%;text-align:center;background-color:#4c5156;z-index:1001;-moz-opacity:.8;opacity:.8;filter:alpha(opacity=80)}#dialog_box{display:none;position:absolute;top:100px;left:100px;height:auto;width:auto;background-color:#ccd1d6;z-index:1002;overflow:auto}.dialogCloseButton{width:20px;height:25px;color:#e5eaef;background-color:#00aae1;font-size:24px;font-weight:700;text-align:center;padding:0;cursor:pointer;border-radius:0}#dialogLeftBar{width:20px;vertical-align:top;background-color:#00aae1}#dialogRightContent{padding:10px 20px 20px;color:#191e23}#dialogRightContent h1{margin-bottom:10px}#dialogRightContent td{color:#191e23}#dialogRightContent input{background-color:#191e23;color:#ccd1d6;margin:1px;cursor:pointer;padding:4px 12px}#dialogRightContent .subnavunit{margin:10px 0 0;width:400px;padding:0}#dialogRightContent h1,#dialogRightContent h2,#dialogRightContent h3{color:#4c5156}.splashscreen{text-align:center;width:800px;margin:0 auto}.splashver{position:relative;top:-200px;left:167px;width:466px;margin-bottom:-70px;font-size:.8em;color:#fff}.splashver a{font-size:.9em;color:#fff;text-decoration:underline}#splashscreencanvas{position:relative;top:0;left:0}#newprojectname{width:98%;height:25px;margin:10px 0 0;color:#33383d;display:block}#droptarget{width:90%;height:72px;margin:7px 0 20px;background-color:#fff;border:1px dashed #7f8689;color:#00aae1;padding:20px}.charedittable{width:600px;height:100%;position:fixed;left:0;top:40px;background-color:transparent;z-index:10}#ishereghostcanvas{display:none}.ssthumb{border:3px solid #ccd1d6;cursor:pointer}.ssthumb:hover{border:3px solid #00aae1}#toolsarea{position:fixed;left:500px;top:10px;z-index:10}#toolsarea div{margin-right:0}.tool{height:24px;width:24px;overflow:visible;padding:4px 0 0 4px;margin-right:0;display:inline;float:left}.out{background-color:#ccd1d6;color:#33383d;padding:4px 0 0 6px;margin:1px 0 0 1px;width:70px}.tool canvas{margin:0 4px}.layertable{width:100%}.layer,.layersel{width:100%;border-bottom:6px solid #e5eaef;background-color:#b2b7bc;height:50px;margin-bottom:-10px;cursor:pointer}.layer .layername{color:#fafcff}.layersel .layername{background-color:#00aae1;color:#a5def0}.layername{padding:6px 0 6px 10px;height:45px;text-align:left;font-size:24px}.layernote{font-size:.4em;color:#fff;display:block;margin-top:4px;clear:both}.layerthumb{height:50px;width:50px;background-color:#fafcff}.layerthumb canvas{height:50px;width:50px}.detail{width:380px}.detail td{margin:10px 10px 0;padding:5px 10px 0 0;vertical-align:top}.detail h3{padding:0}.detail input[type=text]{padding:0 .4em;display:inline;width:140px;height:20px;vertical-align:top;border:1px solid #fff}.detail input[type=text][disabled=disabled]{background-color:#ccd1d6;border:1px solid #ccd1d6;color:#4c5156}.detail .rightcol{width:200px}.detail .leftcol{width:11px;padding:10px 0 0;margin:0;overflow:hidden}.detail .leftcol canvas{position:relative;top:-3px}.canvasbutton{padding-right:6px;cursor:pointer}.actionsgrid{padding:0 10px 30px 5px;width:380px}.actionsgrid td{width:33%}.actionsgrid h3{margin-top:10px}.actionsgrid input{width:123px;text-transform:lowercase}.metadata h3{margin-top:30px}.opentypepropertiestable{width:100%}.propname{padding:4px 0 0;width:20%}.opentypepropertiestable input[type=text]{width:100%;margin:0 0 10px 20px}.fontmetricstable td{padding:0 10px 0 0;vertical-align:middle}.fontmetricstable .spinnerbutton{height:28px;position:relative;top:4px;left:-4px}#genoutput{font-family:monospace}#tdcanvas{background-color:#fff}#tdtextarea{width:795px;height:150px;padding:2px 0 0 5px;border:0;background-color:#ccd1d6;overflow:hidden;margin:1px 0 10px;font-size:2em}#roughptsize{padding-left:6px}.ssthumbcontainer{width:100%;overflow-y:auto;overflow-x:hidden}.ssthumbcontainer table{margin:0 10px 30px 0;display:inline;float:left;text-transform:none}.ssthumbcontainer canvas{background-color:#fff}.ssusedinthumb{border-bottom:3px solid transparent}.ssusedinthumb:hover{cursor:pointer;border-bottom:3px solid #00aae1}
	</style>

	<script>
var _UI={navhere:"firstrun",navprimaryhere:"npChar",thisGlyphrStudioVersion:"Beta 3 - 0.3.1.min",projectsaved:true,colors:{accent:"rgb(0,170,225)",accent_light:"rgb(165,222,240)",offwhite:"rgb(250,252,255)",g9:"rgb(229,234,239)",g8:"rgb(204,209,214)",g7:"rgb(178,183,188)",g6:"rgb(153,158,163)",g5:"rgb(127,134,137)",g4:"rgb(102,107,112)",g3:"rgb(76,81,86)",g2:"rgb(51,56,61)",g1:"rgb(25,30,35)"},selectedtool:"pathedit",redrawing:false,thumbsize:50,thumbgutter:5,showgrid:true,showguides:true,clipboardshape:false,chareditcanvas:false,chareditcanvassize:1600,chareditctx:false,ishereghostcanvas:false,ishereghostctx:false,defaultview:{dx:200,dy:500,dz:.5},views:{},thumbview:{},shownlinkedshape:"id0",linkedshapecurrstate:{},linkedshapeundoq:[],selectedchar:97,selectedshape:-1,charundoq:[],charcurrstate:{},selectchardrawarr:[],shapelayers:[],debugpoints:[false,false],locid:0,locarr:[],checkid:0,checkarr:[],testdrivectx:false,testdrivecanvas:false,testdrive_fontscale:0,testdrive_showcharbox:false,testdrive_showhorizontals:false,testdrive_padsize:10,fontmetrics:{xmax:0,xmin:0,ymax:0,ymin:0,hhea_ascent:0,hhea_descent:0},default_GP:{projectsettings:{name:"My Font",debug:true,version:0,linkedshapecounter:0,upm:1e3,ascent:700,linegap:250,griddivisions:10,xheight:400,overshoot:10,defaultlsb:10,pointsize:5,spinnervaluechange:1,stoppagenavigation:false,quickpathupdating:false,showoutline:false,showfill:true,color_glyphfill:"rgb(0,0,0)",color_glyphoutline:"rgb(0,0,0)",color_grid:"rgb(240,240,240)",color_guideline:"rgb(204,79,34)"},fontchars:[],linkedshapes:{},opentypeproperties:{head:[{key:"created",val:""},{key:"fontRevision",val:"1.0"}],os_2:[{key:"usWeightClass",val:"500"},{key:"usWidthClass",val:"5"}],name:[{key:"Copyright notice",val:"Copyright "+(new Date).getFullYear()},{key:"Font Family name",val:"My Font"},{key:"Font Subfamily name",val:""},{key:"Unique font identifier",val:"My Font 1.0"},{key:"Full Font name",val:"My Font"},{key:"Version string",val:"Version 1.0"},{key:"Postscript name",val:"My Font"},null,{key:"Manufacturer name",val:""},{key:"Designer's name",val:""},{key:"Description",val:""},{key:"Vendor URL",val:""},{key:"Designer's URL",val:""},{key:"License Description",val:"Creative Commons Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)"},{key:"License URL",val:"http://creativecommons.org/licenses/by-sa/3.0/"}],post:[{key:"italicAngle",val:"0.0"},{key:"underlinePosition",val:"-75"},{key:"underlineThickness",val:"50"}],cff:[{key:"Notice",val:""},{key:"FullName",val:"My Font"},{key:"FamilyName",val:"My Font"},{key:"Weight",val:"500"}]}}};_UI.colors.text_dark=_UI.colors.g1;_UI.colors.text_light=_UI.colors.g8;_UI.colors.button_disabled=_UI.colors.g4;_UI.colors.button_resting=_UI.colors.g8;_UI.colors.button_selected=_UI.colors.accent;var _GP={};function setOTprop(tname,tkey,tval){if(_GP.opentypeproperties[tname]){var ot=_GP.opentypeproperties[tname];for(var i=0;i<ot.length;i++){if(ot[i].key==tkey){ot[i].val=tval;return}}console.log("SETOTPROP ERROR: could not find "+tkey+" in "+tname)}else{console.log("SETOTPROP ERROR: could not find table"+tname)}}function getOTprop(tname,tkey){if(_GP.opentypeproperties[tname]){var ot=_GP.opentypeproperties[tname];for(var i=0;i<ot.length;i++){if(ot[i].key==tkey){return ot[i].val}}console.log("GETOTPROP ERROR: could not find "+tkey+" in "+tname)}else{console.log("GETOTPROP ERROR: could not find table"+tname)}return"|| RETURN VALUE ERROR ||"}function setup(){console.log("\n       GG              GG\n       G               G\n GGGG  G GG   G  GGGG  GGGGG   GGGGG\nG    G G G    G G    G G    G G     G\nG    G G G    G G    G G    G G\n GGGGG G  GGGGG GGGGG  GG   G GG\nGG   G   GG   G G             STUDIO\n GGGG     GGGG  GG\n\n"+_UI.thisGlyphrStudioVersion+"\n\n");_GP=clone(_UI.default_GP);drawLogo();navigate()}function navigate(where){mouseoutcec();document.getElementById("mainwrapper").style.overflowY="scroll";document.getElementById("mainpane").style.marginLeft="470px";document.getElementById("navprimarypane").style.display="block";document.getElementById("navtargetpane").style.display="block";document.getElementById("logocanvas").style.display="block";_UI.navprimaryhere=where||"npChar";if(_UI.navhere=="test drive")_UI.navprimaryhere="npAttributes";if(!(_UI.navhere=="character edit"||_UI.navhere=="linked shapes"))updateNavPrimaryNavTarget();switch(_UI.navhere){case"firstrun":loadPage_firstrun();break;case"font settings":loadPage_fontsettings();break;case"project settings":loadPage_projectsettings();break;case"open project":loadPage_openproject();break;case"export font":loadPage_exportfont();break;case"help":loadPage_help();break;case"about":loadPage_about();break;case"test drive":loadPage_testdrive();break;case"character edit":loadPage_charedit();document.getElementById("mainwrapper").style.overflowY="hidden";_UI.selectedshape=-1;break;case"linked shapes":loadPage_linkedshapes();document.getElementById("mainwrapper").style.overflowY="hidden";break}drawNavPrimaryOptions();document.body.focus()}function updateNavPrimaryNavTarget(){document.getElementById("navprimarypane").innerHTML=generateNavPrimaryOptions();drawNavPrimaryOptions();var nt=document.getElementById("navtargetpane");nt.innerHTML="";if(_UI.navhere!="character edit"&&_UI.navhere!="linked shapes"&&_UI.navhere!="test drive"){_UI.navprimaryhere="npNav";nt.innerHTML=generateNavTargetOptions();return}switch(_UI.navprimaryhere){case"npNav":nt.innerHTML=generateNavTargetOptions();break;case"npChar":if(_UI.navhere=="character edit"){nt.innerHTML="<h1>character edit</h1>"+updateselectchar();drawselectcharthumbs()}if(_UI.navhere=="linked shapes"){nt.innerHTML="<h1>linked shapes</h1>"+linkedshapes_subnav();drawLinkedShapeLayerThumbs()}break;case"npLayers":updatelayers();break;case"npAttributes":if(_UI.navhere=="test drive"){nt.innerHTML=updatetestdriveoptions()}else{updateCharEditDetails()}break;case"npSave":triggerProjectFileDownload();break}}function drawNavPrimaryOptions(){var ngray=_UI.colors.g9;var nselect=_UI.colors.accent;var fill=ngray;_UI.navprimaryhere=="npNav"?fill=nselect:fill=ngray;var pncanvas=document.getElementById("npNav");var pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_navigate(pnctx,fill);if(_UI.navhere=="character edit"){_UI.navprimaryhere=="npChar"?fill=nselect:fill=ngray;pncanvas=document.getElementById("npChar");pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_character(pnctx,fill);_UI.navprimaryhere=="npLayers"?fill=nselect:fill=ngray;pncanvas=document.getElementById("npLayers");pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_layers(pnctx,fill);_UI.navprimaryhere=="npAttributes"?fill=nselect:fill=ngray;pncanvas=document.getElementById("npAttributes");pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_attributes(pnctx,fill)}if(_UI.navhere=="linked shapes"){_UI.navprimaryhere=="npChar"?fill=nselect:fill=ngray;pncanvas=document.getElementById("npChar");pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_character(pnctx,fill);_UI.navprimaryhere=="npAttributes"?fill=nselect:fill=ngray;pncanvas=document.getElementById("npAttributes");pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_attributes(pnctx,fill)}if(_UI.navhere=="test drive"){_UI.navprimaryhere=="npAttributes"?fill=nselect:fill=ngray;pncanvas=document.getElementById("npAttributes");pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_attributes(pnctx,fill)}updateSaveIcon()}function updateSaveIcon(){var fill=_UI.colors.g9;if(!_UI.projectsaved)fill="white";pncanvas=document.getElementById("npSave");pnctx=pncanvas.getContext("2d");pncanvas.width=50;pncanvas.height=50;draw_primaryNav_save(pnctx,fill)}function generateNavPrimaryOptions(){var navarr=[];navarr.push("npNav");if(_UI.navhere=="character edit"){navarr.push("npAttributes");navarr.push("npLayers");navarr.push("npChar")}if(_UI.navhere=="linked shapes"){navarr.push("npAttributes");navarr.push("npChar")}if(_UI.navhere=="test drive"){navarr.push("npAttributes")}var newsub="";var bc="primarynavbutton";for(var i=0;i<navarr.length;i++){newsub+="<canvas class='"+bc+"' id='"+navarr[i]+"' onclick='_UI.navprimaryhere=\""+navarr[i]+"\";updateNavPrimaryNavTarget();'></canvas>"}newsub+="<canvas class='"+bc+"' id='npSave' onclick='triggerProjectFileDownload();'></canvas>";return newsub}function generateNavTargetOptions(){var navarr=[];navarr.push("character edit");navarr.push("linked shapes");navarr.push("test drive");navarr.push("_");navarr.push("font settings");navarr.push("project settings");navarr.push("_");navarr.push("open project");navarr.push("export font");navarr.push("_");navarr.push("help");navarr.push("about");navarr.push("_");navarr.push("bug");navarr.push("feat");var newsub="<h1>navigate</h1>";for(var i=0;i<navarr.length;i++){var bc="navtargetbutton";if(navarr[i]==_UI.navhere){bc="navtargetbuttonsel"}if(navarr[i]=="_"){newsub+="<div style='height:10px;'></div>"}else if(navarr[i]=="bug"){newsub+="<a href='javascript:sendBugEmail()' style='font-size:1.1em; padding:4px 0px 4px 0px; font-style:italic;'>report an issue</a><br>"}else if(navarr[i]=="feat"){newsub+="<a href='mailto:mail@glyphrstudio.com&subject=Feature%20Request' style='font-size:1.1em; padding:4px 0px 4px 0px; font-style:italic;'>request a feature</a><br>"}else{newsub+="<input type='button' class='"+bc+"' value='"+navarr[i]+"' onclick='_UI.navhere=\""+navarr[i]+"\"; _UI.selectedshape=-1; navigate();'>"}}return newsub}function sendBugEmail(){var dcon="<h1>Report an issue</h1>";dcon+="Hey, sorry you ran into some wonky stuff!<br>Letting us know about your problem will help us fix it for everybody.<br>";dcon+="To send us an email, click the link below.<br><br>Thanks!<br><br><br>";dcon+="<a href='mailto:mail@glyphrstudio.com&subject=Issue%20Report&body="+genEmailContent()+"' class='button' style='padding:10px;' onclick='closeDialog();'>Send an issue email to the Glyphr team</a><br>";dcon+="<br>";openDialog(dcon)}function genEmailContent(){var con="Sorry about the issue – so we can fix it, please explain step by step how to re-create the issue you ran into. If there was a JavaScript Error message or line number, include that too.%0A%0A%0A%0A";con+="Thank you!%0A%09The Glyphr Team%0A%0A";con+="___________________________________________%0A%0A";con+="Glyphr Studio Version %09%09"+_UI.thisGlyphrStudioVersion+"%0A";con+="appName %09%09"+navigator.appName+"%0A";con+="language %09%09"+navigator.language+"%0A";con+="platform %09%09"+navigator.platform+"%0A";con+="systemLanguage %09%09"+navigator.systemLanguage+"%0A";con+="userLanguage %09%09"+navigator.userLanguage+"%0A";con+="userAgent %09%09"+encodeURIComponent(navigator.userAgent)+"%0A";return con}function debug(message,force){if(_GP.projectsettings.debug|force){console.log(message)}}function closeDialog(){document.getElementById("dialog_box").style.display="none";document.getElementById("dialog_bg").style.display="none";document.getElementById("dialogRightContent").innerHTML="<b>Error: unspecified dialog box content.</b>";document.body.focus()}function openDialog(content){document.body.focus();document.getElementById("dialogRightContent").innerHTML=content;document.getElementById("dialog_box").style.display="block";document.getElementById("dialog_bg").style.display="block"}function setProjectAsSaved(){_UI.projectsaved=true;window.onbeforeunload=null;document.title="glyphr";updateSaveIcon()}function setProjectAsUnsaved(){_UI.projectsaved=false;if(_GP.projectsettings.stoppagenavigation){window.onbeforeunload=function(){return"\n\nUnless you specifically saved your data, all your progress will be lost.\n\n"}}document.title="glyphr ❖";updateSaveIcon()}function putundoq(calledfrom){var uqo={};uqo.name=calledfrom;uqo.date=(new Date).getTime();if(_UI.navhere=="character edit"){uqo.state=clone(_UI.charcurrstate);_UI.charundoq.push(uqo);_UI.charcurrstate=clone(_GP.fontchars)}else if(_UI.navhere=="linked shapes"){uqo.state=clone(_UI.linkcurrstate);_UI.linkedshapeundoq.push(uqo);_UI.linkcurrstate=clone(_GP.linkedshapes)}setProjectAsUnsaved()}function pullundoq(){var uqo;if(_UI.navhere=="character edit"){if(_UI.charundoq.length>0){uqo=_UI.charundoq.pop();_GP.fontchars=uqo.state;_UI.charcurrstate=clone(_GP.fontchars);redraw("pullundoq")}}else if(_UI.navhere=="linked shapes"){if(_UI.linkedshapeundoq.length>0){uqo=_UI.linkedshapeundoq.pop();_GP.linkedshapes=uqo.state;_UI.linkcurrstate=clone(_GP.linkedshapes);redraw("pullundoq")}}if(_UI.charundoq.length==0&&_UI.linkedshapeundoq.length==0){setProjectAsSaved()}}function clone(cobj){var newObj=cobj instanceof Array?[]:{};for(var i in cobj){if(cobj[i]&&typeof cobj[i]=="object"){newObj[i]=clone(cobj[i])}else newObj[i]=cobj[i]}return newObj}Number.prototype.makeCrisp=function(){return Math.round(this)+.5};function aalength(aa){var len=0;for(var key in aa){len++}return len}function round(num,dec){dec=isval(dec)?dec:4;var na=num.toString().split(".");if(na.length==2){var right=na[1].substring(0,dec)+"."+na[1].substring(dec+1);right=Math.round(right);num=(na[0]+"."+right)*1}return num*1}function strSan(val){return val.replace(/[<>'"\\]/g,"")}function isval(val){return typeof val!=="undefined"&&val!==null}function shiftColor(c,percent,lighter){percent=Math.max(0,Math.min(percent,1));var val={};if(c.charAt(0)=="#"){c=c.substring(1,7);val.r=parseInt(c.substring(0,2),16);val.g=parseInt(c.substring(2,4),16);val.b=parseInt(c.substring(4,6),16)}else if(c.substring(0,4)=="rgb("){c=c.split("(")[1].split(")")[0].split(",");val.r=c[0];val.g=c[1];val.b=c[2]}else{val.r=0;val.g=0;val.b=0}val.r=Math.max(0,Math.min(val.r,255));val.g=Math.max(0,Math.min(val.g,255));val.b=Math.max(0,Math.min(val.b,255));if(lighter){val.r=Math.round((255-val.r*1)*percent+val.r*1);val.g=Math.round((255-val.g*1)*percent+val.g*1);val.b=Math.round((255-val.b*1)*percent+val.b*1)}else{val.r=Math.round(val.r*1-val.r*percent);val.g=Math.round(val.g*1-val.g*percent);val.b=Math.round(val.b*1-val.b*percent)}return"rgb("+val.r+","+val.g+","+val.b+")"}function Char(oa){this.objtype="char";this.isautowide=isval(oa.isautowide)?oa.isautowide:true;this.leftsidebearing=isval(oa.leftsidebearing)?oa.leftsidebearing:false;this.charwidth=isval(oa.charwidth)?oa.charwidth:0;this.charname=oa.charname||"ERROR_CHARNAME";this.charvalue=oa.charvalue||"ERROR_CHARVALUE";this.cmapcode=oa.cmapcode||"ERROR_CMAPCODE";this.charshapes=[];var lc=0;var cs=0;if(oa.charshapes&&oa.charshapes.length){for(var i=0;i<oa.charshapes.length;i++){if(oa.charshapes[i].link){this.charshapes[i]=new LinkedShapeInstance(oa.charshapes[i]);lc++}else{this.charshapes[i]=new Shape(oa.charshapes[i]);cs++}}}if(this.isautowide)this.calcCharWidth()}Char.prototype.calcCharMaxes=function(){var maxes={xmax:this.charwidth,xmin:0,ymax:0,ymin:0};var sh,tss;for(var jj=0;jj<this.charshapes.length;jj++){sh=this.charshapes[jj];if(sh.link){tss=_GP.linkedshapes[sh.link].shape;if(sh.uselinkedshapexy){maxes.xmin=Math.min(tss.path.leftx,maxes.xmin);maxes.ymax=Math.max(tss.path.topy,maxes.ymax);maxes.ymin=Math.min(tss.path.bottomy,maxes.ymin)}else{maxes.xmin=Math.min(tss.path.leftx+sh.xpos,maxes.xmin);maxes.ymax=Math.max(tss.path.topy+sh.ypos,maxes.ymax);maxes.ymin=Math.min(tss.path.bottomy+sh.ypos,maxes.ymin)}}else{maxes.xmin=Math.min(sh.path.leftx,maxes.xmin);maxes.ymax=Math.max(sh.path.topy,maxes.ymax);maxes.ymin=Math.min(sh.path.bottomy,maxes.ymin)}}return maxes};Char.prototype.calcCharWidth=function(){if(!this.isautowide)return;this.charwidth=0;var sh,tss;if(this.charshapes){for(var jj=0;jj<this.charshapes.length;jj++){sh=this.charshapes[jj];if(sh.link){tss=_GP.linkedshapes[sh.link].shape;if(sh.uselinkedshapexy){this.charwidth=Math.max(this.charwidth,tss.path.rightx)}else{this.charwidth=Math.max(this.charwidth,tss.path.rightx+sh.xpos)}}else{this.charwidth=Math.max(this.charwidth,sh.path.rightx)}}}};Char.prototype.drawCharToArea=function(lctx,view){var ps=_GP.projectsettings;var sl=this.charshapes;var cc=this.getCharNumber();var width=this.charwidth*view.dz;if(this.isautowide){if(this.leftsidebearing===false){width+=ps.defaultlsb*view.dz}else{width+=this.leftsidebearing*view.dz}}var sh={};lctx.beginPath();for(var j=0;j<sl.length;j++){sh=sl[j];if(sh.visible){if(sh.link){if(sh.uselinkedshapexy){sh=_GP.linkedshapes[sh.link].shape}else{var ns=clone(_GP.linkedshapes[sh.link].shape);ns.path.updatePathPosition(sh.xpos,sh.ypos,true);sh=ns}}sh.path.drawPathToArea(lctx,view)}}lctx.fillStyle=_GP.projectsettings.color_glyphfill;lctx.closePath();lctx.fill("nonzero");return width};Char.prototype.getCharNumber=function(){return parseInt(this.cmapcode.slice(2),16)};function getCharFromText(c){if(c===" ")return _GP.fontchars[32];var tc;for(var num=0;num<_GP.fontchars.length;num++){tc=_GP.fontchars[num];if(tc&&tc.charvalue===c)return tc}console.error("GETCHARFROMTEXT - could not find "+c);return false}function updateCurrentCharWidth(){if(_UI.navhere=="character edit"){_GP.fontchars[_UI.selectedchar].calcCharWidth()}else if(_UI.navhere=="linked shapes"&&_GP.linkedshapes[_UI.shownlinkedshape]){var lsarr=_GP.linkedshapes[_UI.shownlinkedshape].usedin;if(lsarr)for(var c=0;c<lsarr.length;c++)_GP.fontchars[lsarr[c]].calcCharWidth()}}function createNewFontcharsArray(){return[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,new Char({charname:"SPACE",charvalue:"(space)",cmapcode:"0x20",isautowide:false,charwidth:200}),new Char({charname:"EXCLAMATION MARK",charvalue:"!",cmapcode:"0x21"}),new Char({charname:"QUOTATION MARK",charvalue:'"',cmapcode:"0x22"}),new Char({charname:"NUMBER SIGN",charvalue:"#",cmapcode:"0x23"}),new Char({charname:"DOLLAR SIGN",charvalue:"$",cmapcode:"0x24"}),new Char({charname:"PERCENT SIGN",charvalue:"%",cmapcode:"0x25"}),new Char({charname:"AMPERSAND",charvalue:"&",cmapcode:"0x26"}),new Char({charname:"APOSTROPHE",charvalue:"'",cmapcode:"0x27"}),new Char({charname:"LEFT PARENTHESIS",charvalue:"(",cmapcode:"0x28"}),new Char({charname:"RIGHT PARENTHESIS",charvalue:")",cmapcode:"0x29"}),new Char({charname:"ASTERISK",charvalue:"*",cmapcode:"0x2a"}),new Char({charname:"PLUS SIGN",charvalue:"+",cmapcode:"0x2b"}),new Char({charname:"COMMA",charvalue:",",cmapcode:"0x2c"}),new Char({charname:"HYPHEN-MINUS",charvalue:"-",cmapcode:"0x2d"}),new Char({charname:"FULL STOP",charvalue:".",cmapcode:"0x2e"}),new Char({charname:"SOLIDUS",charvalue:"/",cmapcode:"0x2f"}),new Char({charname:"DIGIT ZERO",charvalue:"0",cmapcode:"0x30"}),new Char({charname:"DIGIT ONE",charvalue:"1",cmapcode:"0x31"}),new Char({charname:"DIGIT TWO",charvalue:"2",cmapcode:"0x32"}),new Char({charname:"DIGIT THREE",charvalue:"3",cmapcode:"0x33"}),new Char({charname:"DIGIT FOUR",charvalue:"4",cmapcode:"0x34"}),new Char({charname:"DIGIT FIVE",charvalue:"5",cmapcode:"0x35"}),new Char({charname:"DIGIT SIX",charvalue:"6",cmapcode:"0x36"}),new Char({charname:"DIGIT SEVEN",charvalue:"7",cmapcode:"0x37"}),new Char({charname:"DIGIT EIGHT",charvalue:"8",cmapcode:"0x38"}),new Char({charname:"DIGIT NINE",charvalue:"9",cmapcode:"0x39"}),new Char({charname:"COLON",charvalue:":",cmapcode:"0x3a"}),new Char({charname:"SEMICOLON",charvalue:";",cmapcode:"0x3b"}),new Char({charname:"LESS-THAN SIGN",charvalue:"<",cmapcode:"0x3c"}),new Char({charname:"EQUALS SIGN",charvalue:"=",cmapcode:"0x3d"}),new Char({charname:"GREATER-THAN SIGN",charvalue:">",cmapcode:"0x3e"}),new Char({charname:"QUESTION MARK",charvalue:"?",cmapcode:"0x3f"}),new Char({charname:"COMMERCIAL AT",charvalue:"@",cmapcode:"0x40"}),new Char({charname:"LATIN CAPITAL LETTER A",charvalue:"A",cmapcode:"0x41"}),new Char({charname:"LATIN CAPITAL LETTER B",charvalue:"B",cmapcode:"0x42"}),new Char({charname:"LATIN CAPITAL LETTER C",charvalue:"C",cmapcode:"0x43"}),new Char({charname:"LATIN CAPITAL LETTER D",charvalue:"D",cmapcode:"0x44"}),new Char({charname:"LATIN CAPITAL LETTER E",charvalue:"E",cmapcode:"0x45"}),new Char({charname:"LATIN CAPITAL LETTER F",charvalue:"F",cmapcode:"0x46"}),new Char({charname:"LATIN CAPITAL LETTER G",charvalue:"G",cmapcode:"0x47"}),new Char({charname:"LATIN CAPITAL LETTER H",charvalue:"H",cmapcode:"0x48"}),new Char({charname:"LATIN CAPITAL LETTER I",charvalue:"I",cmapcode:"0x49"}),new Char({charname:"LATIN CAPITAL LETTER J",charvalue:"J",cmapcode:"0x4a"}),new Char({charname:"LATIN CAPITAL LETTER K",charvalue:"K",cmapcode:"0x4b"}),new Char({charname:"LATIN CAPITAL LETTER L",charvalue:"L",cmapcode:"0x4c"}),new Char({charname:"LATIN CAPITAL LETTER M",charvalue:"M",cmapcode:"0x4d"}),new Char({charname:"LATIN CAPITAL LETTER N",charvalue:"N",cmapcode:"0x4e"}),new Char({charname:"LATIN CAPITAL LETTER O",charvalue:"O",cmapcode:"0x4f"}),new Char({charname:"LATIN CAPITAL LETTER P",charvalue:"P",cmapcode:"0x50"}),new Char({charname:"LATIN CAPITAL LETTER Q",charvalue:"Q",cmapcode:"0x51"}),new Char({charname:"LATIN CAPITAL LETTER R",charvalue:"R",cmapcode:"0x52"}),new Char({charname:"LATIN CAPITAL LETTER S",charvalue:"S",cmapcode:"0x53"}),new Char({charname:"LATIN CAPITAL LETTER T",charvalue:"T",cmapcode:"0x54"}),new Char({charname:"LATIN CAPITAL LETTER U",charvalue:"U",cmapcode:"0x55"}),new Char({charname:"LATIN CAPITAL LETTER V",charvalue:"V",cmapcode:"0x56"}),new Char({charname:"LATIN CAPITAL LETTER W",charvalue:"W",cmapcode:"0x57"}),new Char({charname:"LATIN CAPITAL LETTER X",charvalue:"X",cmapcode:"0x58"}),new Char({charname:"LATIN CAPITAL LETTER Y",charvalue:"Y",cmapcode:"0x59"}),new Char({charname:"LATIN CAPITAL LETTER Z",charvalue:"Z",cmapcode:"0x5a"}),new Char({charname:"LEFT SQUARE BRACKET",charvalue:"[",cmapcode:"0x5b"}),new Char({charname:"REVERSE SOLIDUS",charvalue:"\\",cmapcode:"0x5c"}),new Char({charname:"RIGHT SQUARE BRACKET",charvalue:"]",cmapcode:"0x5d"}),new Char({charname:"CIRCUMFLEX ACCENT",charvalue:"^",cmapcode:"0x5e"}),new Char({charname:"LOW LINE",charvalue:"_",cmapcode:"0x5f"}),new Char({charname:"GRAVE ACCENT",charvalue:"`",cmapcode:"0x60"}),new Char({charname:"LATIN SMALL LETTER A",charvalue:"a",cmapcode:"0x61"}),new Char({charname:"LATIN SMALL LETTER B",charvalue:"b",cmapcode:"0x62"}),new Char({charname:"LATIN SMALL LETTER C",charvalue:"c",cmapcode:"0x63"}),new Char({charname:"LATIN SMALL LETTER D",charvalue:"d",cmapcode:"0x64"}),new Char({charname:"LATIN SMALL LETTER E",charvalue:"e",cmapcode:"0x65"}),new Char({charname:"LATIN SMALL LETTER F",charvalue:"f",cmapcode:"0x66"}),new Char({charname:"LATIN SMALL LETTER G",charvalue:"g",cmapcode:"0x67"}),new Char({charname:"LATIN SMALL LETTER H",charvalue:"h",cmapcode:"0x68"}),new Char({charname:"LATIN SMALL LETTER I",charvalue:"i",cmapcode:"0x69"}),new Char({charname:"LATIN SMALL LETTER J",charvalue:"j",cmapcode:"0x6a"}),new Char({charname:"LATIN SMALL LETTER K",charvalue:"k",cmapcode:"0x6b"}),new Char({charname:"LATIN SMALL LETTER L",charvalue:"l",cmapcode:"0x6c"}),new Char({charname:"LATIN SMALL LETTER M",charvalue:"m",cmapcode:"0x6d"}),new Char({charname:"LATIN SMALL LETTER N",charvalue:"n",cmapcode:"0x6e"}),new Char({charname:"LATIN SMALL LETTER O",charvalue:"o",cmapcode:"0x6f"}),new Char({charname:"LATIN SMALL LETTER P",charvalue:"p",cmapcode:"0x70"}),new Char({charname:"LATIN SMALL LETTER Q",charvalue:"q",cmapcode:"0x71"}),new Char({charname:"LATIN SMALL LETTER R",charvalue:"r",cmapcode:"0x72"}),new Char({charname:"LATIN SMALL LETTER S",charvalue:"s",cmapcode:"0x73"}),new Char({charname:"LATIN SMALL LETTER T",charvalue:"t",cmapcode:"0x74"}),new Char({charname:"LATIN SMALL LETTER U",charvalue:"u",cmapcode:"0x75"}),new Char({charname:"LATIN SMALL LETTER V",charvalue:"v",cmapcode:"0x76"}),new Char({charname:"LATIN SMALL LETTER W",charvalue:"w",cmapcode:"0x77"}),new Char({charname:"LATIN SMALL LETTER X",charvalue:"x",cmapcode:"0x78"}),new Char({charname:"LATIN SMALL LETTER Y",charvalue:"y",cmapcode:"0x79"}),new Char({charname:"LATIN SMALL LETTER Z",charvalue:"z",cmapcode:"0x7a"}),new Char({charname:"LEFT CURLY BRACKET",charvalue:"{",cmapcode:"0x7b"}),new Char({charname:"VERTICAL LINE",charvalue:"|",cmapcode:"0x7c"}),new Char({charname:"RIGHT CURLY BRACKET",charvalue:"}",cmapcode:"0x7d"}),new Char({charname:"TILDE",charvalue:"~",cmapcode:"0x7e"})]}function Coord(oa){this.objtype="coord";this.x=oa.x||0;this.y=oa.y||0;this.xlock=oa.xlock||false;this.ylock=oa.yllock||false}function LinkedShape(oa){this.objtype="linkedshape";this.shape=oa&&oa.shape?new Shape(oa.shape):new Shape({name:"New Linked Shape"});this.usedin=oa.usedin||[]}function LinkedShapeInstance(oa){this.objtype="linkedshapeinstance";this.link=oa.link||getFirstLinkedShape();this.uselinkedshapexy=isval(oa.uselinkedshapexy)?oa.uselinkedshapexy:true;this.name=oa.name||"new linkedshape instance";this.xpos=oa.xpos||0;this.ypos=oa.ypos||0;this.xlock=isval(oa.xlock)?oa.xlock:false;this.ylock=isval(oa.ylock)?oa.ylock:false;this.visible=isval(oa.visible)?oa.visible:true;this.path=false;this.hlock=false;this.wlock=false}function insertLinkedShapeDialog(){if(aalength(_GP.linkedshapes)>0){var content="Choose a Linked Shape to insert as a layer in this character:";content+=generateSSThumbs();content+="<div style='display:block;'><input type='button' class='button' value='cancel' onclick='closeDialog();'></div>";openDialog(content);drawSSThumbs()}else{openDialog("<div class='dialoglargetext'>No Linked Shapes exist.  First, create some Linked Shapes, then you can insert them into characters.</div>")}}function insertLinkedShape(ssid){var ns=new LinkedShapeInstance({link:ssid,xpos:100,ypos:100});addShape(ns);_GP.fontchars[_UI.selectedchar].calcCharWidth();addToUsedIn(ssid,_UI.selectedchar);closeDialog();putundoq("insert linked shape from charedit");redraw("insertLinkedShape")}function generateSSThumbs(){var re="<div class='ssthumbcontainer'>";for(var ssid in _GP.linkedshapes){re+="<table cellpadding=0 cellspacing=0 border=0><tr><td>";re+="<canvas class='ssthumb' id='thumb"+ssid+"' onclick='insertLinkedShape(\""+ssid+"\");' height="+_UI.thumbsize+"' width="+_UI.thumbsize+"></canvas>";re+="</td></tr><tr><td>";re+=_GP.linkedshapes[ssid].shape.name;re+="</td></tr></table>"}re+="</div>";return re}function drawSSThumbs(){var tctx={};for(var ssid in _GP.linkedshapes){tctx=document.getElementById("thumb"+ssid).getContext("2d");_GP.linkedshapes[ssid].shape.drawShapeToArea(tctx,_UI.thumbview)}}function addToUsedIn(ssid,charid){var uia=_GP.linkedshapes[ssid].usedin;uia.push(""+charid);uia.sort(function(a,b){return a-b})}function removeFromUsedIn(ssid,charid){var uia=_GP.linkedshapes[ssid].usedin;var charindex=uia.indexOf(""+charid);if(charindex!=-1){uia.splice(charindex,1)}}function linkedShapeInstanceDetails(s){content="<tr><td colspan=3><h3>linked shape</h3></td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td><td style='margin-top:0px; padding-top:0px;'> name </td><td style='margin-top:0px; padding-top:0px; padding-right:10px;'><input class='input' style='width:90%;' type='text' value='"+s.name+'\' onchange=\'ss().name = this.value; putundoq("shape name"); redraw("linkedShapeInstanceDetails");\'></td></tr>';content+="<tr><td class='leftcol'>&nbsp;</td><td> use linked shape position</td><td>"+checkUI("ss().uselinkedshapexy="+!s.uselinkedshapexy+'; putundoq("use linked shape position"); redraw("linkedShapeInstanceDetails");',s.uselinkedshapexy)+"</td></tr>";if(!s.uselinkedshapexy){content+="<tr><td class='leftcol'>&nbsp;</td><td colspan=2><h3 style='font-size:.9em; color:rgb(153,158,163);'>x & y values are relative to the linked shape position</h3></td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td><td style='margin-top:0px; padding-top:0px; text-transform:none;'>&#916; x </td><td style='margin-top:0px; padding-top:0px; padding-right:10px;'><input class='input' type='text' value='"+s.xpos+'\' onchange=\'ss().xpos = (this.value*1); putundoq("linkedshape xpos"); redraw("linkedShapeInstanceDetails");\'>'+spinner()+"</td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td><td style='margin-top:0px; padding-top:0px; text-transform:none;'>&#916; y </td><td style='margin-top:0px; padding-top:0px; padding-right:10px;'><input class='input' type='text' value='"+s.ypos+'\' onchange=\'ss().ypos = (this.value*1); putundoq("linkedshape ypos"); redraw("linkedShapeInstanceDetails");\'>'+spinner()+"</td></tr>"}content+="<tr><td class='leftcol'>&nbsp;</td><td> linked shape name </td><td>"+_GP.linkedshapes[s.link].shape.name+"</td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td><td colspan=2><input type='button' class='button' value='edit this linked shape' onclick='goToEditLinkedShape(\""+s.link+"\");'/></td></tr>";return content}function goToEditLinkedShape(ssid){_UI.shownlinkedshape=ssid;_UI.navhere="linked shapes";navigate()}function clickSelectLinkedShape(x,y){if(_GP.linkedshapes[_UI.shownlinkedshape].shape.isHere(x,y)){_UI.selectedshape=_UI.shownlinkedshape;_UI.navprimaryhere="npAttributes";return true}_UI.selectedshape=-1;return false}LinkedShapeInstance.prototype.drawShape_Stack=function(lctx){if(this.uselinkedshapexy){_GP.linkedshapes[this.link].shape.drawShape_Stack(lctx)}else{var ns=clone(_GP.linkedshapes[this.link].shape);ns.path.updatePathPosition(this.xpos,this.ypos,true);ns.drawShape_Stack(lctx)}};LinkedShapeInstance.prototype.drawShape_Single=function(lctx){if(this.uselinkedshapexy){_GP.linkedshapes[this.link].shape.drawShape_Single(lctx)}else{var ns=clone(_GP.linkedshapes[this.link].shape);ns.path.updatePathPosition(this.xpos,this.ypos,true);ns.drawShape_Single(lctx)}};LinkedShapeInstance.prototype.genPostScript=function(lastx,lasty){if(this.uselinkedshapexy){return _GP.linkedshapes[this.link].shape.path.genPathPostScript(lastx,lasty)}else{var ns=clone(_GP.linkedshapes[this.link].shape);ns.path.updatePathPosition(this.xpos,this.ypos,true);return ns.path.genPathPostScript(lastx,lasty)}};LinkedShapeInstance.prototype.drawShapeToArea=function(lctx,view){if(this.uselinkedshapexy){_GP.linkedshapes[this.link].shape.drawShapeToArea(lctx,view)}else{var ns=clone(_GP.linkedshapes[this.link].shape);ns.path.updatePathPosition(this.xpos,this.ypos,true);ns.name+=" HAS BEEN MOVED";ns.drawShapeToArea(lctx,view)}};LinkedShapeInstance.prototype.drawSelectOutline=function(onlycenter){if(this.uselinkedshapexy){_GP.linkedshapes[this.link].shape.drawSelectOutline(onlycenter)}else{var ns=clone(_GP.linkedshapes[this.link].shape);ns.path.updatePathPosition(this.xpos,this.ypos);ns.drawSelectOutline(onlycenter)}};LinkedShapeInstance.prototype.draw8points=function(onlycenter){};LinkedShapeInstance.prototype.isHere=function(x,y){if(this.uselinkedshapexy){return _GP.linkedshapes[this.link].shape.isHere(x,y)}else{var ns=clone(_GP.linkedshapes[this.link].shape);ns.path.updatePathPosition(this.xpos,this.ypos);return ns.isHere(x,y)}};LinkedShapeInstance.prototype.isOverHandle=function(){return false};function getFirstLinkedShape(){for(var ssid in _GP.linkedshapes){return ssid}return"[ERROR] - LINKEDSHAPES array has zero keys"}function generateNewSSID(){_GP.projectsettings.linkedshapecounter++;return"id"+_GP.projectsettings.linkedshapecounter}function Path(oa){this.objtype="path";this.pathpoints=false;if(oa.pathpoints&&oa.pathpoints.length){this.pathpoints=[];for(var i=0;i<oa.pathpoints.length;i++){this.pathpoints[i]=new PathPoint(oa.pathpoints[i])}}this.clockwise=isval(oa.clockwise)?oa.clockwise:findClockwise(this.pathpoints);this.topy=isval(oa.topy)?oa.topy:-1;this.bottomy=isval(oa.bottomy)?oa.bottomy:-1;this.leftx=isval(oa.leftx)?oa.leftx:-1;this.rightx=isval(oa.rightx)?oa.rightx:-1;this.selectPathPoint(false);if(this.pathpoints)this.calcMaxes()}Path.prototype.sp=function(wantindex,calledby){if(!this.pathpoints){return false}for(var p=0;p<this.pathpoints.length;p++){var thisp=this.pathpoints[p];if(thisp.selected){if(wantindex){return p}else{return thisp}}}return false};Path.prototype.drawPath=function(lctx){if(this.pathpoints===false||this.pathpoints.length<2)return;var pp,np,pph2x,pph2y,nxh1x,nxh1y,nxppx,nxppy;
lctx.moveTo(sx_cx(this.pathpoints[0].P.x),sy_cy(this.pathpoints[0].P.y));for(var cp=0;cp<this.pathpoints.length;cp++){pp=this.pathpoints[cp];np=this.pathpoints[(cp+1)%this.pathpoints.length];if(pp.type=="symmetric"){pp.makeSymmetric("H1")}else if(pp.type=="flat"){pp.makeFlat("H1")}pph2x=pp.useh2?sx_cx(pp.H2.x):sx_cx(pp.P.x);pph2y=pp.useh2?sy_cy(pp.H2.y):sy_cy(pp.P.y);nxh1x=np.useh1?sx_cx(np.H1.x):sx_cx(np.P.x);nxh1y=np.useh1?sy_cy(np.H1.y):sy_cy(np.P.y);nxppx=sx_cx(np.P.x);nxppy=sy_cy(np.P.y);lctx.bezierCurveTo(pph2x,pph2y,nxh1x,nxh1y,nxppx,nxppy)}};Path.prototype.drawPathToArea=function(lctx,view){var tempv=clone(getView("Path.drawPathToArea"));setView(view);this.drawPath(lctx);setView(tempv)};Path.prototype.genPathPostScript=function(lastx,lasty){if(!this.pathpoints)return{re:"",lastx:lastx,lasty:lasty};var p1,p2,p1h2x,p1h2y,p2h1x,p2h1y,p2ppx,p2ppy;var trr="";var re=""+(this.pathpoints[0].P.x-lastx)+" "+(this.pathpoints[0].P.y-lasty)+" rmoveto ";for(var cp=0;cp<this.pathpoints.length;cp++){p1=this.pathpoints[cp];p2=this.pathpoints[(cp+1)%this.pathpoints.length];p1h2x=p1.useh2?p1.H2.x-p1.P.x:0;p1h2y=p1.useh2?p1.H2.y-p1.P.y:0;p2h1x=p2.useh1?p2.H1.x-(p1.useh2?p1.H2.x:p1.P.x):p2.P.x-(p1.useh2?p1.H2.x:p1.P.x);p2h1y=p2.useh1?p2.H1.y-(p1.useh2?p1.H2.y:p1.P.y):p2.P.y-(p1.useh2?p1.H2.y:p1.P.y);p2ppx=p2.P.x-(p2.useh1?p2.H1.x:p2.P.x);p2ppy=p2.P.y-(p2.useh1?p2.H1.y:p2.P.y);trr="				"+p1h2x+" "+p1h2y+" "+p2h1x+" "+p2h1y+" "+p2ppx+" "+p2ppy+" rrcurveto \n";re+=trr}return{re:re,lastx:p2.P.x,lasty:p2.P.y}};Path.prototype.isOverControlPoint=function(x,y){var a=this.pathpoints;var hp=_GP.projectsettings.pointsize/getView("Path.isOverControlPoint").dz;for(var k=a.length-1;k>=0;k--){if(a[k].P.x+hp>x&&a[k].P.x-hp<x&&a[k].P.y+hp>y&&a[k].P.y-hp<y){this.selectPathPoint(k);return"P"}if(a[k].H1.x+hp>x&&a[k].H1.x-hp<x&&a[k].H1.y+hp>y&&a[k].H1.y-hp<y){this.selectPathPoint(k);return"H1"}if(a[k].H2.x+hp>x&&a[k].H2.x-hp<x&&a[k].H2.y+hp>y&&a[k].H2.y-hp<y){this.selectPathPoint(k);return"H2"}}this.selectPathPoint(0);return false};Path.prototype.updatePathSize=function(dw,dh){var ps=_GP.projectsettings;var s=ss("updatePathPosition");s.wlock?dw=0:false;s.hlock?dh=0:false;if(s.wlock&&s.hlock)return;var oldw=this.rightx-this.leftx;var oldh=this.topy-this.bottomy;var neww=Math.max(oldw+dw,1);var newh=Math.max(oldh+dh,1);var ratiodh=newh/oldh;var ratiodw=neww/oldw;for(var e=0;e<this.pathpoints.length;e++){var pp=this.pathpoints[e];pp.P.x=round((pp.P.x-this.leftx)*ratiodw+this.leftx);pp.H1.x=round((pp.H1.x-this.leftx)*ratiodw+this.leftx);pp.H2.x=round((pp.H2.x-this.leftx)*ratiodw+this.leftx);pp.P.y=round((pp.P.y-this.bottomy)*ratiodh+this.bottomy);pp.H1.y=round((pp.H1.y-this.bottomy)*ratiodh+this.bottomy);pp.H2.y=round((pp.H2.y-this.bottomy)*ratiodh+this.bottomy)}this.calcMaxes()};Path.prototype.updatePathPosition=function(dx,dy,force){isval(force)?true:force=false;for(var d=0;d<this.pathpoints.length;d++){var pp=this.pathpoints[d];pp.updatePointPosition("P",dx,dy,force)}this.calcMaxes()};function findClockwise(parr){var j,k,z;var count=0;if(parr.length<3)return 0;for(var i=0;i<parr.length;i++){j=(i+1)%parr.length;k=(i+2)%parr.length;z=(parr[j].P.x-parr[i].P.x)*(parr[k].P.y-parr[j].P.y);z-=(parr[j].P.y-parr[i].P.y)*(parr[k].P.x-parr[j].P.x);if(z<0)count--;else if(z>0)count++}return count}Path.prototype.reversePath=function(){var HT={};if(this.pathpoints){for(var i=0;i<this.pathpoints.length;i++){HT=this.pathpoints[i].H1;this.pathpoints[i].H1=this.pathpoints[i].H2;this.pathpoints[i].H2=HT;if(this.pathpoints[i].useh1!==this.pathpoints[i].useh2){this.pathpoints[i].useh1=!this.pathpoints[i].useh1;this.pathpoints[i].useh2=!this.pathpoints[i].useh2}}this.pathpoints.reverse();this.clockwise*=-1}};Path.prototype.flipNS=function(){var ly=this.topy;var lx=this.leftx;var mid=(this.topy-this.bottomy)/2+this.bottomy;for(var e=0;e<this.pathpoints.length;e++){var pp=this.pathpoints[e];pp.P.y+=(mid-pp.P.y)*2;pp.H1.y+=(mid-pp.H1.y)*2;pp.H2.y+=(mid-pp.H2.y)*2}this.setTopY(ly);this.setLeftX(lx);this.reversePath()};Path.prototype.flipEW=function(){var ly=this.topy;var lx=this.leftx;var mid=(this.rightx-this.leftx)/2+this.leftx;for(var e=0;e<this.pathpoints.length;e++){var pp=this.pathpoints[e];pp.P.x+=(mid-pp.P.x)*2;pp.H1.x+=(mid-pp.H1.x)*2;pp.H2.x+=(mid-pp.H2.x)*2}this.setTopY(ly);this.setLeftX(lx);this.reversePath()};Path.prototype.setTopY=function(newvalue){var delta=newvalue*1-ss("setTopY").path.topy;this.updatePathPosition(0,delta,true)};Path.prototype.setLeftX=function(newvalue){var delta=newvalue*1-ss("SetLeftX").path.leftx;this.updatePathPosition(delta,0,true)};Path.prototype.addPathPoint=function(newpp,addtostart){if(!newpp){newpp=new PathPoint({});if(addtostart){if(this.pathpoints.length>0){var firstpp=this.pathpoints[0];newpp.P.x=firstpp.P.x-200;newpp.P.y=firstpp.P.y-200;newpp.H1.x=newpp.P.x;newpp.H1.y=newpp.P.y-100;newpp.H2.x=newpp.P.x+100;newpp.H2.y=newpp.P.y}this.pathpoints.unshift(newpp);this.selectPathPoint(0)}else{if(this.pathpoints.length>0){var lastpp=this.pathpoints[this.pathpoints.length-1];newpp.P.x=lastpp.P.x+200;newpp.P.y=lastpp.P.y+200;newpp.H1.x=newpp.P.x;newpp.H1.y=newpp.P.y-100;newpp.H2.x=newpp.P.x+100;newpp.H2.y=newpp.P.y}this.pathpoints.push(newpp);this.selectPathPoint(this.pathpoints.length-1)}}else{this.pathpoints.push(newpp);this.selectPathPoint(this.pathpoints.length-1)}this.calcMaxes()};Path.prototype.insertPathPoint=function(){var p1i=this.sp(true,"insert path point");var p1=p1i===false?this.pathpoints[0]:this.pathpoints[p1i];if(this.pathpoints.length>1){var p2=this.pathpoints[(p1i+1)%this.pathpoints.length];var newPx=p1.P.x*.125+p1.H2.x*.375+p2.H1.x*.375+p2.P.x*.125;var newPy=p1.P.y*.125+p1.H2.y*.375+p2.H1.y*.375+p2.P.y*.125;var newpp=new PathPoint({P:new Coord({x:newPx,y:newPy}),type:"flat"});var newH2x=(p2.H1.x-p2.P.x)/2+p2.P.x;var newH2y=(p2.P.y-p2.H1.y)/2+p2.H1.y;newpp.makePointedTo(newH2x,newH2y,100);var tempH2=newpp.H2;newpp.H2=newpp.H1;newpp.H1=tempH2;newpp.makeSymmetric("H2");this.pathpoints.splice((p1i+1)%this.pathpoints.length,0,newpp);this.selectPathPoint((p1i+1)%this.pathpoints.length)}this.calcMaxes()};Path.prototype.deletePathPoint=function(){var pp=this.pathpoints;if(pp.length>1){for(var j=0;j<pp.length;j++){if(pp[j].selected){pp.splice(j,1);if(j>0){pp[j-1].selected=true}else{pp[0].selected=true}}}this.calcMaxes()}else{_UI.selectedtool="pathedit";deleteShape()}};Path.prototype.selectPathPoint=function(index){for(var j=0;j<this.pathpoints.length;j++){this.pathpoints[j].selected=false}if(index===false){return}else{index=index==-1?this.pathpoints.length-1:Math.abs(index);this.pathpoints[index%this.pathpoints.length].selected=true}};Path.prototype.calcMaxes=function(){this.topy=_UI.chareditcanvassize*-1;this.bottomy=_UI.chareditcanvassize;this.leftx=_UI.chareditcanvassize;this.rightx=_UI.chareditcanvassize*-1;var pp1,pp2,pp1h2x,pp1h2y,pp2h1x,pp2h1y,tbounds;for(var s=0;s<this.pathpoints.length;s++){pp1=this.pathpoints[s];pp2=this.pathpoints[(s+1)%this.pathpoints.length];pp1h2x=pp1.useh2?pp1.H2.x:pp1.P.x;pp1h2y=pp1.useh2?pp1.H2.y:pp1.P.y;pp2h1x=pp2.useh1?pp2.H1.x:pp2.P.x;pp2h1y=pp2.useh1?pp2.H1.y:pp2.P.y;tbounds=getBounds(pp1.P.x,pp1.P.y,pp1h2x,pp1h2y,pp2h1x,pp2h1y,pp2.P.x,pp2.P.y);this.rightx=Math.max(this.rightx,tbounds.maxx);this.topy=Math.max(this.topy,tbounds.maxy);this.leftx=Math.min(this.leftx,tbounds.minx);this.bottomy=Math.min(this.bottomy,tbounds.miny)}updateCurrentCharWidth()};function getBounds(x1,y1,cx1,cy1,cx2,cy2,x2,y2){var bounds={minx:Math.min(x1,x2),miny:Math.min(y1,y2),maxx:Math.max(x1,x2),maxy:Math.max(y1,y2)};var dcx0=cx1-x1;var dcy0=cy1-y1;var dcx1=cx2-cx1;var dcy1=cy2-cy1;var dcx2=x2-cx2;var dcy2=y2-cy2;if(cx1<bounds["minx"]||cx1>bounds["maxx"]||cx2<bounds["minx"]||cx2>bounds["maxx"]){if(dcx0+dcx2!=2*dcx1){dcx1+=.01}var numerator=2*(dcx0-dcx1);var denominator=2*(dcx0-2*dcx1+dcx2);var quadroot=(2*dcx1-2*dcx0)*(2*dcx1-2*dcx0)-2*dcx0*denominator;var root=Math.sqrt(quadroot);var t1=(numerator+root)/denominator;var t2=(numerator-root)/denominator;if(0<t1&&t1<1){checkXbounds(bounds,getBezierValue(t1,x1,cx1,cx2,x2))}if(0<t2&&t2<1){checkXbounds(bounds,getBezierValue(t2,x1,cx1,cx2,x2))}}if(cy1<bounds["miny"]||cy1>bounds["maxy"]||cy2<bounds["miny"]||cy2>bounds["maxy"]){if(dcy0+dcy2!=2*dcy1){dcy1+=.01}var numerator=2*(dcy0-dcy1);var denominator=2*(dcy0-2*dcy1+dcy2);var quadroot=(2*dcy1-2*dcy0)*(2*dcy1-2*dcy0)-2*dcy0*denominator;var root=Math.sqrt(quadroot);var t1=(numerator+root)/denominator;var t2=(numerator-root)/denominator;if(0<t1&&t1<1){checkYbounds(bounds,getBezierValue(t1,y1,cy1,cy2,y2))}if(0<t2&&t2<1){checkYbounds(bounds,getBezierValue(t2,y1,cy1,cy2,y2))}}return bounds}function checkXbounds(bounds,value){if(bounds["minx"]>value){bounds["minx"]=value}else if(bounds["maxx"]<value){bounds["maxx"]=value}}function checkYbounds(bounds,value){if(bounds["miny"]>value){bounds["miny"]=value}else if(bounds["maxy"]<value){bounds["maxy"]=value}}function getBezierValue(t,p0,p1,p2,p3){var mt=1-t;return mt*mt*mt*p0+3*mt*mt*t*p1+3*mt*t*t*p2+t*t*t*p3}function PathPoint(oa){this.objtype="pathpoint";this.P=oa.P?new Coord(oa.P):new Coord({x:100,y:100});this.H1=oa.H1?new Coord(oa.H1):new Coord({x:0,y:0});this.H2=oa.H2?new Coord(oa.H2):new Coord({x:200,y:200});this.type=oa.type||"corner";this.selected=oa.selected||false;this.useh1=isval(oa.useh1)?oa.useh1:true;this.useh2=isval(oa.useh2)?oa.useh2:true}PathPoint.prototype.makeFlat=function(move){var adj1=this.P.x-this.H1.x;var opp1=this.P.y-this.H1.y;var hyp1=Math.sqrt(adj1*adj1+opp1*opp1);var angle1=Math.acos(adj1/hyp1);var adj2=this.P.x-this.H2.x;var opp2=this.P.y-this.H2.y;var hyp2=Math.sqrt(adj2*adj2+opp2*opp2);var angle2=Math.acos(adj2/hyp2);if(angle1==angle2){return}if(isNaN(angle1)||isNaN(angle2)){return}var newHx,newHy;switch(move){case"H1":var mod=this.H1.y>this.P.y?-1:1;var newadj2=Math.cos(angle1)*hyp2;var newopp2=Math.tan(angle1)*newadj2;newHx=this.P.x+newadj2;newHy=this.P.y+newopp2*mod;this.H2.x=newHx;this.H2.y=newHy;break;case"H2":var mod=this.H2.y>this.P.y?-1:1;var newadj1=Math.cos(angle2)*hyp1;var newopp1=Math.tan(angle2)*newadj1;newHx=this.P.x+newadj1;newHy=this.P.y+newopp1*mod;this.H1.x=newHx;this.H1.y=newHy;break}this.roundAll()};PathPoint.prototype.makeSymmetric=function(move){switch(move){case"H1":this.H2.x=this.P.x-this.H1.x+this.P.x;this.H2.y=this.P.y-this.H1.y+this.P.y;break;case"H2":this.H1.x=this.P.x-this.H2.x+this.P.x;this.H1.y=this.P.y-this.H2.y+this.P.y;break}this.roundAll()};PathPoint.prototype.makePointedTo=function(px,py,length){var adj1=this.P.x-px;var opp1=this.P.y-py;var hyp1=Math.sqrt(adj1*adj1+opp1*opp1);var angle1=Math.acos(adj1/hyp1);this.H1.x=this.P.x-Math.cos(angle1)*length;this.H1.y=this.P.y-Math.sin(angle1)*length;this.makeFlat("H1");this.roundAll()};PathPoint.prototype.resetHandles=function(){this.type="flat";this.H2.x=this.P.x-100;this.H2.y=this.P.y;this.H1.x=this.P.x+100;this.H1.y=this.P.y};PathPoint.prototype.setPointPosition=function(controlpoint,nx,ny){var dx=0;var dy=0;switch(controlpoint){case"P":if(!this.P.xlock&&!isNaN(nx)){dx=this.P.x-nx;this.P.x=nx;this.H1.x-=dx;this.H2.x-=dx}if(!this.P.ylock&&!isNaN(ny)){dy=this.P.y-ny;this.P.y=ny;this.H1.y-=dy;this.H2.y-=dy}break;case"H1":if(!this.H1.xlock&&!isNaN(nx)){this.H1.x=nx}if(!this.H1.ylock&&!isNaN(ny)){this.H1.y=ny}break;case"H2":if(!this.H2.xlock&&!isNaN(nx)){this.H2.x=nx;if(this.type=="symmetric"){this.makeSymmetric("H2")}else if(this.type=="flat"){this.makeFlat("H2")}}if(!this.H2.ylock&&!isNaN(ny)){this.H2.y=ny;if(this.type=="symmetric"){this.makeSymmetric("H1")}else if(this.type=="flat"){this.makeFlat("H1")}}break}this.roundAll()};PathPoint.prototype.updatePointPosition=function(controlpoint,dx,dy,force){var lockx=_UI.selectedtool=="pathedit"?this.P.xlock:false;var locky=_UI.selectedtool=="pathedit"?this.P.ylock:false;if(isval(force)){if(force){lockx=false;locky=false}}switch(controlpoint){case"P":lockx?true:this.P.x+=dx;locky?true:this.P.y+=dy;lockx?true:this.H1.x+=dx;locky?true:this.H1.y+=dy;lockx?true:this.H2.x+=dx;locky?true:this.H2.y+=dy;break;case"H1":this.H1.x+=dx;this.H1.y+=dy;if(this.type=="symmetric"){this.makeSymmetric("H1")}else if(this.type=="flat"){this.makeFlat("H1")}break;case"H2":this.H2.x+=dx;this.H2.y+=dy;if(this.type=="symmetric"){this.makeSymmetric("H2")}else if(this.type=="flat"){this.makeFlat("H2")}break}this.roundAll()};PathPoint.prototype.roundAll=function(){this.P.x=Math.round(this.P.x);this.P.y=Math.round(this.P.y);this.H1.x=Math.round(this.H1.x);this.H1.y=Math.round(this.H1.y);this.H2.x=Math.round(this.H2.x);this.H2.y=Math.round(this.H2.y)};PathPoint.prototype.drawPoint=function(c){var ps=_GP.projectsettings.pointsize+1;var hp=ps/2;_UI.chareditctx.fillStyle=c?c:_UI.colors.accent;_UI.chareditctx.fillRect((sx_cx(this.P.x)-hp).makeCrisp()-1,(sy_cy(this.P.y)-hp).makeCrisp()-1,ps,ps);_UI.chareditctx.strokeRect((sx_cx(this.P.x)-hp).makeCrisp()-1,(sy_cy(this.P.y)-hp).makeCrisp()-1,ps,ps)};PathPoint.prototype.drawDirectionalityPoint=function(c,next){_UI.chareditctx.fillStyle=c?c:_UI.colors.accent;_UI.chareditctx.strokeStyle=_UI.colors.accent;_UI.chareditctx.lineWidth=1;var begin={x:this.P.x,y:this.P.y};var end={x:this.H2.x,y:this.H2.y};if(!this.useh2){end={x:next.P.x,y:next.P.y}}var ps=_GP.projectsettings.pointsize*.75;var arrow=[[ps*3,0],[ps,ps],[-ps,ps],[-ps,-ps],[ps,-ps]];var rotatedarrow=[];var ang=Math.atan2(end.y-begin.y,end.x-begin.x)*-1;for(var p in arrow){rotatedarrow.push([arrow[p][0]*Math.cos(ang)-arrow[p][1]*Math.sin(ang),arrow[p][0]*Math.sin(ang)+arrow[p][1]*Math.cos(ang)])}_UI.chareditctx.beginPath();_UI.chareditctx.moveTo(rotatedarrow[0][0]+sx_cx(this.P.x),rotatedarrow[0][1]+sy_cy(this.P.y));for(var p in rotatedarrow){if(p>0){_UI.chareditctx.lineTo(rotatedarrow[p][0]+sx_cx(this.P.x),rotatedarrow[p][1]+sy_cy(this.P.y))}}_UI.chareditctx.lineTo(rotatedarrow[0][0]+sx_cx(this.P.x),rotatedarrow[0][1]+sy_cy(this.P.y));_UI.chareditctx.fill();_UI.chareditctx.stroke();_UI.chareditctx.fillStyle=_UI.colors.accent;_UI.chareditctx.fillRect(sx_cx(this.P.x)-.5,sy_cy(this.P.y)-.5,1,1)};PathPoint.prototype.drawHandles=function(drawH1,drawH2){_UI.chareditctx.fillStyle=_UI.colors.accent;_UI.chareditctx.lineWidth=1;var hp=_GP.projectsettings.pointsize/2;if(drawH1&&this.useh1){_UI.chareditctx.beginPath();_UI.chareditctx.arc(sx_cx(this.H1.x),sy_cy(this.H1.y),hp,0,Math.PI*2,true);_UI.chareditctx.closePath();_UI.chareditctx.fill();_UI.chareditctx.beginPath();_UI.chareditctx.moveTo(sx_cx(this.P.x),sy_cy(this.P.y));_UI.chareditctx.lineTo(sx_cx(this.H1.x),sy_cy(this.H1.y));_UI.chareditctx.closePath();_UI.chareditctx.stroke()}if(drawH2&&this.useh2){_UI.chareditctx.beginPath();_UI.chareditctx.arc(sx_cx(this.H2.x),sy_cy(this.H2.y),hp,0,Math.PI*2,true);_UI.chareditctx.closePath();_UI.chareditctx.fill();_UI.chareditctx.beginPath();_UI.chareditctx.moveTo(sx_cx(this.P.x),sy_cy(this.P.y));_UI.chareditctx.lineTo(sx_cx(this.H2.x),sy_cy(this.H2.y));_UI.chareditctx.closePath();_UI.chareditctx.stroke()}};function Shape(oa){this.objtype="shape";this.name=oa.name||"new shape";this.xpos=isval(oa.xpos)?oa.xpos:0;this.ypos=isval(oa.ypos)?oa.ypos:400;this.path=isval(oa.path)?new Path(oa.path):rectPathFromCorners(false);this.visible=isval(oa.visible)?oa.visible:true;this.xlock=oa.xlock||false;this.ylock=oa.ylock||false;this.wlock=oa.wlock||false;this.hlock=oa.hlock||false;this.link=false;this.uselinkedshapexy=false}Shape.prototype.drawShape_Single=function(lctx){if(this.visible){lctx.fillStyle=_GP.projectsettings.color_glyphfill;if(lctx==_UI.ishereghostctx){lctx.fillStyle="rgba(0,0,255,0.2)"}lctx.beginPath();this.path.drawPath(lctx);lctx.closePath();lctx.fill()}};Shape.prototype.drawShape_Stack=function(lctx){if(this.visible){if(this.link){_GP.linkedshapes[this.link].shape.drawShape_Stack(lctx);return}if(this.path.rightx==-1&&lctx==_UI.chareditctx&&_UI.selectedtool!="newpath")this.path.calcMaxes();this.path.drawPath(lctx)}};Shape.prototype.drawShapeToArea=function(lctx,view){if(this.visible){lctx.fillStyle=_GP.projectsettings.color_glyphfill;lctx.beginPath();this.path.drawPathToArea(lctx,view);lctx.closePath();lctx.fill()}};Shape.prototype.checkPath=function(){debug("CHECKPATH - checking "+this.name+"\n"+JSON.stringify(this.path));for(var pp=0;pp<this.path.pathpoints.length;pp++){var tp=this.path.pathpoints[pp];if(!tp.P.x)debug(this.name+" p"+pp+".P.x is "+tp.P.x);if(!tp.P.y)debug(this.name+" p"+pp+".P.y is "+tp.P.y);if(!tp.H1.x)debug(this.name+" p"+pp+".H1.x is "+tp.H1.x);if(!tp.H1.y)debug(this.name+" p"+pp+".H1.y is "+tp.H1.y);if(!tp.H2.x)debug(this.name+" p"+pp+".H2.x is "+tp.H2.x);if(!tp.H2.y)debug(this.name+" p"+pp+".H2.y is "+tp.H2.y)}};function sx_cx(sx){var v=getView("sx_cx");var canvasx=v.dx;canvasx+=sx*v.dz;return canvasx}function sy_cy(sy){var v=getView("sy_cy");var canvasy=v.dy;canvasy-=sy*v.dz;return canvasy}Shape.prototype.drawSelectOutline=function(onlycenter){var hp=_GP.projectsettings.pointsize/2;_UI.chareditctx.lineWidth=1;_UI.chareditctx.strokeStyle=_UI.colors.accent;if(_UI.selectedtool=="newrect"||_UI.selectedtool=="shaperesize"){_UI.chareditctx.fillStyle="transparent";var lx=_UI.eventhandlers.temppathdragshape?sx_cx(_UI.eventhandlers.temppathdragshape.leftx):sx_cx(this.path.leftx);var rx=_UI.eventhandlers.temppathdragshape?sx_cx(_UI.eventhandlers.temppathdragshape.rightx):sx_cx(this.path.rightx);var ty=_UI.eventhandlers.temppathdragshape?sy_cy(_UI.eventhandlers.temppathdragshape.topy):sy_cy(this.path.topy);var by=_UI.eventhandlers.temppathdragshape?sy_cy(_UI.eventhandlers.temppathdragshape.bottomy):sy_cy(this.path.bottomy);var x=lx.makeCrisp()-1;var y=ty.makeCrisp()-1;var w=Math.ceil(rx-lx);var h=Math.ceil(by-ty);_UI.chareditctx.strokeStyle=_UI.colors.accent;_UI.chareditctx.strokeRect(x,y,w,h);if(_UI.selectedtool=="shaperesize"){this.draw8points(onlycenter)}}else if(_UI.selectedtool=="pathedit"||_UI.selectedtool=="newpath"){var sep=this.path.sp(true,"DRAWSELECTOUTLINE");var pp=this.path.pathpoints;_UI.chareditctx.lineWidth=1;_UI.chareditctx.strokeStyle=_UI.colors.accent;_UI.chareditctx.beginPath();this.path.drawPath(_UI.chareditctx);_UI.chareditctx.closePath();_UI.chareditctx.stroke();if(sep!==false){pp[sep].drawHandles(true,true);sep>0?pp[sep-1].drawHandles(false,true):pp[pp.length-1].drawHandles(false,true);pp[(sep+1)%pp.length].drawHandles(true,false)}for(var s=0;s<pp.length;s++){var c=_UI.colors.accent;if(this.path.sp(false)&&pp[s].selected){c="white"}if(s==pp.length-1)pp[s].drawDirectionalityPoint(c,pp[0]);else pp[s].drawDirectionalityPoint(c,pp[s+1])}}else if(_UI.selectedtool=="newoval"){_UI.chareditctx.strokeStyle=_UI.colors.accent;var tpdso=ovalPathFromCorners(_UI.eventhandlers.temppathdragshape);_UI.chareditctx.lineWidth=1;_UI.chareditctx.strokeStyle=_UI.colors.accent;_UI.chareditctx.beginPath();tpdso.drawPath(_UI.chareditctx);_UI.chareditctx.closePath();_UI.chareditctx.stroke()}};function rectPathFromCorners(cdata){var lx=0;var ty=_GP.projectsettings.ascent;var rx=_GP.projectsettings.upm/_GP.projectsettings.griddivisions;var by=0;if(cdata){lx=cdata.leftx;ty=cdata.topy;rx=cdata.rightx;by=cdata.bottomy}var qw=Math.round((rx-lx)/4);var qh=Math.round((ty-by)/4);var Pul=new Coord({x:lx,y:ty});var H1ul=new Coord({x:lx,y:ty-qh});var H2ul=new Coord({x:lx+qw,y:ty});var Pur=new Coord({x:rx,y:ty});var H1ur=new Coord({x:rx-qw,y:ty});var H2ur=new Coord({x:rx,y:ty-qh});var Plr=new Coord({x:rx,y:by});var H1lr=new Coord({x:rx,y:by+qh});var H2lr=new Coord({x:rx-qw,y:by});var Pll=new Coord({x:lx,y:by});var H1ll=new Coord({x:lx+qw,y:by});var H2ll=new Coord({x:lx,y:by+qh});var patharr=[];patharr[0]=new PathPoint({P:Pul,H1:H1ul,H2:H2ul});patharr[1]=new PathPoint({P:Pur,H1:H1ur,H2:H2ur});patharr[2]=new PathPoint({P:Plr,H1:H1lr,H2:H2lr});patharr[3]=new PathPoint({P:Pll,H1:H1ll,H2:H2ll});var rp=new Path({pathpoints:patharr,leftx:lx,rightx:rx,topy:ty,bottomy:by});return rp}function ovalPathFromCorners(cdata){var lx=cdata.leftx;var ty=cdata.topy;var rx=cdata.rightx;var by=cdata.bottomy;var hw=Math.round((rx-lx)/2);var hh=Math.round((ty-by)/2);var hwd=Math.round(hw*.448);var hhd=Math.round(hh*.448);var Pt=new Coord({x:lx+hw,y:ty});var H1t=new Coord({x:lx+hwd,y:ty});var H2t=new Coord({x:rx-hwd,y:ty});var Pr=new Coord({x:rx,y:by+hh});var H1r=new Coord({x:rx,y:ty-hhd});var H2r=new Coord({x:rx,y:by-hhd});var Pb=new Coord({x:lx+hw,y:by});var H1b=new Coord({x:rx-hwd,y:by});var H2b=new Coord({x:lx+hwd,y:by});var Pl=new Coord({x:lx,y:by+hh});var H1l=new Coord({x:lx,y:by+hhd});var H2l=new Coord({x:lx,y:ty-hhd});var patharr=[];patharr[0]=new PathPoint({P:Pt,H1:H1t,H2:H2t,type:"symmetric"});patharr[1]=new PathPoint({P:Pr,H1:H1r,H2:H2r,type:"symmetric"});patharr[2]=new PathPoint({P:Pb,H1:H1b,H2:H2b,type:"symmetric"});patharr[3]=new PathPoint({P:Pl,H1:H1l,H2:H2l,type:"symmetric"});return new Path({pathpoints:patharr})}Shape.prototype.draw8points=function(onlycenter){var ps=_GP.projectsettings.pointsize+1;var hp=ps/2;var lx=_UI.eventhandlers.temppathdragshape?sx_cx(_UI.eventhandlers.temppathdragshape.leftx):sx_cx(this.path.leftx);var rx=_UI.eventhandlers.temppathdragshape?sx_cx(_UI.eventhandlers.temppathdragshape.rightx):sx_cx(this.path.rightx);var ty=_UI.eventhandlers.temppathdragshape?sy_cy(_UI.eventhandlers.temppathdragshape.topy):sy_cy(this.path.topy);var by=_UI.eventhandlers.temppathdragshape?sy_cy(_UI.eventhandlers.temppathdragshape.bottomy):sy_cy(this.path.bottomy);var bleftx=(lx-hp).makeCrisp();var bmidx=(lx+(rx-lx)/2-hp).makeCrisp();var brightx=(rx-hp).makeCrisp();var btopy=(ty-hp).makeCrisp();var bmidy=(ty+(by-ty)/2-hp).makeCrisp();var bbottomy=(by-hp).makeCrisp();onlycenter?_UI.chareditctx.fillStyle=_UI.colors.accent:_UI.chareditctx.fillStyle="white";if(!onlycenter){if(canResize("nw")){_UI.chareditctx.fillRect(bleftx,btopy,ps,ps);_UI.chareditctx.strokeRect(bleftx,btopy,ps,ps)}if(canResize("n")){_UI.chareditctx.fillRect(bmidx,btopy,ps,ps);_UI.chareditctx.strokeRect(bmidx,btopy,ps,ps)}if(canResize("ne")){_UI.chareditctx.fillRect(brightx,btopy,ps,ps);_UI.chareditctx.strokeRect(brightx,btopy,ps,ps)}if(canResize("e")){_UI.chareditctx.fillRect(brightx,bmidy,ps,ps);_UI.chareditctx.strokeRect(brightx,bmidy,ps,ps)}if(canResize("se")){_UI.chareditctx.fillRect(brightx,bbottomy,ps,ps);_UI.chareditctx.strokeRect(brightx,bbottomy,ps,ps)}if(canResize("s")){_UI.chareditctx.fillRect(bmidx,bbottomy,ps,ps);_UI.chareditctx.strokeRect(bmidx,bbottomy,ps,ps)}if(canResize("sw")){_UI.chareditctx.fillRect(bleftx,bbottomy,ps,ps);_UI.chareditctx.strokeRect(bleftx,bbottomy,ps,ps)}if(canResize("w")){_UI.chareditctx.fillRect(bleftx,bmidy,ps,ps);_UI.chareditctx.strokeRect(bleftx,bmidy,ps,ps)}}_UI.chareditctx.fillRect(bmidx,bmidy,ps,ps);_UI.chareditctx.strokeRect(bmidx,bmidy,ps,ps)};Shape.prototype.genPostScript=function(lastx,lasty){return this.path?this.path.genPathPostScript(lastx,lasty):{re:"",lastx:lastx,lasty:lasty}};function addShape(newshape){if(newshape){if(newshape.link){_UI.selectedtool="shaperesize"}else if(newshape.path&&_UI.selectedtool=="shapemove"){deubg("ADDSHAPE triggered as true: newshape.path && _UI.selectedtool == shapemove \n >> NOT calling calcmaxes, okay?")}}else{newshape=new Shape({});newshape.name="layer "+_UI.shapelayers.length}if(_UI.navhere=="character edit"){_UI.selectedshape=_UI.shapelayers.length;_UI.navprimaryhere="npAttributes"}_UI.shapelayers.push(newshape);updateCurrentCharWidth();return newshape}function addBasicShape(type){var hd=50;var th=500;var tw=300;var newshape=new Shape({});var parr=false;var shapetype="layer ";if(type=="oval"){var p1=new PathPoint({P:new Coord({x:0,y:th/2}),H1:new Coord({x:0,y:hd}),H2:new Coord({x:0,y:th-hd}),type:"symmetric"});var p2=new PathPoint({P:new Coord({x:tw/2,y:th}),H1:new Coord({x:hd,y:th}),H2:new Coord({x:tw-hd,y:th}),type:"symmetric"});var p3=new PathPoint({P:new Coord({x:tw,y:th/2}),H1:new Coord({x:tw,y:th-hd}),H2:new Coord({x:tw,y:hd}),type:"symmetric"});var p4=new PathPoint({P:new Coord({x:tw/2,y:0}),H1:new Coord({x:tw-hd,y:0}),H2:new Coord({x:hd,y:0}),type:"symmetric"});parr=[p1,p2,p3,p4];shapetype="oval "}else{var p1=new PathPoint({P:new Coord({x:0,y:0}),H1:new Coord({x:hd,y:0}),H2:new Coord({x:0,y:hd})});var p2=new PathPoint({P:new Coord({x:0,y:th}),H1:new Coord({x:0,y:th-hd}),H2:new Coord({x:hd,y:th})});var p3=new PathPoint({P:new Coord({x:tw,y:th}),H1:new Coord({x:tw-hd,y:th}),H2:new Coord({x:tw,y:th-hd})});var p4=new PathPoint({P:new Coord({x:tw,y:0}),H1:new Coord({x:tw,y:hd}),H2:new Coord({x:tw-hd,y:0})});parr=[p1,p2,p3,p4];shapetype="rect "}newshape.path=new Path({pathpoints:parr});newshape.name=shapetype+_UI.shapelayers.length;if(_UI.navhere=="character edit"){_UI.selectedshape=_UI.shapelayers.length}_UI.shapelayers.push(newshape);updateCurrentCharWidth()}function deleteShape(){if(_UI.shapelayers[_UI.selectedshape].link){removeFromUsedIn(_UI.shapelayers[_UI.selectedshape].link,_UI.selectedchar)}if(_UI.shapelayers.length>0&&_UI.selectedshape>=0){_UI.shapelayers.splice(_UI.selectedshape,1);if(_UI.shapelayers.length==_UI.selectedshape){_UI.selectedshape=_UI.selectedshape-1}}else{}if(_UI.selectedshape>=0&&_UI.shapelayers[_UI.selectedshape].link){_UI.selectedtool="shaperesize"}updateCurrentCharWidth()}function clickSelectShape(x,y){if(_UI.navhere=="linked shapes"){return clickSelectLinkedShape(x,y)}var ts;for(var j=_UI.shapelayers.length-1;j>=0;j--){ts=_UI.shapelayers[j];if(ts.isHere(x,y)){if(!ts.link)ts.path.selectPathPoint(false);if(j!=_UI.selectedshape){_UI.selectedshape=j;if(ts.link){_UI.selectedtool="shaperesize"}}_UI.navprimaryhere="npAttributes";return true}}_UI.selectedshape=-1;return false}Shape.prototype.isHere=function(x,y){var imageData;_UI.ishereghostctx.clearRect(0,0,_UI.chareditcanvassize,_UI.chareditcanvassize);this.drawShape_Single(_UI.ishereghostctx);imageData=_UI.ishereghostctx.getImageData(x,y,1,1);return imageData.data[3]>0};Shape.prototype.isOverHandle=function(px,py){var hp=_GP.projectsettings.pointsize/2;var leftxb=sx_cx(this.path.leftx)-hp;var midxb=Math.floor(sx_cx(this.path.leftx)+(sx_cx(this.path.rightx)-sx_cx(this.path.leftx))/2-hp)+.5;var rightxb=sx_cx(this.path.rightx)-hp;var topyb=sy_cy(this.path.topy)-hp;var midyb=Math.floor(sy_cy(this.path.topy)+(sy_cy(this.path.bottomy)-sy_cy(this.path.topy))/2-hp)+.5;var bottomyb=sy_cy(this.path.bottomy)-hp;if(canResize("nw")){if(px>leftxb&&px<leftxb+_GP.projectsettings.pointsize&&(py>topyb&&py<topyb+_GP.projectsettings.pointsize)){document.body.style.cursor="nw-resize";return"nw"}}if(canResize("n")){if(px>midxb&&px<midxb+_GP.projectsettings.pointsize&&(py>topyb&&py<topyb+_GP.projectsettings.pointsize)){document.body.style.cursor="n-resize";return"n"}}if(canResize("ne")){if(px>rightxb&&px<rightxb+_GP.projectsettings.pointsize&&(py>topyb&&py<topyb+_GP.projectsettings.pointsize)){document.body.style.cursor="ne-resize";return"ne"}}if(canResize("e")){if(px>rightxb&&px<rightxb+_GP.projectsettings.pointsize&&(py>midyb&&py<midyb+_GP.projectsettings.pointsize)){document.body.style.cursor="e-resize";return"e"}}if(canResize("se")){if(px>rightxb&&px<rightxb+_GP.projectsettings.pointsize&&(py>bottomyb&&py<bottomyb+_GP.projectsettings.pointsize)){document.body.style.cursor="se-resize";return"se"}}if(canResize("s")){if(px>midxb&&px<midxb+_GP.projectsettings.pointsize&&(py>bottomyb&&py<bottomyb+_GP.projectsettings.pointsize)){document.body.style.cursor="s-resize";return"s"}}if(canResize("sw")){if(px>leftxb&&px<leftxb+_GP.projectsettings.pointsize&&(py>bottomyb&&py<bottomyb+_GP.projectsettings.pointsize)){document.body.style.cursor="sw-resize";return"sw"}}if(canResize("w")){if(px>leftxb&&px<leftxb+_GP.projectsettings.pointsize&&(py>midyb&&py<midyb+_GP.projectsettings.pointsize)){document.body.style.cursor="w-resize";return"w"}}document.body.style.cursor="default";return false};function ss(req){if(_UI.navhere=="linked shapes"){return _GP.linkedshapes[_UI.shownlinkedshape].shape}if(_UI.selectedshape!=-1){if(_UI.selectedshape>=0&&_UI.selectedshape<_UI.shapelayers.length){return _UI.shapelayers[_UI.selectedshape]}else{_UI.selectedshape=-1;return false}}else{return false}}Shape.prototype.changeShapeName=function(sn){sn=strSan(sn);if(sn!=""){this.name=sn;putundoq("shape name")}else{openDialog("<h2>Invalid shape name</h2><br>Shape names must only contain alphanumeric characters or spaces.<br>")}redraw("Shape Name")};function loadPage_about(){debug("LOADING PAGE >> loadPage_about");var content="<div class='pagecontent textpage'><h1>About Glyphr</h1>"+"<h2 style='margin-bottom:12px;'>"+_UI.thisGlyphrStudioVersion+"</h2>"+"For more informaiton visit <a href='http://www.glyphrstudio.com' target=_new>www.glyphrstudio.com</a><br>"+"Any questions? Hit up <a href='mailto:mail@glyphrstudio.com'>mail@glyphrstudio.com</a>, and we'd be happy to help out."+"<br><br>"+"The currently opened project was created with: "+_GP.projectsettings.version+"<br>"+"Glyphr projects may be incompatible with different Beta versions of Glyphr Studio.<br><br>"+"Glyphr is licensed under a <a href='http://creativecommons.org/licenses/by-sa/3.0/' target=_new>Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.<br>"+"Which basically means you can use Glyphr for commercial purposes, remix and adapt Glyphr to your own needs, and re-share Glyphr with the same license applied."+"<br><br>";document.getElementById("mainpane").innerHTML=content}function loadPage_charedit(){debug("LOADING PAGE >> loadPage_charedit");document.getElementById("mainpane").innerHTML=charedit_content();setupEditCanvas();setupGhostCanvas();initEventHandlers();_UI.selectedtool="pathedit";redraw("loadPage_charedit")}function charedit_content(){var re='<canvas id="chareditcanvas" width=12 height=12 ></canvas>';re+='<div id="toolsarea"> [ERROR: Uninitialized content] </div>';return re}function updateselectchar(fname){var ccon="<div class='charselectarea'>";fname=fname?fname:"selectchar";_UI.selectchardrawarr=[];for(var i=65;i<91;i++){ccon+=buildbutton(i,fname)}ccon+="<div style='display:block; clear:all;'></div>";for(var i=97;i<123;i++){ccon+=buildbutton(i,fname)}ccon+="<div style='display:block; clear:all;'></div>";for(var i=33;i<48;i++){ccon+=buildbutton(i,fname)}for(var i=58;i<65;i++){ccon+=buildbutton(i,fname)}for(var i=91;i<97;i++){ccon+=buildbutton(i,fname)}for(var i=123;i<127;i++){ccon+=buildbutton(i,fname)}ccon+="<div style='display:block; clear:all;'></div>";ccon+=buildbutton(32,fname);ccon+="</div>";return ccon}function drawselectcharthumbs(){var ps=_GP.projectsettings;var factor=(_UI.thumbsize-2*_UI.thumbgutter)/ps.upm;var yoffset=_UI.thumbgutter+ps.ascent*factor;for(var sc=0;sc<_UI.selectchardrawarr.length;sc++){var tc=_UI.selectchardrawarr[sc];var scan=document.getElementById("cs"+tc);scan.width=_UI.thumbsize;scan.height=_UI.thumbsize;var sctx=scan.getContext("2d");_GP.fontchars[tc].drawCharToArea(sctx,{dz:factor,dx:_UI.thumbgutter,dy:yoffset})}}function buildbutton(index,fname){var onc=fname+"("+index+");";var rv="<div class='charselectbuttonwrapper' onclick='"+onc+"' title='"+_GP.fontchars[index].charname+"'>";var issel=_GP.fontchars[index].charvalue==_GP.fontchars[_UI.selectedchar].charvalue;issel=issel&_UI.navhere!="linked shapes";if(_GP.fontchars[index].charshapes[0]){var extra="";if(issel){extra=" charselectcanvassel"}rv+="<canvas id='cs"+index+"' class='charselectcanvas"+extra+"'></canvas>";_UI.selectchardrawarr.push(index)}else{if(issel){rv+="<div class='charselectbuttonsel'"}else{rv+="<div class='charselectbutton'"}if(index==32)rv+=" style='font-size:13px; padding-top:15px;'";rv+=">";var bv=_GP.fontchars[index].charvalue;if(bv=="'")bv="&#39";rv+=bv+"</div>"}rv+="</div>";return rv}function selectchar(c,dontnavigate){_UI.selectedchar=c;_UI.shapelayers=_GP.fontchars[c].charshapes;_UI.selectedshape=-1;if(!dontnavigate){navigate("npAttributes")}}function setupGhostCanvas(){_UI.ishereghostcanvas=document.getElementById("ishereghostcanvas");_UI.ishereghostcanvas.height=_UI.chareditcanvassize;_UI.ishereghostcanvas.width=_UI.chareditcanvassize;_UI.ishereghostctx=_UI.ishereghostcanvas.getContext("2d");_UI.ishereghostctx.fillStyle="cyan";_UI.ishereghostctx.globalAlpha=.5;_UI.ishereghostcanvas.style.backgroundColor="transparent"
}function setupEditCanvas(){_UI.chareditcanvas=document.getElementById("chareditcanvas");_UI.chareditcanvas.height=_UI.chareditcanvassize;_UI.chareditcanvas.width=_UI.chareditcanvassize;_UI.chareditctx=_UI.chareditcanvas.getContext("2d");_UI.chareditcanvas.onselectstart=function(){return false};_UI.chareditcanvas.onmouseout=mouseoutcec;_UI.chareditcanvas.onmouseover=mouseovercec}function resetCursor(){document.body.style.cursor="default"}function setView(oa){var sc=_UI.selectedchar;var v=_UI.views;if(!isval(v[sc])){v[sc]=getView("setView")}if(isval(oa.dx)){v[sc].dx=oa.dx}if(isval(oa.dy)){v[sc].dy=oa.dy}if(isval(oa.dz)){v[sc].dz=oa.dz}}function getView(calledby){var sc=_UI.selectedchar;var v=_UI.views;if(isval(v[sc])){return clone(v[sc])}else{return clone(_UI.defaultview)}}function viewZoom(zfactor){setView({dz:getView("viewZoom").dz*=zfactor});redraw("viewZoom")}function resetThumbView(){var zoom=(_UI.thumbsize-2*_UI.thumbgutter)/_GP.projectsettings.upm;_UI.thumbview={dx:_UI.thumbgutter,dy:_UI.thumbgutter+_GP.projectsettings.ascent*zoom,dz:zoom}}function redraw(calledby){if(_UI.navhere=="linked shapes"){_UI.redrawing=false;linkedshapesredraw("redraw");return}if(_UI.redrawing){return}_UI.redrawing=true;var sc=_GP.fontchars[_UI.selectedchar];_UI.chareditctx.clearRect(0,0,_UI.chareditcanvassize,_UI.chareditcanvassize);grid();_UI.shapelayers=sc.charshapes;sc.drawCharToArea(_UI.chareditctx,getView("Redraw"));var s=ss("Redraw");if(s){s.drawSelectOutline(s.link!=false);if(s.link){_UI.selectedtool="shaperesize"}}updateNavPrimaryNavTarget();updatetools();_UI.redrawing=false}function updateCharEditDetails(){var s=ss("update details");var ispointsel=false;if(s&&!s.link)ispointsel=s.path.sp(false);if(_UI.selectedtool!="pathedit")ispointsel=false;var content="";if(_UI.navhere=="linked shapes"){content="<h1>"+_GP.linkedshapes[_UI.shownlinkedshape].shape.name+"</h1>"}else{content="<h1>attributes</h1>"}_UI.locarr=[];_UI.checkarr=[];content+="<table class='detail'>";if(_UI.navhere=="character edit"){if(s&&s.link){content+=linkedShapeInstanceDetails(s)}else if(s){content+=shapeDetails(s);if(ispointsel){content+=pointDetails(s)}}else{content+=charDetails()}content+="</table><br>";content+=updateactions()}else if(_UI.navhere=="linked shapes"){if(s){content+=shapeDetails(s);if(ispointsel){content+=pointDetails(s)}}content+=linkedShapeCharDetails();content+="</table><br>";content+=updatelinkedshapeactions()}try{document.getElementById("navtargetpane").innerHTML=content}catch(err){console.error("UPDATEDETAILS - innerHTML update error caught")}ispointsel?drawPointButtons(s):false;if(_UI.navhere=="linked shapes"){drawUsedinThumbs()}for(var j=0;j<_UI.locarr.length;j++){var thislocid="locid"+j;var obj=document.getElementById(thislocid);if(obj){obj.height=11;obj.width=11;var color=_UI.locarr[j]?_UI.colors.button_selected:_UI.colors.button_resting;drawLockButton(obj,color)}}_UI.locid=0;for(var k=0;k<_UI.checkarr.length;k++){var thischeckid="checkid"+k;var obj=document.getElementById(thischeckid);if(obj){obj.height=15;obj.width=15;drawCheckbox(obj,_UI.checkarr[k])}}_UI.checkid=0}function charDetails(s){var sc=_GP.fontchars[_UI.selectedchar];var content="";content+="<tr><td colspan=3><h3>character "+sc.charvalue+"</h3></td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td style='margin-top:0px; padding-top:0px;'> auto width </td>"+"<td class='rightcol'>"+checkUI("_GP.fontchars[_UI.selectedchar].isautowide="+!sc.isautowide+'; redraw("charDetails");',sc.isautowide)+"</td>"+"</tr>";if(!sc.isautowide){content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> width <span class='unit'>(em units)</span> </td>"+"<td class='rightcol'><input class='input' type='text' value='"+rounddec(sc.charwidth)+"' onchange='_GP.fontchars[_UI.selectedchar].charwidth = (this.value*1); redraw(\"charDetails\");'>"+spinner()+"</td>"+"</tr>"}else{content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> width <span class='unit'>(em units)</span> </td>"+"<td class='rightcol'><input type='text' disabled='disabled' value='"+rounddec(sc.charwidth)+"'/></td>"+"</tr>"}content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> width <span class='unit'>(em %)</span> </td>"+"<td class='rightcol'><input type='text' disabled='disabled' value='"+rounddec(sc.charwidth/_GP.projectsettings.upm)+"'/></td>"+"</tr>";content+="<tr><td colspan=3>&nbsp;</td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td style='margin-top:0px; padding-top:0px;'> use default left side bearing </td>"+"<td class='rightcol'>"+checkUI("_GP.fontchars[_UI.selectedchar].leftsidebearing="+!sc.leftsidebearing+'; redraw("charDetails");',!sc.leftsidebearing)+"</td>"+"</tr>";if(sc.leftsidebearing){if(sc.leftsidebearing===true)sc.leftsidebearing=_GP.projectsettings.defaultlsb;content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td>left side bearing <span class='unit'>(em units)</span> </td>"+"<td class='rightcol'><input class='input' type='text' value='"+sc.leftsidebearing+"' onchange='_GP.fontchars[_UI.selectedchar].leftsidebearing = (this.value*1); redraw(\"charDetails\");'>"+spinner()+"</td>"+"</tr>"}else{content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td>left side bearing <span class='unit'>(em units)</span> </td>"+"<td class='rightcol'><input type='text' disabled='disabled' value='"+rounddec(_GP.projectsettings.defaultlsb)+"'/></td>"+"</tr>"}content+="<tr><td colspan=3>&nbsp;</td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> number of shapes </td>"+"<td class='rightcol'><input type='text' disabled='disabled' value='"+_UI.shapelayers.length+"'/></td>"+"</tr>";return content}function shapeDetails(s){var content="";content+="<tr><td colspan=2><h3>shape</h3></td><td style='width:200px'>&nbsp;</td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td style='margin-top:0px; padding-top:0px;'> name </td>"+"<td class='rightcol' style='margin-top:0px; padding-top:0px; padding-right:10px;'>"+"<input class='input' style='width:90%;' type='text' value='"+s.name+"' onchange='ss().changeShapeName(this.value);'></td>"+"</tr>";if(!_UI.eventhandlers.temppathdragshape){content+="<tr><td class='leftcol'>"+lockUI("ss().xlock",s.xlock)+"</td>"+"<td> shape x </td>"+"<td class='rightcol'><input class='input' type='text' "+(s.xlock?"disabled='disabled'":'onchange=\'if(!_UI.redrawing){ss().path.setLeftX(this.value); putundoq("Shape X Position"); redraw("shapeDetails - X Position");}\'')+" value='"+rounddec(s.path.leftx)+"' >"+(s.xlock?"":spinner())+"</td>"+"</tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().ylock",s.ylock)+"</td>"+"<td> shape y </td>"+"<td class='rightcol'><input class='input' type='text' "+(s.ylock?"disabled='disabled'":'onchange=\'if(!_UI.redrawing){ss().path.setTopY(this.value); putundoq("Shape Y Position"); redraw("shapeDetails - Y Position");}\'')+" value='"+rounddec(s.path.topy)+"' >"+(s.ylock?"":spinner())+"</td>"+"</tr>";var cw=s.path.rightx-s.path.leftx;content+="<tr><td class='leftcol'>"+lockUI("ss().wlock",s.wlock)+"</td>"+"<td> width </td>"+"<td class='rightcol'><input class='input' type='text' "+(s.wlock?"disabled='disabled'":"onchange='if(!_UI.redrawing){ss().path.updatePathSize((this.value-"+cw+'),0); putundoq("Shape Width"); redraw("shapeDetails - Width");}\'')+" value='"+rounddec(cw)+"' >"+(s.wlock?"":spinner())+"</td>"+"</tr>";var ch=s.path.topy-s.path.bottomy;content+="<tr><td class='leftcol'>"+lockUI("ss().hlock",s.hlock)+"</td>"+"<td> height </td>"+"<td class='rightcol'><input class='input' type='text' "+(s.hlock?"disabled='disabled'":"onchange='if(!_UI.redrawing){ss().path.updatePathSize(0,(this.value-"+ch+")); ss().path.updatePathPosition(0,((this.value-"+ch+')*-1),true); putundoq("Shape Height"); redraw("shapeDetails - Height");}\'')+" value='"+rounddec(ch)+"' >"+(s.hlock?"":spinner())+"</td>"+"</tr>"}else{content+="<tr><td class='leftcol'>"+lockUI("ss().xlock",s.xlock)+"</td>"+"<td> x </td>"+"<td class='rightcol'><input class='input' type='text' value='"+rounddec(_UI.eventhandlers.temppathdragshape.leftx)+"'>&nbsp;</td>"+"</tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().ylock",s.ylock)+"</td>"+"<td> y </td>"+"<td class='rightcol'><input class='input' type='text' value='"+rounddec(_UI.eventhandlers.temppathdragshape.topy)+"'>&nbsp;</td>"+"</tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().wlock",s.wlock)+"</td>"+"<td> width </td>"+"<td class='rightcol'><input class='input' type='text' value='"+rounddec(_UI.eventhandlers.temppathdragshape.rightx-_UI.eventhandlers.temppathdragshape.leftx)+"'>&nbsp;</td>"+"</tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().hlock",s.hlock)+"</td>"+"<td> height </td>"+"<td class='rightcol'><input class='input' type='text' value='"+rounddec(_UI.eventhandlers.temppathdragshape.topy-_UI.eventhandlers.temppathdragshape.bottomy)+"'>&nbsp;</td>"+"</tr>"}content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> direction </td>"+"<td class='rightcol'><input type='text' disabled='disabled'"+" value='"+(s.path.clockwise==0?"unknown":s.path.clockwise>0?"counterclockwise":"clockwise")+"'/>"+"<input type='button' onclick='ss().path.reversePath();putundoq(\"Reverse Path Direction\");redraw(\"shapeDetails - Clockwise\");' value='"+(s.path.clockwise>0?"&#8635":"&#8634")+";' class='button spinnerbutton' style='width:40px;'/></td>"+"</tr>";return content}function pointDetails(s){var tp=s.path.sp();var content="";content+="<tr><td colspan=3><h3>path point</h3></td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> selected point </td>"+"<td class='rightcol'><input class='input' type='text' value='"+s.path.sp(true)+"' onchange='ss().path.selectPathPoint(this.value); redraw(\"pointDetails\");'>"+spinner()+"</td>"+"</tr>";content+="<tr><td class='leftcol'>&nbsp;</td><td> point type </td><td class='rightcol'>  ";content+="<canvas class='canvasbutton' title='point type: corner' onclick='ss().path.sp().type = \"corner\"; putundoq(\"Point Type: Corner\"); redraw(\"pointDetails\");' id='pointcornercanvas'></canvas>";content+="<canvas class='canvasbutton' title='point type: flat' onclick='ss().path.sp().type = \"flat\"; putundoq(\"Point Type: Flat\"); redraw(\"pointDetails\");' id='pointflatcanvas'></canvas>";content+="<canvas class='canvasbutton' title='point type: symmetric' onclick='ss().path.sp().type = \"symmetric\"; putundoq(\"Point Type: Symmetric\"); redraw(\"pointDetails\");' id='pointsymmetriccanvas'></canvas>";content+="</td></tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().path.sp().P.xlock",tp.P.xlock)+"</td>"+"<td> point x </td>"+"<td class='rightcol'><input class='input' type='text' "+(tp.P.xlock?"disabled='disabled'":'onchange=\'ss().path.sp().setPointPosition("P", Math.round(this.value), "null"); putundoq("Point X Position"); redraw("pointDetails");\'')+" value='"+rounddec(tp.P.x)+"' >"+(tp.P.xlock?"":spinner())+"</td>"+"</tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().path.sp().P.ylock",tp.P.ylock)+"</td>"+"<td> point y </td>"+"<td class='rightcol'><input class='input' type='text' "+(tp.P.ylock?"disabled='disabled'":'onchange=\'ss().path.sp().setPointPosition("P", "null", Math.round(this.value)); putundoq("Point Y Position"); redraw("pointDetails");\'')+" value='"+rounddec(tp.P.y)+"' >"+(tp.P.ylock?"":spinner())+"</td>"+"</tr>";content+="<tr><td colspan=3><h3>handle 1 <span class='unit'>(before the point)</span></h3></td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> use handle 1 </td>"+"<td class='rightcol'>"+checkUI("ss().path.sp().useh1="+!tp.useh1+'; putundoq("Use H1"); ss().path.calcMaxes(); redraw("pointDetails");',tp.useh1)+"</td>"+"</tr>";if(tp.useh1){content+="<tr><td class='leftcol'>"+lockUI("ss().path.sp().H1.xlock",tp.H1.xlock)+"</td>"+"<td> handle 1 x </td>"+"<td class='rightcol'><input class='input' type='text' "+(tp.H1.xlock?"disabled='disabled'":'onchange=\'ss().path.sp().setPointPosition("H1", Math.round(this.value), "null"); putundoq("H1 X Position"); redraw("pointDetails");\'')+" value='"+rounddec(tp.H1.x)+"' >"+(tp.H1.xlock?"":spinner())+"</td>"+"</tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().path.sp().H1.ylock",tp.H1.ylock)+"</td>"+"<td> handle 1 y </td>"+"<td class='rightcol'><input class='input' type='text' "+(tp.H1.ylock?"disabled='disabled'":'onchange=\'ss().path.sp().setPointPosition("H1", "null", Math.round(this.value)); putundoq("H1 Y Position"); redraw("pointDetails");\'')+" value='"+rounddec(tp.H1.y)+"' >"+(tp.H1.ylock?"":spinner())+"</td>"+"</tr>"}content+="<tr><td colspan=3><h3>handle 2 <span class='unit'>(after the point)</span></h3></td></tr>";content+="<tr><td class='leftcol'>&nbsp;</td>"+"<td> use handle 2 </td>"+"<td class='rightcol'>"+checkUI("ss().path.sp().useh2="+!tp.useh2+'; putundoq("Use H2"); ss().path.calcMaxes(); redraw("pointDetails");',tp.useh2)+"</td>"+"</tr>";if(tp.useh2){content+="<tr><td class='leftcol'>"+lockUI("ss().path.sp().H2.xlock",tp.H2.xlock)+"</td>"+"<td> handle 2 x </td>"+"<td class='rightcol'><input class='input' type='text' "+(tp.H2.xlock?"disabled='disabled'":'onchange=\'ss().path.sp().setPointPosition("H2", Math.round(this.value), "null"); putundoq("H2 X Position"); redraw("pointDetails");\'')+" value='"+rounddec(tp.H2.x)+"' >"+(tp.H2.xlock?"":spinner())+"</td>"+"</tr>";content+="<tr><td class='leftcol'>"+lockUI("ss().path.sp().H2.ylock",tp.H2.ylock)+"</td>"+"<td> handle 2 y </td>"+"<td class='rightcol'><input class='input' type='text' "+(tp.H2.ylock?"disabled='disabled'":'onchange=\'ss().path.sp().setPointPosition("H2", "null", Math.round(this.value)); putundoq("H2 Y Position y"); redraw("pointDetails");\'')+" value='"+rounddec(tp.H2.y)+"' >"+(tp.H2.ylock?"":spinner())+"</td>"+"</tr>"}return content}function drawPointButtons(s){var tp=s.path.sp();var tempctx;var tempcanvas;var color;tempcanvas=document.getElementById("pointcornercanvas");tempcanvas.height=15;tempcanvas.width=15;tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");color=tp.type=="corner"?_UI.colors.button_selected:_UI.colors.button_resting;drawPointCornerButton(tempctx,color);tempcanvas=document.getElementById("pointflatcanvas");tempcanvas.height=15;tempcanvas.width=15;tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");color=tp.type=="flat"?_UI.colors.button_selected:_UI.colors.button_resting;drawPointFlatButton(tempctx,color);tempcanvas=document.getElementById("pointsymmetriccanvas");tempcanvas.height=15;tempcanvas.width=15;tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");color=tp.type=="symmetric"?_UI.colors.button_selected:_UI.colors.button_resting;drawPointSymmetricButton(tempctx,color)}function lockUI(varname,islocked){var re="<canvas id='locid"+_UI.locid+"' ";_UI.locarr[_UI.locid]=islocked;_UI.locid=_UI.locid*1+1;re+=" onclick='"+varname+" = "+!islocked+'; redraw("lockUI");\'></canvas>';return re}function checkUI(onclick,ischecked){var re="<canvas id='checkid"+_UI.checkid+"' ";_UI.checkarr[_UI.checkid]=ischecked;_UI.checkid=_UI.checkid*1+1;re+=" onclick='"+onclick+"'></canvas>";return re}function rounddec(num){num=num?num:0;var numsplit=num.toString().split(".");if(numsplit.length==1){return numsplit}else{return""+numsplit[0]+"."+numsplit[1].substr(0,3)}}function updateactions(){var content="<h1>actions</h1><table class='actionsgrid'><tr>";var s=ss("Update Actions");var allactions="<td><h3>universal</h3>";allactions+="<input  class='"+(_UI.charundoq.length>0?"button":"buttondis")+"' type='button' value='Undo"+(_UI.charundoq.length>0?" "+_UI.charundoq.length:"")+"' onclick='pullundoq()'><br>";allactions+="<input class='button' type='button' value='add new shape' onclick='addShape();putundoq(\"Add Shape\");redraw(\"updateactions\");'><br>";allactions+="<input class='button' type='button' value='add linked shape' onclick='insertLinkedShapeDialog();'><br>";allactions+="<input class='"+(_UI.clipboardshape?"button":"buttondis")+"' type='button' value='Paste' onclick='pasteShape();putundoq(\"Paste Shape\");redraw(\"updateactions\");'><br>";allactions+="</td>";var shapeactions="<td><h3>shape</h3>";shapeactions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Copy' onclick='copyShape()'><br>";shapeactions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Flip Horizontal' onclick='ss().path.flipEW();putundoq(\"Flip Shape Horizontal\");redraw(\"updateactions\");'><br>";shapeactions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Flip Vertical' onclick='ss().path.flipNS();putundoq(\"Flip Shape Vertical\");redraw(\"updateactions\");'><br>";shapeactions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Delete' onclick='deleteShape();putundoq(\"Delete Shape\");redraw(\"updateactions\");'><br>";shapeactions+="</td>";var layeractions="<td><h3>layer</h3>";layeractions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Move Up' onclick='moveupShape();putundoq(\"Move Shape Layer Up\");'><br>";layeractions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Move Down' onclick='movedownShape();putundoq(\"Move Shape Layer Down\");'><br>";layeractions+="</td>";var canvasactions="<td><h3>editor view</h3>";canvasactions+="<input class='button' type='button' value='Toggle Grid' onclick='_UI.showgrid? _UI.showgrid=false : _UI.showgrid=true; redraw(\"updateactions\");'><br>";canvasactions+="<input class='button' type='button' value='Toggle Guides' onclick='_UI.showguides? _UI.showguides=false : _UI.showguides=true; redraw(\"updateactions\");'><br>";canvasactions+="</td>";var pointactions="<td><h3>path point</h3>";pointactions+="<input class='button' type='button' value='Insert' onclick='ss().path.insertPathPoint(); putundoq(\"Insert Path Point\"); redraw(\"updateactions\");'><br>";pointactions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Delete' onclick='ss().path.deletePathPoint(); putundoq(\"Delete Path Point\"); redraw(\"updateactions\");'><br>";pointactions+="<input class='button' type='button' value='Reset Handles' onclick='ss().path.sp().resetHandles(); putundoq(\"Reset Path Point\"); redraw(\"updateactions\");'><br>";pointactions+="</td>";content+=allactions;if(_UI.shapelayers.length>0){content+=shapeactions}else{content+="<td> &nbsp; </td>"}var ispointsel=false;if(s&&!s.link)ispointsel=s.path.sp(false);if(_UI.selectedtool!="pathedit")ispointsel=false;if(ispointsel){content+=pointactions}else{content+="<td> &nbsp; </td>"}content+="</tr><tr>";content+=canvasactions;if(_UI.shapelayers.length>1){content+=layeractions}content+="</td></tr></table><br><br>";return content}function updateLayerActions(){var content="<h1>actions</h1><table class='actionsgrid'><tr>";var s=ss("Update Actions");var allactions="<td><h3>shape</h3>";allactions+="<input class='button' type='button' value='add new shape' onclick='addShape();putundoq(\"Add Shape\");redraw(\"updateLayerActions\");'><br>";allactions+="<input class='button' type='button' value='add linked shape' onclick='insertLinkedShapeDialog();'><br>";var shapeactions="<input class='"+(s?"button":"buttondis")+"' type='button' value='Delete' onclick='deleteShape();putundoq(\"Delete Shape\");redraw(\"updateLayerActions\");'><br>";var layeractions="<td><h3>layer</h3>";layeractions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Move Up' onclick='moveupShape();putundoq(\"Move Shape Layer Up\");'><br>";layeractions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Move Down' onclick='movedownShape();putundoq(\"Move Shape Layer Down\");'><br>";layeractions+="</td>";content+=allactions;if(_UI.shapelayers.length>0){content+=shapeactions}content+="</td>";if(_UI.shapelayers.length>1){content+=layeractions}content+="<td> &nbsp; </td></tr></table>";return content}function copyShape(){if(_UI.navhere=="linked shapes"){_UI.clipboardshape={s:_GP.linkedshapes[_UI.shownlinkedshape].shape,c:_UI.shownlinkedshape}}else if(_UI.navhere=="character edit"){var s=ss("copy shape");if(s.link)s=_GP.linkedshapes[s.link].shape;if(s){_UI.clipboardshape={s:s,c:_UI.selectedchar}}redraw("copyShape")}}function pasteShape(){if(_UI.clipboardshape){var newshape=clone(_UI.clipboardshape.s);_UI.clipboardshape.c==_UI.selectedchar?newshape.path.updatePathPosition(20,20,true):true;var newname=newshape.name;var newsuffix=" (copy)";var n=newshape.name.lastIndexOf("(copy");if(n>0){var suffix=newname.substring(n+5);newname=newname.substring(0,n);if(suffix==")"){newsuffix="(copy 2)"}else{suffix=suffix.substring(1);suffix=suffix.substring(0,suffix.length-1);newsuffix="(copy "+(parseInt(suffix)+1)+")"}}newshape.name=newname+newsuffix;if(newshape.link){addToUsedIn(newshape.link,_UI.selectedchar)}addShape(newshape)}}function moveupShape(){var s=ss("Move Up Shape");if(s&&_UI.selectedshape<_UI.shapelayers.length-1){var tempshape=_UI.shapelayers[_UI.selectedshape+1];_UI.shapelayers[_UI.selectedshape+1]=_UI.shapelayers[_UI.selectedshape];_UI.shapelayers[_UI.selectedshape]=tempshape;_UI.selectedshape++;redraw("moveupShape")}}function movedownShape(){var s=ss("Move Down Shape");if(s&&_UI.selectedshape>0){var tempshape=_UI.shapelayers[_UI.selectedshape-1];_UI.shapelayers[_UI.selectedshape-1]=_UI.shapelayers[_UI.selectedshape];_UI.shapelayers[_UI.selectedshape]=tempshape;_UI.selectedshape--;redraw("movedownShape")}}function spinner(){var content="";content+="<input type='button' value='&#9652;' class='button spinnerbutton' onclick='inc(this);'>";content+="<input type='button' value='&#9662;' class='button spinnerbutton' onclick='dec(this);'>";return content}function inc(obj){if(obj.parentNode.childNodes[0]){if(isNaN(obj.parentNode.childNodes[0].value))obj.parentNode.childNodes[0].value=0;obj.parentNode.childNodes[0].value=obj.parentNode.childNodes[0].value*1+_GP.projectsettings.spinnervaluechange;obj.parentNode.childNodes[0].onchange()}}function dec(obj){if(obj.parentNode.childNodes[0]){if(isNaN(obj.parentNode.childNodes[0].value))obj.parentNode.childNodes[0].value=0;obj.parentNode.childNodes[0].value=obj.parentNode.childNodes[0].value*1-_GP.projectsettings.spinnervaluechange;obj.parentNode.childNodes[0].onchange()}}function updatelayers(){var content="<h1>shapes</h1>";content+="<div style='height:7px; display:block;'></div>";if(_UI.shapelayers.length>0){content+="<table class='layertable'>";for(var i=_UI.shapelayers.length-1;i>=0;i--){if(i==_UI.selectedshape){content+="<tr class='layersel'"}else{content+="<tr class='layer'"}content+=" onclick='_UI.selectedshape = "+i+'; redraw("updatelayers");\'>';content+="<td class='layerthumb'><canvas id='layerthumb"+i+"' height='"+_UI.thumbsize+"' width='"+_UI.thumbsize+"'></canvas></td>";content+="<td class='layername'>"+_UI.shapelayers[i].name;if(_UI.shapelayers[i].link){content+="<span class='layernote'>[linked to "+_GP.linkedshapes[_UI.shapelayers[i].link].shape.name+"]</span>"}content+="</td></tr>"}content+="</table>"}else{content+="<div style='margin-left:10px; font-style:oblique;'>No shapes exist yet.<br><br></div>"}if(_UI.clipboardshape){content+="<br>Clipboard: "+_UI.clipboardshape.s.name}content+=updateLayerActions();try{document.getElementById("navtargetpane").innerHTML=content}catch(err){}if(_UI.shapelayers.length>0){var tctx={};var tele=false;for(var i=_UI.shapelayers.length-1;i>=0;i--){tele=document.getElementById("layerthumb"+i);tctx=tele.getContext("2d");tele.style.backgroundColor=_UI.colors.offwhite;if(i==_UI.selectedshape)tele.style.backgroundColor="rgb(255,255,255)";_UI.shapelayers[i].drawShapeToArea(tctx,_UI.thumbview)}}}function updatetools(){var pointselectclass="";var pointselectclickable=true;var s=ss("Charedit: UpdateTools");if(_UI.navhere=="linked shapes"){if(!_GP.linkedshapes[_UI.selectedshape]){s=false}}if(_UI.selectedtool=="pathedit"){pointselectclass="buttonsel tool"}else if(s.link){pointselectclass="buttondis tool";pointselectclickable=false}else{pointselectclass="button tool"}var content="";content+="<div title='edit path' class='"+pointselectclass+"' "+(pointselectclickable?"onclick='clicktool(\"pathedit\");'":"")+"/><canvas id='patheditbuttoncanvas'></canvas></div>";content+="<div title='move & resize shape' class='"+(_UI.selectedtool=="shaperesize"?"buttonsel ":"button ")+"tool' onclick='clicktool(\"shaperesize\");'/><canvas id='shaperesizebuttoncanvas'></canvas></div>";if(_UI.navhere=="character edit"){content+="<div class='tool' style='width:10px;'>&nbsp;</div>";content+="<div title='new rectangle shape' class='"+(_UI.selectedtool=="newrect"?"buttonsel ":"button ")+"tool' onclick='clicktool(\"newrect\");'/><canvas id='newrectbuttoncanvas'></canvas></div>";content+="<div title='new oval shape' class='"+(_UI.selectedtool=="newoval"?"buttonsel ":"button ")+"tool' onclick='clicktool(\"newoval\");'/><canvas id='newovalbuttoncanvas'></canvas></div>";content+="<div title='new path shape' class='"+(_UI.selectedtool=="newpath"?"buttonsel ":"button ")+"tool' onclick='clicktool(\"newpath\");'/><canvas id='newpathbuttoncanvas'></canvas></div>"}content+="<div class='tool' style='width:10px;'>&nbsp;</div>";content+="<div title='scroll and pan' class='"+(_UI.selectedtool=="pan"?"buttonsel ":"button ")+"tool' onclick='clicktool(\"pan\");'/><canvas id='panbuttoncanvas'></canvas></div>";content+="<div title='zoom: in' class='button tool' onclick='viewZoom(1.1);'><canvas id='zoominbuttoncanvas'></canvas></div>";content+="<div title='zoom: out' class='button tool' onclick='viewZoom(.9);'><canvas id='zoomoutbuttoncanvas'></canvas></div>";content+="<div title='zoom: one to one' class='button tool' onclick='setView({\"dz\":1});redraw(\"updatetools\");'><canvas id='zoom1to1buttoncanvas'></canvas></div>";content+="<div title='zoom: full em' class='button tool' onclick='setView(clone(_UI.defaultview)); redraw(\"updatetools\");'><canvas id='zoomembuttoncanvas'></canvas></div>";content+="<div title='zoom level' class='tool out'>"+round(getView("updatetools").dz*100,2)+"%</div>";try{document.getElementById("toolsarea").innerHTML=content}catch(err){console.error("UPDATETOOLS - innerHTML update error caught")}var tempctx;var tempcanvas;var bh=19;var bw=16;tempcanvas=document.getElementById("patheditbuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");if(_UI.selectedtool=="pathedit"){drawPathEditButton(tempctx,"white","black")}else if(!pointselectclickable){drawPathEditButton(tempctx,"rgb(80,80,80)","rgb(80,80,80)")}else{drawPathEditButton(tempctx,"transparent",_UI.colors.accent)}tempcanvas=document.getElementById("shaperesizebuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="3px 3px 0px 3px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");if(_UI.selectedtool=="shaperesize"){drawShapeResizeButton(tempctx,"white","black")}else{drawShapeResizeButton(tempctx,"transparent",_UI.colors.accent)}tempcanvas=document.getElementById("panbuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="3px 4px 0px 2px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");if(_UI.selectedtool=="pan"){drawPanButton(tempctx,"white","black")}else{drawPanButton(tempctx,_UI.colors.accent,"transparent")}tempcanvas=document.getElementById("zoominbuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="2px 4px 0px 2px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");drawZoomInButton(tempctx,_UI.colors.accent,"transparent");tempcanvas=document.getElementById("zoomoutbuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="2px 4px 0px 2px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");drawZoomOutButton(tempctx,_UI.colors.accent,"transparent");tempcanvas=document.getElementById("zoom1to1buttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="2px 4px 0px 2px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");drawZoom1to1Button(tempctx,_UI.colors.accent,"transparent");tempcanvas=document.getElementById("zoomembuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="4px 4px 0px 3px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");drawZoomEmButton(tempctx,_UI.colors.accent,"transparent");if(_UI.navhere=="character edit"){tempcanvas=document.getElementById("newrectbuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="2px 4px 0px 4px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");if(_UI.selectedtool=="newrect"){drawNewRectButton(tempctx,"white","black")}else{drawNewRectButton(tempctx,"transparent",_UI.colors.accent)}tempcanvas=document.getElementById("newovalbuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="2px 4px 0px 4px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");if(_UI.selectedtool=="newoval"){drawNewOvalButton(tempctx,"white","black")}else{drawNewOvalButton(tempctx,"transparent",_UI.colors.accent)}tempcanvas=document.getElementById("newpathbuttoncanvas");tempcanvas.height=bh;tempcanvas.width=bw;tempcanvas.style.margin="2px 4px 0px 4px";tempcanvas.style.backgroundColor="transparent";tempctx=tempcanvas.getContext("2d");if(_UI.selectedtool=="newpath"){drawNewPathButton(tempctx,"white","black")}else{drawNewPathButton(tempctx,"transparent",_UI.colors.accent)}}}function clicktool(ctool){_UI.selectedtool=ctool;var s=ss("clicktool");_UI.eventhandlers.eh_addpath.firstpoint=true;if(ctool=="newrect"||ctool=="newoval"){_UI.selectedshape=-1}else if(ctool=="newpath"){_UI.selectedshape=-1}else if(ctool=="pathedit"){if(s){s.path.selectPathPoint(0)}}else if(ctool="shapemove"){if(s){s.path.calcMaxes()}}redraw("clicktool")}function grid(){var ps=_GP.projectsettings;var v=getView("grid");_UI.chareditctx.fillStyle=_UI.colors.offwhite;_UI.chareditctx.fillRect(0,0,99999,99999);var zupm=ps.upm*v.dz;var gutter=(_UI.chareditcanvassize*v.dz-zupm)/2;var zasc=ps.ascent*v.dz;var xs={};xs.xmax=_UI.chareditcanvassize;xs.xmin=0;xs.ymax=_UI.chareditcanvassize;xs.ymin=0;_UI.chareditctx.fillStyle="white";_UI.chareditctx.fillRect(xs.xmin,xs.ymin,xs.xmax-xs.xmin,xs.ymax-xs.ymin);var mline=v.dy-ps.ascent*v.dz;var xline=v.dy-ps.xheight*v.dz;var dline=v.dy-(ps.ascent-ps.upm)*v.dz;var overshootsize=ps.overshoot*v.dz;var lgline=dline+overshootsize+ps.linegap*v.dz;if(_UI.showgrid||_UI.showguides){_UI.chareditctx.lineWidth=1;_UI.chareditctx.strokeStyle=_GP.projectsettings.color_grid;if(_UI.showgrid){var gsize=ps.upm/ps.griddivisions*v.dz;for(var j=v.dx;j<xs.xmax-1;j+=gsize){vertical(j,xs.ymin,xs.ymax)}vertical(xs.xmax+1,xs.ymin,xs.ymax);for(var j=v.dx;j>=xs.xmin;j-=gsize){vertical(j,xs.ymin,xs.ymax)}for(var j=v.dy;j<xs.ymax-1;j+=gsize){horizontal(j,xs.xmin,xs.xmax)}horizontal(xs.ymax,xs.xmin,xs.xmax+1);for(var j=v.dy;j>=xs.ymin;j-=gsize){horizontal(j,xs.xmin,xs.xmax)}}if(_UI.showguides){_UI.chareditctx.strokeStyle=shiftColor(_GP.projectsettings.color_guideline,.8,true);horizontal(xline-overshootsize,xs.xmin,xs.xmax);horizontal(mline-overshootsize,xs.xmin,xs.xmax);horizontal(v.dy+overshootsize,xs.xmin,xs.xmax);horizontal(dline+overshootsize,xs.xmin,xs.xmax);horizontal(lgline,xs.xmin,xs.xmax);if(_UI.navhere=="character edit"){var sc=_GP.fontchars[_UI.selectedchar];vertical(v.dx-v.dz*(sc.leftsidebearing||_GP.projectsettings.defaultlsb),xs.xmin,xs.xmax);vertical(v.dx+v.dz*sc.charwidth,xs.xmin,xs.xmax)}_UI.chareditctx.strokeStyle=shiftColor(_GP.projectsettings.color_guideline,.5,true);horizontal(xline,xs.xmin,xs.xmax);horizontal(mline,xs.xmin,xs.xmax);horizontal(dline,xs.xmin,xs.xmax);_UI.chareditctx.fillStyle=_GP.projectsettings.color_guideline;_UI.chareditctx.beginPath();_UI.chareditctx.moveTo(v.dx,v.dy);_UI.chareditctx.lineTo(v.dx,v.dy+_GP.projectsettings.pointsize*2);_UI.chareditctx.lineTo(v.dx-_GP.projectsettings.pointsize*2,v.dy);_UI.chareditctx.closePath();_UI.chareditctx.fill();_UI.chareditctx.strokeStyle=_GP.projectsettings.color_guideline;
horizontal(v.dy,xs.xmin,xs.xmax);vertical(v.dx,xs.ymin,xs.ymax)}}}function horizontal(y,xmin,xmax){y=Math.round(y)-.5;_UI.chareditctx.beginPath();_UI.chareditctx.moveTo(xmin,y);_UI.chareditctx.lineTo(xmax,y);_UI.chareditctx.stroke();_UI.chareditctx.closePath()}function vertical(x,ymin,ymax){x=Math.round(x)-.5;_UI.chareditctx.beginPath();_UI.chareditctx.moveTo(x,ymin);_UI.chareditctx.lineTo(x,ymax+1);_UI.chareditctx.stroke();_UI.chareditctx.closePath()}function loadPage_exportfont(){debug("LOADING PAGE >> loadPage_exportfont");var con=document.getElementById("mainpane");con.innerHTML="<div class='pagecontent textpage'><h1>Export Font</h1>"+"To transform your Glyphr Project into an OTF font, you must use a tool called TTX. "+"You can learn more about TTX, and find donwload links for it, over at <a href='http://www.glyphrstudio.com/ttx/' target=_new>glyphrstudio.com/ttx</a>. "+"Generate the .xml file below.  Once you have TTX installed, simply drag your .xml file over the TTX .exe "+"program icon, and an OTF font will be generated.<br><br>"+"<input type='button' class='buttonsel' value='Generate TTX XML File' onclick='triggerTTXFileDownload()'></input>"+"<br><br></div>"}function loadPage_fontsettings(){debug("LOADING PAGE >> loadPage_fontsettings");var ps=_GP.projectsettings;var content="<div class='pagecontent textpage'><h1>Font Settings</h1>";content+="<p style='margin-bottom:20px;'>These properties are used by the Glyphr project while you are designing this font.  By default, these are the same as some of the OpenType settings below."+"<br><i>Values will be saved as you change them</i>.</p>";content+="<h3>Character Proportions</h3>";content+="Glyphr projects export OpenType fonts with PostScript outlines.  Characters in this kind of font have a total height of 1000 Em units. "+"The baseline is the one main dividing line for each character, with the ascent and descent above it and below it. "+"Some characters, like p and y, fall below the baseline into the descent.<br>"+"<table class='fontmetricstable'>"+"<tr><td>Ascent height: </td><td><input type='text' value='"+ps.ascent+"' onchange='updateAscender(this.value);'>"+spinner()+"</td><td></td><td><span class='unit'>(em units)</span></td></tr>"+"<tr><td>Descent height: </td><td><input type='text' id='metric-des' disabled='disabled' value='"+(ps.ascent-ps.upm)+"'/></td><td></td><td><span class='unit'>(em units)</span></td></tr>"+"<tr><td>Total Units per Em: </td><td><input type='text' disabled='disabled' value='"+ps.upm+"'/></td><td></td><td><span class='unit'>(em units)</span></td></tr>"+"</table><br>";content+="<h3>Default Left Side Bearing</h3>"+"This is the amount of blank space that is added to the left of characters when they are displayed.  This metric can be set individually per character, but will default to this value if not set. "+"<table class='fontmetricstable'>"+"<tr><td>Left Side Bearing: </td><td><input type='text' value='"+ps.defaultlsb+"' onchange='_GP.projectsettings.lsb = this.value;'>"+spinner()+"</td><td><span class='unit'>(em units)</span></td></tr>"+"</table><br>";content+="<h3>Line Gap</h3>"+"This is the amount of vertical space between characters on separate lines. This is recomended to be 20% to 25% of the total Units per Em."+"<table class='fontmetricstable'>"+"<tr><td>Line Gap: </td><td><input type='text' value='"+ps.linegap+"' onchange='_GP.projectsettings.linegap = this.value;'>"+spinner()+"</td><td><span class='unit'>(em units)</span></td></tr>"+"</table><br>";content+="<br><h1>OpenType Properties</h1>"+"<p style='margin-bottom:20px;'>These properties will be saved directly to the various OpenType tables when the font is exported to TTX format.  More information about all of these properties can be found in the <a href='http://www.microsoft.com/typography/otspec/otff.htm#otttables' target=_new>OpenType Specification</a>."+"<br><i>Values will be saved as you change them</i>.</p>";content+="<h2>Tables</h2>";var otp=_GP.opentypeproperties;content+="<h3>name</h3>";content+="<table class='opentypepropertiestable' cellpadding=0 cellspacing=0 border=0>";for(var prop=0;prop<otp.name.length;prop++){if(prop!=7){content+="<tr><td class='propname'>"+otp.name[prop].key+"</td><td><input type='text' value='"+otp.name[prop].val+"' onchange='_GP.opentypeproperties.name["+prop+"].val = this.value;' /></td></tr>"}}content+="</table>";content+="<h3>head</h3>";content+="<table class='opentypepropertiestable' cellpadding=0 cellspacing=0 border=0>";for(var prop=0;prop<otp.head.length;prop++){content+="<tr><td class='propname'>"+otp.head[prop].key+"</td><td><input type='text' value='"+otp.head[prop].val+'\' onchange=\'setOTprop("head", "'+otp.head[prop].key+"\", this.value);' /></td></tr>"}content+="</table>";content+="<h3>os/2</h3>";content+="<table class='opentypepropertiestable' cellpadding=0 cellspacing=0 border=0>";for(var prop=0;prop<otp.os_2.length;prop++){content+="<tr><td class='propname'>"+otp.os_2[prop].key+"</td><td><input type='text' value='"+otp.os_2[prop].val+'\' onchange=\'setOTprop("os_2", "'+otp.os_2[prop].key+"\", this.value);' /></td></tr>"}content+="</table>";content+="<h3>post</h3>";content+="<table class='opentypepropertiestable' cellpadding=0 cellspacing=0 border=0>";for(var prop=0;prop<otp.post.length;prop++){content+="<tr><td class='propname'>"+otp.post[prop].key+"</td><td><input type='text' value='"+otp.post[prop].val+'\' onchange=\'setOTprop("post", "'+otp.post[prop].key+"\", this.value);' /></td></tr>"}content+="</table>";content+="<h3>cff</h3>";content+="<table class='opentypepropertiestable' cellpadding=0 cellspacing=0 border=0>";for(var prop=0;prop<otp.cff.length;prop++){content+="<tr><td class='propname'>"+otp.cff[prop].key+"</td><td><input type='text' value='"+otp.cff[prop].val+'\' onchange=\'setOTprop("cff", "'+otp.cff[prop].key+"\", this.value);' /></td></tr>"}content+="</table>";content+="</div>";document.getElementById("mainpane").innerHTML=content}function updateAscender(val){var ps=_GP.projectsettings;ps.ascent=Math.max(0,Math.min(ps.upm,Math.round(val)));document.getElementById("metric-des").value=ps.ascent-ps.upm}function loadPage_help(){debug("LOADING PAGE >> loadPage_help");var content="<div class='textpage pagecontent'><a name='top'></a>";content+="<h1>Help</h1><p>Peruse the document, but if you have any other questions, you can email <a href='mailto:mail@glyphrstudio.com'>mail@glyphrstudio.com</a>, and we'd be happy to help out.</p><h3>jump to a section</h3><p><a href='#nav_and_layout'>Navigation and Layout</a></p><p>Editing: &nbsp; <a href='#page_char_edit_and_linked_shapes'>Character Edit and Linked Shape Pages</a> &nbsp;<a href='#shape_editing'>Shape Editing</a> &nbsp;<a href='#edit_canvas_tools'>Canvas Tools</a> &nbsp;<br/>Attributes Panels: &nbsp; <a href='#attributes_character'>Character</a> &nbsp;<a href='#attributes_shape'>Shape</a> &nbsp;<a href='#attributes_path_point'>Path Point</a> &nbsp;<a href='#attributes_linked_shape'>Linked Shape</a> &nbsp;</p><p>Other Pages: &nbsp; <a href='#page_test_drive'>Test Drive</a> &nbsp;<a href='#page_font_settings'>Font Settings</a> &nbsp;<a href='#page_project_settings'>Project Settings</a> &nbsp;<a href='#page_open_project'>Open Project</a> &nbsp;<a href='#page_export_font'>Export Font</a> &nbsp;<a href='#page_about'>About</a> &nbsp;</p><br/><a name = 'nav_and_layout'></a><h2>Navigation and Layout</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>The Glyphr Studio work space has three vertical areas: from left to right, the Navigation Bar, the Panel, and the Main Content area.  Selecting an icon in the Navigation Bar will update the Panel and the Main Content areas.  The top option in the Navigation Bar displays all the main pages in the Panel, allowing you to navigate around Glyphr Studio.</p><p>Some of the pages have additional Navigation Bar icons - like Attributes, Layers, and Character Selection - that are specific to character editing, or other activities.</p><p>The bottom-most icon in the Navigation Bar is a save icon - it does not actually navigate anywhere, but instead is just an omnipresent shortcut to save your Glyphr Project.  When there are changes that have not been saved, the save icon becomes slightly highlighted, and a diamond icon ❖ will be added to the browser title.</p><br/><a name = 'page_char_edit_and_linked_shapes'></a><h2>Character Edit and Linked Shapes pages</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>The Character Edit and Linked Shapes pages have many shape editing controls in common.  Linked Shapes are single outlines that can be inserted into many characters of a font.  Updating the Linked Shape will also update all the Linked Shape instances.  Characters in your font can have many shapes (both linked and not), so there is an added concept of Layers on the Character Edit page.</p><p>Linked Shapes are individual shapes that can be added to many Characters. Any time the Linked Shape is edited, all the Characters that use that Linked Shape are updated. There are many individual letter forms that are shared across characters in a single font - for example the round o form of the letters b, d, g, o, p, q. Linked Shapes were designed to make it easy to keep similar letter forms consistent across a font.</p><p>Creating new Linked Shapes, and adding a Linked Shape to a character can be done through the Actions list in the Attributes Panel. The Linked Shapes page is very similar to the Character Edit page. Each Linked Shape is just a single Shape, so there are no shape layers, or add shape buttons. The Linked Shapes page also displays all the shapes that use the current Linked Shape - they are displayed as a thumbnail in the lower left, and update as the Linked Shape is edited. Clicking on one of these thumbnails will navigate to the Character Edit page for that character.</p><br/><a name = 'shape_editing'></a><h2>Shape Editing</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>Shape Editing concepts can be found on the Character Edit and Linked Shape pages.  In general, a font is just a collection of data, which can be represented hierarchically as:</p><p>Font<br/>- Character<br/>-- Shape<br/>--- Path<br/>---- Path Point<br/>----- Point and Handles<br/></p><p>This data, along with metadata and attributes for each, can be edited either in the Attributes Panel, or interactively using the Edit Canvas in the Content Area.</p><p>Many of these attributes can be locked by selecting the small lock icon to the left of the attribute.  This will stop this attribute from accidentally being changed, and in most cases, will limit what can be done on the Edit Canvas.</p><p>Unless otherwise noted, most attributes are in Em units.</p><br/><a name = 'edit_canvas_tools'></a><h2>Edit Canvas Tools</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>In the Upper Left hand side of the Edit Canvas there are 10 tools. The currently selected tool has a blue background. The tools, from left to right, are:<ul>	<li><b>Point Select</b> - Selects and edits individual Path Points and Handles. It cannot move or resize shapes.</li>	<li><b>Shape Select</b> - Selects, moves, and resizes shapes. It cannot edit the individual path points.</li>	<li><b>New Rectangle / New Oval</b> - Click and drag to draw new Rectangles or Ovals.</li>	<li><b>New Path</b> - Draws a new path. Single clicking will create Path Points that do not have handles.  Clicking and dragging will add a Path Point where the click began, and also a symmetrical handle where the click ends.  To stop adding new Path Points, either click the first Path Point, or click off the Edit Canvas.</li>	<li><b>Pan Tool</b> - Moves the canvas up/down/left/right.<br/>The Keyboard Shortcut for this tool is the Spacebar.</li>	<li><b>Zoom In / Zoom Out</b> - The plus / minus buttons will increase or decrease the size of the Edit Canvas.<br/>The Keyboard Shortcut for this tool is the Mouse Scroll Wheel.</li>	<li><b>1:1 Button</b> - Sets the Zoom level where 1 Pixel = 1 Em Unit.</li>	<li><b>M Button (Em Square Button)</b> - Sets the Zoom level to display the entire Em square area </li>	<li><b>Zoom Percent</b> - Displays the current zoom level (read only).</li></ul></p><br/><a name = 'attributes_character'></a><h2>Attributes Panel - Character</h2>(Character Edit Page)<br/><a href='#top'><span class='unit'>(back to top)</span></a><p>When no shape is selected, the Attributes Panel shows attributes for the currently selected Character.<ul>	<li><b>Auto Width</b> - When selected, the width of the character will be calculated automatically based on the farthest right edge of all the Shapes in that character.</li>	<li><b>Width (em units)</b> - If Auto Width is set, this is a read-only attribute for how wide the character is in Em Units.  If Auto Width is not set, a width can be set manually for the character.</li>	<li><b>Width (em %)</b> - Read only display of how wide the character is as compared to the Em square.</li>	<li><b>Use Default Left Side Bearing</b> - When selected, the global default Left Side Bearing will be used for this character.  The Default Left Side Bearing can be updated in on the Font Settings page.  When not selected, the Left Side Bearing can be set manually for this character.</li>	<li><b>Left Side Bearing</b> - If Use Default Left Side Bearing is selected, this displays the inherited value.  If Use Default Left Side Bearing is not selected, this is where a custom value can be entered.</li>	<li><b>Number of Shapes</b> - A read only count of the number of shapes in this character.</li></ul></p><br/><a name = 'attributes_shape'></a><h2>Attributes Panel - Shape</h2>(Character Edit and Linked Shape Pages)<br/><a href='#top'><span class='unit'>(back to top)</span></a><p><ul>	<li><b>Name</b> - Any name you want to give this shape.</li>	<li><b>X/Y</b> - The shape's coordinates, as defined by the blue bounding box's upper left corner. </li>	<li><b>Height / Width</b> - Overall size dimensions of the shape. </li>	<li><b>Direction</b> - he clockwise or counterclockwise direction of Path Points along a Path determine if that path will additively or subtractively overlap with other Shapes in the character.</li></ul></p><br/><a name = 'attributes_path_point'></a><h2>Attributes Panel - Path Point </h2>(Character Edit and Linked Shape Pages)<br/><a href='#top'><span class='unit'>(back to top)</span></a><p><ul>	<li><b>Selected Point</b> - Displays which point is currently selected. 0 is the first Path Point.</li>	<li><b>Point Type</b> - Each Path Point has two handles that control the curve of the path before and after it. There are three kinds of Point Types: Corner (Handles can be anywhere), Flat (Handles will be in line with each other), and Symmetric (Handles will be in-line with each other and equidistant from the Path Point).</li>	<li><b>Point X/Y</b> - The Path Point's coordinates. </li>	<li><b>Use Handle 1/2</b> - Deselecting this will remove the handle, such that it will not impact the curvature of the path.</li>	<li><b>Handle 1 X/Y & Handle 2 X/Y</b> - The Handle's coordinates. </li></ul></p><br/><a name = 'attributes_linked_shape'></a><h2>Attributes Panel - Linked Shape Instance</h2>(Linked Shape Page)<br/><a href='#top'><span class='unit'>(back to top)</span></a><p><ul>	<li><b>Name</b> - Any name you want to give this Linked Shape Instance.  Can be different than the Linked Shape itself.</li>	<li><b>Use Linked Shape Position</b> - By default, a Linked Shape Instance is locked to the position of the Linked Shape.  Unchecking this option will give you the option to move the Linked Shape Instance.</li>	<li><b>ΔX / ΔY</b> - When Use Linked Shape Position is unselected, these coordinates are used to move the Linked Shape Instance to a new location.  These are delta values, meaning they are relative to the original Linked Shape.</li>	<li><b>Linked Shape Name</b> - A read-only value of the Linked Shape that this Linked Shape Instance is linked to.</li>	<li><b>Edit This Linked Shape (action button)</b> - This will navigate to the Linked Shapes page, and allow you to make changes to the original Linked Shape.</li></ul></p><br/><a name = 'page_test_drive'></a><h2>Test Drive Page</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>The Test Drive page is where your font can be tried out in real time. Typing in the upper textbox will display that same text in your font face in the lower box.</p><p>In the Attributes Panel, there is a list of Pangram buttons that will populate the upper textbox with sentences that contain all the letters of the alphabet. Similarly, there are buttons that will populate the upper textbox with certain character sets.</p><p>The Options area lets you change how your font is drawn to the lower box, including options for Font Size, Line Spacing, and Character Spacing.</p><p>The 'Generate PNG File' button will launch a new tab with an image of whatever is displayed in the lower box. Right-click the image to save the PNG file.</p><br/><a name = 'page_font_settings'></a><h2>Font Settings Page</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>Font settings deal with global attributes that affect all characters in your font.  Glyphr Studio uses the properties in the Font Settings section to display and edit shapes:<ul>	<li><b>Character Proportions</b> - Characters have a total height of 1000 Units, called Em Units.  The baseline of that character splits the upper and lower portions of the character vertically.  Input an Ascent Height, and the Descent Height will be calculated automatically.</li>	<li><b>Default Left Side Bearing</b> - All characters a small amount of space to their left that separates them from another character to their left.  Individual Left Side Bearings can be edited in the Attributes Panel of that character.  But, to make things easier, if a specific Left Side Bearing is not set, this Default Left Side Bearing will be applied.</li>	<li><b>Line Gap</b> - This is the space between the bottom of the Em square of one line, and the top of the Em square of characters on a line underneath.</li></ul>Open Type Properties are a set of font metadata that is saved with the font file.  They include things like Font Name, Version Number, and other descriptive information.</p><br/><a name = 'page_project_settings'></a><h2>Project Settings Page</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>This information does not necessarily have a direct effect on the Font itself, but is used to help with designing your font.  This information is saved when a Glyphr Project is saved, and will be imported when a saved project is loaded.  Viewing the Grids and Guides can be toggled from the Actions section of the Attribute Panel.<ul>	<li><b>Project Name</b> - Initially, this project name is used as the Font Name as well.  But, the Glyphr Project can have a different name from the Font itself, which can be edited here.</li>	<li><b>Grid System</b> - This can be helpful in visualizing shape dimensions, it draws a light gray grid across the Edit Canvas.  Input a number of divisions per Em.</li>	<li><b>X Height</b> - another main dividing line within a character is the 'x height'.  It is a shorthand way of describing the average height of lowercase letters in a font.</li>	<li><b>Overshoot</b> - Usually rounded shapes extend a small amount past guide lines, so rounded shapes visually appear to line up with squared shapes.  This will draw a light overshoot guideline past the Cap Height, X Height, and Baseline guidelines.</li></ul></p><br/><a name = 'page_open_project'></a><h2>Open Project Page</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>There are two options for opening a new Glyphr Project: loading a previously-saved Glyphr Project file, or starting a new font from scratch. To load an existing Glyphr Project file, drag and drop the file onto the area indicated. To start a new project from scratch, edit the Project Name. The Font Name can be edited at any time from the Font Metadata page.</p><p>Loading or starting a new Glyphr Project will delete the current Glyphr Project, so be sure to save your existing project before loading or starting a new one.</p><br/><a name = 'page_export_font'></a><h2>Export Font Page</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>This page has information about TTX, a program used to turn font files into XML, and XML files back into fonts.  Glyphr uses TTX as an intermediary step to create a font file.  Glyphr will generate a TTX XML file for you, which you can then use to generate an OpenType font file.</p><p>More information can be found at <a href='http://www.glyphrstudio.com/ttx' target=_new>glyphrstudio.com/ttx</a></p><br/><a name = 'page_about'></a><h2>About Page</h2><a href='#top'><span class='unit'>(back to top)</span></a><p>Displays various information about the currently loaded Glyphr Project, and the current Glyphr Studio being used.  Glyphr Projects created with different versions of Glyphr Studio may not play nicely together.</p>";content+="</div>";document.getElementById("mainpane").innerHTML=content}function loadPage_linkedshapes(){debug("LOADING PAGE >> loadPage_linkedshapes");document.getElementById("mainpane").innerHTML=linkedshapes_content();setupEditCanvas();setupGhostCanvas();initEventHandlers();grid();document.onkeypress=keypress;_UI.selectedshape=-1;linkedshapesredraw("loadPage_linkedshapes")}function linkedshapes_content(){var re='<canvas id="chareditcanvas" width=12 height=12 ></canvas>';re+='<div id="toolsarea"> [ERROR: Uninitialized content] </div>';re+='<table class="charedittable" cellspacing=0 cellpadding=0 border=0><tr>';re+='<td id="detailsarea"> [ERROR: Uninitialized content] </td></tr>';re+='<tr><td id="actionsarea"> [ERROR: Uninitialized content] </td>';re+="</tr></table>";return re}function linkedshapes_subnav(){var re="<div class='subnavunit'>";re+="<table class='layertable'>";for(var ssid in _GP.linkedshapes){re+=makeSSSubnavButton(ssid)}re+="</table>";re+="<h1>actions</h1>";re+="<table class='actionsgrid'><tr><td><h3>linked shape</h3>";re+="<input class='button' type='button' value='create new' onclick='addLinkedShape();putundoq(\"Create New Linked Shape\");navigate();'><br>";re+="<input class='"+(aalength(_GP.linkedshapes)>1?"button":"buttondis")+"' type='button' value='delete' onclick='deleteLinkedShapeConfirm();'><br>";re+="<input class='button' type='button' value='insert to character' onclick='showAddSSToCharDialog();'><br>";re+="</td> &nbsp; </td></td> &nbsp; </td></tr></table>";return re}function drawLinkedShapeLayerThumbs(){var ps=_GP.projectsettings;var tctx={};var tele=false;var factor=(_UI.thumbsize-2*_UI.thumbgutter)/ps.upm;var yoffset=_UI.thumbgutter+ps.ascent*factor;for(var ssid in _GP.linkedshapes){tele=document.getElementById("layerthumb"+ssid);tctx=tele.getContext("2d");tele.style.backgroundColor=_UI.colors.offwhite;if(ssid==_UI.shownlinkedshape)tele.style.backgroundColor="rgb(255,255,255)";_GP.linkedshapes[ssid].shape.drawShapeToArea(tctx,{dz:factor,dx:_UI.thumbgutter,dy:yoffset})}}function makeSSSubnavButton(ssid){var re="";if(ssid==_UI.shownlinkedshape){re+="<tr class='layersel'"}else{re+="<tr class='layer'"}re+=" onclick='makeLinkedShapeSelected(\""+ssid+"\");'>";re+="<td class='layerthumb'><canvas id='layerthumb"+ssid+"' height='"+_UI.thumbsize+"' width='"+_UI.thumbsize+"'></canvas></td>";re+="<td class='layername'>"+_GP.linkedshapes[ssid].shape.name+"</td></tr>";return re}function makeLinkedShapeSelected(ssid){_UI.shownlinkedshape=ssid;_UI.selectedshape=ssid;_UI.shapelayers=[_GP.linkedshapes[ssid].shape];navigate("npAttributes")}function linkedshapesredraw(calledby){if(_UI.redrawing){debug("LINKEDSHAPESREDRAW - RETURNING because _UI.redrawing = "+_UI.redrawing);return}_UI.redrawing=true;_UI.chareditctx.clearRect(0,0,5e3,5e3);grid();vertical(_UI.chareditcanvassize.makeCrisp());_GP.linkedshapes[_UI.shownlinkedshape].shape.drawShape_Single(_UI.chareditctx);if(_GP.linkedshapes[_UI.selectedshape]){_GP.linkedshapes[_UI.selectedshape].shape.drawSelectOutline()}updateNavPrimaryNavTarget();updatetools();_UI.redrawing=false}function linkedShapeCharDetails(){var content="";if(_GP.linkedshapes[_UI.shownlinkedshape].usedin.length>0){content+="<table style='margin-top:10px;'><tr><td colspan=3><h3>characters that use this linked shape</h3>";content+=generateUsedinThumbs();content+="</td></tr></table>"}else{content+="<table><tr><td>&nbsp;</td><td colspan=2><br><i>this linked shape is not currently being used by any characters. <a href='#' onclick='showAddSSToCharDialog();'>add this linked shape to a character now</a>.</i></td></tr></table>"}return content}function generateUsedinThumbs(){var re="<div class='ssthumbcontainer'>";var ui=_GP.linkedshapes[_UI.shownlinkedshape].usedin;var unique=ui.filter(function(elem,pos){return ui.indexOf(elem)==pos});for(var k=0;k<unique.length;k++){re+="<table cellpadding=0 cellspacing=0 border=0><tr><td>";re+="<canvas id='thumb"+unique[k]+"' class='ssusedinthumb' height="+_UI.thumbsize+"' width="+_UI.thumbsize+" onclick='goToEditChar("+unique[k]*1+");'></canvas>";re+="</td></tr><tr><td>";re+=_GP.fontchars[unique[k]*1].charvalue;re+="</td></tr></table>"}re+="</div>";return re}function goToEditChar(chid){_UI.selectedshape=-1;_UI.selectedchar=chid;_UI.navhere="character edit";_UI.navprimaryhere="npAttributes";navigate()}function drawUsedinThumbs(){var ps=_GP.projectsettings;var ui=_GP.linkedshapes[_UI.shownlinkedshape].usedin;var tctx={};var factor=(_UI.thumbsize-2*_UI.thumbgutter)/ps.upm;var yoffset=_UI.thumbgutter+ps.ascent*factor;for(var k=0;k<ui.length;k++){tctx=document.getElementById("thumb"+ui[k]).getContext("2d");_GP.fontchars[ui[k]].drawCharToArea(tctx,{dz:factor,dx:_UI.thumbgutter,dy:yoffset})}}function updatelinkedshapeactions(){var content="<h1>actions</h1><table class='actionsgrid'><tr>";var s=ss("Update Actions");var allactions="<td><h3>*</h3>";allactions+="<input class='"+(_UI.linkedshapeundoq.length>0?"button":"buttondis")+"' type='button' value='Undo"+(_UI.linkedshapeundoq.length>0?" "+_UI.linkedshapeundoq.length:"")+"' onclick='pullundoq()'><br>";allactions+="<input class='button' type='button' value='Copy' onclick='copyShape()'><br>";allactions+="</td>";var linkedshapeactions="<td><h3>linked shape</h3>";linkedshapeactions+="<input class='button' type='button' value='create new' onclick='addLinkedShape();putundoq(\"Create New Linked Shape\");navigate();'><br>";linkedshapeactions+="<input class='"+(aalength(_GP.linkedshapes)>1?"button":"buttondis")+"' type='button' value='delete' onclick='deleteLinkedShapeConfirm();'><br>";linkedshapeactions+="<input class='button' type='button' value='insert to character' onclick='showAddSSToCharDialog();'><br>";var shapeactions="";if(_UI.eventhandlers.temppathdragshape&&_UI.selectedtool=="pathedit"){shapeactions+="<td><h3>shape</h3>";shapeactions+="<input class='button' type='button' value='Flip Horizontal' onclick='ss().path.flipEW();putundoq(\"Flip Shape Horizontal\");redraw(\"updatelinkedshapeactions\");'><br>";shapeactions+="<input class='button' type='button' value='Flip Vertical' onclick='ss().path.flipNS();putundoq(\"Flip Shape Vertical\");redraw(\"updatelinkedshapeactions\");'><br>";shapeactions+="</td>"}var canvasactions="<td><h3>editor view</h3>";canvasactions+="<input class='button' type='button' value='Toggle Grid' onclick='_UI.showgrid? _UI.showgrid=false : _UI.showgrid=true; redraw(\"updatelinkedshapeactions\");'><br>";canvasactions+="<input class='button' type='button' value='Toggle Guides' onclick='_UI.showguides? _UI.showguides=false : _UI.showguides=true; redraw(\"updatelinkedshapeactions\");'><br>";canvasactions+="</td>";var pointactions="<td><h3>path point</h3>";pointactions+="<input class='button' type='button' value='Insert' onclick='ss().path.insertPathPoint(); putundoq(\"Insert Path Point\"); redraw(\"updatelinkedshapeactions\");'><br>";pointactions+="<input class='"+(s?"button":"buttondis")+"' type='button' value='Delete' onclick='ss().path.deletePathPoint(); putundoq(\"Delete Path Point\"); redraw(\"updatelinkedshapeactions\");'><br>";pointactions+="<input class='button' type='button' value='Reset Handles' onclick='ss().path.sp().resetHandles(); putundoq(\"Reset Path Point\"); redraw(\"updatelinkedshapeactions\");'><br>";pointactions+="</td>";content+=allactions;content+=linkedshapeactions;content+=shapeactions;var ispointsel=false;if(s&&!s.link)ispointsel=s.path.sp(false);if(_UI.selectedtool!="pathedit")ispointsel=false;if(ispointsel){content+=pointactions}else{content+="<td><h3>&nbsp;</h3></td>"}content+="</tr><tr>";content+=canvasactions;content+="</td></tr></table>";return content}function addLinkedShape(){var newid=generateNewSSID();var newname="linkedshape "+_GP.projectsettings.linkedshapecounter;_UI.shownlinkedshape=newid;_UI.selectedshape=newid;_GP.linkedshapes[newid]=new LinkedShape({name:newname})}function deleteLinkedShapeConfirm(){var content="Are you sure you want to delete this linked shape?<br>";var uia=_GP.linkedshapes[_UI.shownlinkedshape].usedin;if(uia.length>0){content+="If you do, the linked shape instances will also be removed from the following characters:<br><br>";for(var ssu=0;ssu<uia.length;ssu++){content+="&nbsp; &nbsp; "+_GP.fontchars[uia[ssu]].charname.replace(/LATIN /gi,"")+"<br>"}}else{content+="This linked shape is not currently being used by any characters.<br>"}content+="<br>Warning: This action cannot be undone!<br>";content+="<br><input type='button' value='permanently delete this linked shape' onclick='deleteLinkedShape();'> &nbsp; <input type='button' value='cancel' onclick='closeDialog();'>";openDialog(content)}function deleteLinkedShape(){closeDialog();if(aalength(_GP.linkedshapes)>1){var uia=_GP.linkedshapes[_UI.shownlinkedshape].usedin;for(var cui=0;cui<uia.length;cui++){var tc=_GP.fontchars[uia[cui]].charshapes;for(var sl=0;sl<tc.length;sl++){if(tc[sl].link==_UI.shownlinkedshape){tc.splice(sl,1)}}}delete _GP.linkedshapes[_UI.shownlinkedshape];_UI.shownlinkedshape=getFirstLinkedShape();_UI.selectedshape=_UI.shownlinkedshape;navigate()}else{alert("Error: deleting the last linked shape should not have been an allowed action.")}}function pasteLinkedShape(){if(_UI.clipboardshape){_GP.linkedshapes[_UI.shownlinkedshape].shape=_UI.clipboardshape}}function showAddSSToCharDialog(msg){var content="<table style='width:756px'><tr><td>";content+=msg?msg:"There is currently "+_GP.linkedshapes[_UI.shownlinkedshape].usedin.length+" instances of '"+_GP.linkedshapes[_UI.shownlinkedshape].shape.name+"' being used.<br><br>";content+="Select the character into which you would like to insert this linked shape:<br><br></td></tr>";content+="<tr><td>";content+=updateselectchar("insertLinkedShapeToChar");content+="</td></tr>";content+="<tr><td><br><input type='button' class='button' value='done' onclick='closeDialog();'/></td></tr></table>";openDialog(content);drawselectcharthumbs()}function insertLinkedShapeToChar(chid){var temschar=_UI.selectedchar;selectchar(chid,true);insertLinkedShape(_UI.shownlinkedshape);_UI.selectedchar=temschar;putundoq("Insert Linked Shape to Character");closeDialog();showAddSSToCharDialog("The LinkedShape '"+_GP.linkedshapes[_UI.shownlinkedshape].shape.name+"' was successfully inserted into character "+_GP.fontchars[chid].charname+".<br><br>")}function loadPage_openproject(){debug("LOADING PAGE >> loadPage_openproject");var ct="<div class='pagecontent textpage'><h1>Open Project</h1>"+"<h2>But wait!</h2>If you open a new project, your current project will be lost.  Be sure to download a Glyphr "+"project file if you want to save your current project.<br><br>		<input type='button' class='button'style='padding:10px;' value='Save current project' onclick='triggerProjectFileDownload();'/><br><br>"+"<h2>Okay, now...</h2>";ct+=importOrCreateNew();ct+="</div>";document.getElementById("mainpane").innerHTML=ct;document.getElementById("droptarget").addEventListener("dragover",handleDragOver,false);
document.getElementById("droptarget").addEventListener("drop",handleDrop,false)}function loadPage_firstrun(){debug("LOADING PAGE >> loadPage_firstrun");var ct="<div class='splashscreen textpage'><canvas id='splashscreencanvas' height=494 width=800></canvas>";ct+="<div class='splashver'>"+_UI.thisGlyphrStudioVersion+"<br><br>";ct+="For more informaiton visit <a href='http://www.glyphrstudio.com' target=_new>www.glyphrstudio.com</a><br>";ct+="Glyphr Studio is licensed under a <a href='http://creativecommons.org/licenses/by-sa/3.0/' target=_new>Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.<br>";ct+="Which basically means you can use Glyphr Studio for commercial purposes, remix and adapt Glyphr Studio to your own needs, and re-share Glyphr Studio with the same license applied.";ct+="</div>";ct+=importOrCreateNew();ct+="</div>";var mp=document.getElementById("mainpane");mp.innerHTML=ct;mp.style.marginLeft="0px";document.getElementById("navprimarypane").style.display="none";document.getElementById("navtargetpane").style.display="none";document.getElementById("logocanvas").style.display="none";document.getElementById("droptarget").addEventListener("dragover",handleDragOver,false);document.getElementById("droptarget").addEventListener("drop",handleDrop,false);drawSplashScreen()}function handleDrop(evt){evt.stopPropagation();evt.preventDefault();var f=evt.dataTransfer.files[0];var reader=new FileReader;var fcontent="";document.getElementById("droptarget").innerHTML="Loading File...";reader.onload=function(theFile){return function(e){fcontent=JSON.parse(reader.result);if(fcontent.projectsettings.version){hydrateGlyphrProject(fcontent)}else{document.getElementById("droptarget").innerHTML="drop file here...";alert("File does not appear to be a Glyphr Project, try again...")}}}(f);reader.readAsText(f)}function hydrateGlyphrProject(data){_GP=clone(_UI.default_GP);if(data.projectsettings)_GP.projectsettings=clone(data.projectsettings);if(data.opentypeproperties)_GP.opentypeproperties=clone(data.opentypeproperties);for(var ssid in data.linkedshapes){if(data.linkedshapes.hasOwnProperty(ssid)){_GP.linkedshapes[ssid]=new LinkedShape(data.linkedshapes[ssid])}}for(var i=0;i<data.fontchars.length;i++){if(data.fontchars[i]){_GP.fontchars[i*1]=new Char(data.fontchars[i])}}finalizeGlyphrProject()}function handleDragOver(evt){evt.stopPropagation();evt.preventDefault();evt.dataTransfer.dropEffect="copy"}function importOrCreateNew(){var con="<table style='width:100%;'><tr><td style='padding-right:50px; width:45%;'>"+"<h3>Load an existing Glyphr Project</h3>"+"<div id='droptarget'>drop file here...</div>"+"</td><td style='width:9%'>&nbsp;</td>"+"</td><td style='width:45%;'>"+"<h3>Start a new Glyphr Project</h3>"+"Project name: &nbsp; <input id='newprojectname' type='text' value='My Font'/><br>"+"<input type='button' class='buttonsel' value=' Start a new font from scratch ' onclick='newGlyphrProject()'><br><br>"+"</td></tr></table>";return con}function newGlyphrProject(){var fn=document.getElementById("newprojectname").value;fn=fn?fn:"My Font";_GP=clone(_UI.default_GP);_GP.projectsettings.name=fn;_GP.opentypeproperties.name[1].val=fn;_GP.opentypeproperties.name[3].val=fn+" 1.0";_GP.opentypeproperties.name[4].val=fn;_GP.opentypeproperties.name[6].val=fn;setOTprop("cff","FullName",fn);setOTprop("cff","FamilyName",fn);setOTprop("head","created",ttxDateString());_GP.projectsettings.version=_UI.thisGlyphrStudioVersion;_GP.fontchars=createNewFontcharsArray();_GP.linkedshapes={};_GP.linkedshapes["id0"]=new LinkedShape({shape:new Shape({})});finalizeGlyphrProject()}function finalizeGlyphrProject(){_UI.charcurrstate=clone(_GP.fontchars);_UI.linkcurrstate=clone(_GP.linkedshapes);if(!isval(_GP.projectsettings.linkedshapecounter)){_GP.projectsettings.linkedshapecounter=0}_UI.selectedchar=97;_UI.shownlinkedshape=getFirstLinkedShape();resetThumbView();_UI.navhere="character edit";navigate()}function loadPage_projectsettings(){debug("LOADING PAGE >> loadPage_projectsettings");var ps=_GP.projectsettings;var content="<div class='pagecontent textpage'><h1>Project Settings</h1>";content+="These project and interface settings will be saved with your Glyphr project file.";content+="<h2>Project Name</h2>"+"The Font Name and the Project name can be different, but they start out the same.  The Font Name details can be changed on the Font Settings page."+"<table class='fontmetricstable'>"+"<tr><td>Project Name:</td><td><input type='text' style='width:100%' value='"+ps.name+"' onchange='_GP.projectsettings.name = this.value;' /></td></tr>"+"</table><br>";content+="<h2>Grids and Guides</h2>";content+="<h3>Grid System</h3>";content+="Defining a grid system to use while editing characters in this font makes stuff a whole "+"lot easier.  This number is the number of vertical and horizontal divisions to use, it should "+"divide evenly into the Units per Em.<br>"+"<table class='fontmetricstable'>"+"<tr><td>Units per Em:</td><td><input type='text' disabled='disabled' value='"+ps.upm+"'/></td><td><span class='unit'>(total)</span></td></tr>"+"<tr><td>Grid Divisions</td><td><input type='text' value='"+ps.griddivisions+"' onchange='updateGridDivisions(this.value);'/>"+spinner()+"</td><td><span class='unit'>(number)</span></td></tr>"+"<tr><td>Grid Square Size:</td><td><input type='text' id='metirc-ssize' disabled='disabled' value='"+ps.upm/ps.griddivisions+"'/></td><td><span class='unit'>(em units)</span></td></tr>"+"</table><br>";content+="<h3>x Height</h3>";content+="X-height is the distance between the baseline, and the top of lowercase letters.<br>"+"<table class='fontmetricstable'>"+"<tr><td>x Height: </td><td><input type='text' id='metric-xheight' value='"+ps.xheight+"' onchange='_GP.projectsettings.xheight = this.value'>"+spinner()+"</td><td><span class='unit'>(em units)</span></td></tr>"+"</table><br>";content+="<h3>Overshoot</h3>";content+="Round letters usually extend a little above the x height line and below the baseline. "+"A light guideline will show this overshoot distance.<br>"+"<table class='fontmetricstable'>"+"<tr><td>Overshoot:</td><td><input type='text' value='"+ps.overshoot+"' onchange='_GP.projectsettings.overshoot = this.value);'>"+spinner()+"</td><td><span class='unit'>(em units)</span></td></tr>"+"</table><br>";content+="</div>";document.getElementById("mainpane").innerHTML=content}function updateGridDivisions(val){var ps=_GP.projectsettings;ps.griddivisions=Math.min(ps.upm,Math.max(1,val));document.getElementById("metirc-ssize").value=ps.upm/ps.griddivisions}function loadPage_testdrive(){debug("LOADING PAGE >> loadPage_testdrive");var content="<div class='pagecontent'><h1>Test Drive</h1>"+"<textarea id='tdtextarea' onkeyup='updateTestdriveCanvas()'></textarea><br>"+"<canvas id='tdcanvas'></canvas><br>"+"<div id='genimg' style='display:none;'></div></div>";document.getElementById("mainpane").innerHTML=content;document.getElementById("tdtextarea").focus();_UI.testdrivecanvas=document.getElementById("tdcanvas");_UI.testdrivecanvas.width=800;_UI.testdrivecanvas.height=700;_UI.testdrivectx=_UI.testdrivecanvas.getContext("2d");if(_UI.navprimaryhere=="npAttributes")changefontscale(100)}function updatetestdriveoptions(){if(_UI.navprimaryhere!="npAttributes")return;var content="<h1>settings</h1><h2>sample text</h2><div>"+drawSampletextButtons()+"</div>";content+="<br><h2>options</h2><div>"+drawTDOptions()+"</div>";content+="</td></tr></table></div>";return content}function updateTestdriveCanvas(){var text=document.getElementById("tdtextarea").value;var tctx=_UI.testdrivectx;var ps=_GP.projectsettings;var scale=_UI.testdrive_fontscale;var contentArray=text.split("");var textEm=_GP.projectsettings.upm*scale;var currx=_UI.testdrive_padsize;var curry=_UI.testdrive_padsize+ps.ascent*scale;var cc;tctx.clearRect(0,0,5e3,5e3);_UI.testdrive_showhorizontals?drawLine(curry):false;for(var k=0;k<contentArray.length;k++){if(contentArray[k]=="\n"){currx=_UI.testdrive_padsize;curry+=textEm;curry+=document.getElementById("linegap").value*1*scale;_UI.testdrive_showhorizontals?drawLine(curry):false}else{cc=getCharFromText(contentArray[k]);if(cc){if(_UI.testdrive_showcharbox){tctx.fillStyle="transparent";tctx.strokeStyle=_UI.colors.accent;tctx.lineWidth=1;tctx.strokeRect(currx.makeCrisp(),curry.makeCrisp()-ps.ascent*scale,Math.round(cc.charwidth*scale),Math.round(textEm))}currx+=cc.drawCharToArea(tctx,{dz:_UI.testdrive_fontscale,dx:currx,dy:curry});currx+=document.getElementById("charspacing").value*1*scale}}}}function drawLine(y){y=y.makeCrisp();_UI.testdrivectx.strokeStyle=_UI.colors.accent;_UI.testdrivectx.beginPath();_UI.testdrivectx.lineWidth=1;_UI.testdrivectx.moveTo(0,y);_UI.testdrivectx.lineTo(_UI.testdrivecanvas.width,y);_UI.testdrivectx.stroke();_UI.testdrivectx.closePath()}function drawSampletextButtons(){var content="<h3>pangrams</h3>";content+=makeTDButton("the five boxing wizards jump quickly");content+=makeTDButton("pack my box with five dozen liquor jugs");content+=makeTDButton("the quick brown fox jumps over a lazy dog");content+=makeTDButton("amazingly few discotheques provide jukeboxes");content+=makeTDButton("quick enemy movement will jeopardize six of the gunboats");content+="<h3>character sets</h3>";content+=makeTDButton("abcdefghijklmnopqrstuvwxyz");content+=makeTDButton("ABCDEFGHIJKLMNOPQRSTUVWXYZ");content+=makeTDButton("0123456789");content+=makeTDSymbolButton();return content}function makeTDButton(text){return"<input type='button' class='button' onclick='document.getElementById(\"tdtextarea\").value=\""+text+"\";updateTestdriveCanvas();' value='"+text+"'><br>"}function makeTDSymbolButton(){return"<input type='button' class='button' onclick='document.getElementById(\"tdtextarea\").value=\"!\\\"#$%&&#39;()*+,-./:;\\<=\\>?@[\\\\]^_`{|}~\";updateTestdriveCanvas();' value='!\"#$%&&#39;()*+,-./:;<=>?@[\\]^_`{|}~'><br>"}function drawTDOptions(){var content="<table class='detail'>";content+="<tr><td> font size <span class='unit'>(px)</span> </td><td><input class='input' type='text' value='100' onchange='changefontscale(this.value); updateTestdriveCanvas();'>"+spinner()+"</td></tr>";content+="<tr><td> 96dpi font size <span class='unit'>(pt)</span> </td><td id='roughptsize'>75</td></tr>";content+="<tr><td> line gap <span class='unit'>(em units)</span> </td><td><input class='input' id='linegap' type='text' value='"+_GP.projectsettings.linegap+"' onchange='updateTestdriveCanvas();'>"+spinner()+"</td></tr>";content+="<tr><td> character spacing <span class='unit'>(em units)</span> </td><td><input class='input' id='charspacing' type='text' value='0' onchange='updateTestdriveCanvas();'>"+spinner()+"</td></tr>";content+="<tr><td> show character boxes </td><td><input type='checkbox'"+(_UI.testdrive_showcharbox?" checked ":"")+" onchange='_UI.testdrive_showcharbox = this.checked; updateTestdriveCanvas();'></td></tr>";content+="<tr><td> show baseline </td><td><input type='checkbox'"+(_UI.testdrive_showhorizontals?" checked ":"")+" onchange='_UI.testdrive_showhorizontals = this.checked; updateTestdriveCanvas();'></td></tr>";content+="<tr><td colspan=2><input type='button' class='button' value='generate png file' onclick='createimg();'></td></tr>";content+="</table>";return content}function changefontscale(newval){_UI.testdrive_fontscale=newval/_GP.projectsettings.upm;document.getElementById("roughptsize").innerHTML=newval*.75}function createimg(){var imgd=document.getElementById("tdcanvas").toDataURL();var win=window.open(document.location.href,"Glyphr Test Drive");win.document.write("<!DOCTYPE html><html>"+"<head><title>Glyphr - Test Drive Image</title></head>"+'<body style="padding:40px; text-align:center;">'+'<img src="'+imgd+'" title="Glyphr Test Drive" style="border:1px solid #f6f6f6;">'+"</html>")}function drawLogo(){logoctx=document.getElementById("logocanvas").getContext("2d");logoctx.clearRect(0,0,3e3,3e3);logoctx.strokeStyle=_UI.colors.accent;logoctx.beginPath();logoctx.moveTo(37,41);logoctx.lineTo(37,2);logoctx.lineTo(40.8,2);logoctx.lineWidth=4;logoctx.stroke();logoctx.beginPath();logoctx.moveTo(2,30);logoctx.bezierCurveTo(2,43.3,31,43.3,31,30);logoctx.bezierCurveTo(31,11,2,11,2,30);logoctx.closePath();logoctx.stroke();logoctx.beginPath();logoctx.moveTo(31,30);logoctx.lineTo(31,46);logoctx.bezierCurveTo(31,59.3,2,59.3,2,46);logoctx.lineTo(6,46);logoctx.stroke();logoctx.beginPath();logoctx.moveTo(72,30);logoctx.bezierCurveTo(72,43.3,43,43.3,43,30);logoctx.lineTo(43,16);logoctx.lineTo(47,16);logoctx.stroke();logoctx.beginPath();logoctx.moveTo(47,46);logoctx.lineTo(43,46);logoctx.bezierCurveTo(43,59.3,72,59.3,72,46);logoctx.lineTo(72,30);logoctx.lineTo(72,14);logoctx.stroke();logoctx.beginPath();logoctx.moveTo(107,30);logoctx.bezierCurveTo(107,43.3,78,43.3,78,30);logoctx.bezierCurveTo(78,11,107,11,107,30);logoctx.closePath();logoctx.stroke();logoctx.beginPath();logoctx.moveTo(78,30);logoctx.lineTo(78,56);logoctx.lineTo(81.9,56);logoctx.stroke();logoctx.beginPath();logoctx.moveTo(142,42);logoctx.lineTo(142,30);logoctx.bezierCurveTo(142,11,113,11,113,30);logoctx.lineTo(113,40);logoctx.lineTo(117,40);logoctx.stroke();logoctx.beginPath();logoctx.moveTo(113,28);logoctx.lineTo(113,2);logoctx.lineTo(116.9,2);logoctx.stroke();logoctx.beginPath();logoctx.moveTo(177,30);logoctx.bezierCurveTo(177,11,148,11,148,30);logoctx.lineTo(148,40);logoctx.lineTo(152,40);logoctx.stroke();logoctx.fillStyle=_UI.colors.accent_light;logoctx.beginPath();logoctx.moveTo(148,49);logoctx.lineTo(149,49);logoctx.lineTo(149,48);logoctx.lineTo(148,48);logoctx.lineTo(148,49);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(148,46);logoctx.lineTo(148,47);logoctx.lineTo(149,47);logoctx.lineTo(149,46);logoctx.lineTo(148,46);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(161,47);logoctx.lineTo(161,46);logoctx.lineTo(160,46);logoctx.lineTo(160,47);logoctx.lineTo(161,47);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(146,44);logoctx.lineTo(146,51);logoctx.lineTo(163,51);logoctx.lineTo(163,44);logoctx.lineTo(146,44);logoctx.closePath();logoctx.moveTo(150,47);logoctx.lineTo(149,47);logoctx.lineTo(149,48);logoctx.lineTo(150,48);logoctx.lineTo(150,49);logoctx.lineTo(149,49);logoctx.lineTo(149,50);logoctx.lineTo(148,50);logoctx.lineTo(147,50);logoctx.lineTo(147,45);logoctx.lineTo(148,45);logoctx.lineTo(149,45);logoctx.lineTo(149,46);logoctx.lineTo(150,46);logoctx.lineTo(150,47);logoctx.closePath();logoctx.moveTo(154,46);logoctx.lineTo(152,46);logoctx.lineTo(152,47);logoctx.lineTo(153,47);logoctx.lineTo(153,48);logoctx.lineTo(152,48);logoctx.lineTo(152,49);logoctx.lineTo(154,49);logoctx.lineTo(154,50);logoctx.lineTo(152,50);logoctx.lineTo(151,50);logoctx.lineTo(151,45);logoctx.lineTo(152,45);logoctx.lineTo(154,45);logoctx.lineTo(154,46);logoctx.closePath();logoctx.moveTo(158,46);logoctx.lineTo(157,46);logoctx.lineTo(157,50);logoctx.lineTo(156,50);logoctx.lineTo(156,46);logoctx.lineTo(155,46);logoctx.lineTo(155,45);logoctx.lineTo(158,45);logoctx.lineTo(158,46);logoctx.closePath();logoctx.moveTo(162,50);logoctx.lineTo(161,50);logoctx.lineTo(161,48);logoctx.lineTo(160,48);logoctx.lineTo(160,50);logoctx.lineTo(159,50);logoctx.lineTo(159,46);logoctx.lineTo(160,46);logoctx.lineTo(160,45);logoctx.lineTo(161,45);logoctx.lineTo(161,46);logoctx.lineTo(162,46);logoctx.lineTo(162,50);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(164,45);logoctx.lineTo(164,46);logoctx.lineTo(165,46);logoctx.lineTo(165,45);logoctx.lineTo(164,45);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(168,45);logoctx.lineTo(168,46);logoctx.lineTo(169,46);logoctx.lineTo(169,45);logoctx.lineTo(168,45);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(167,46);logoctx.lineTo(167,47);logoctx.lineTo(168,47);logoctx.lineTo(168,46);logoctx.lineTo(167,46);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(166,47);logoctx.lineTo(166,48);logoctx.lineTo(168,48);logoctx.lineTo(168,47);logoctx.lineTo(166,47);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(164,49);logoctx.lineTo(164,50);logoctx.lineTo(165,50);logoctx.lineTo(165,49);logoctx.lineTo(164,49);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(165,50);logoctx.lineTo(165,51);logoctx.lineTo(168,51);logoctx.lineTo(168,50);logoctx.lineTo(165,50);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(168,47);logoctx.lineTo(168,50);logoctx.lineTo(169,50);logoctx.lineTo(169,47);logoctx.lineTo(168,47);logoctx.closePath();logoctx.fill();logoctx.beginPath();logoctx.moveTo(165,44);logoctx.lineTo(165,45);logoctx.lineTo(168,45);logoctx.lineTo(168,44);logoctx.lineTo(165,44);logoctx.closePath();logoctx.fill()}function drawSplashScreen(){ssctx=document.getElementById("splashscreencanvas").getContext("2d");ssctx.clearRect(0,0,3e3,3e3);ssctx.fillStyle=_UI.colors.accent;ssctx.save();ssctx.beginPath();ssctx.moveTo(800,494);ssctx.lineTo(0,494);ssctx.lineTo(0,0);ssctx.lineTo(800,0);ssctx.lineTo(800,494);ssctx.closePath();ssctx.fill();ssctx.strokeStyle=_UI.colors.offwhite;ssctx.save();ssctx.beginPath();ssctx.moveTo(260.2,219.6);ssctx.lineTo(260.2,121.3);ssctx.lineTo(270.6,121.3);ssctx.lineWidth=10.5;ssctx.stroke();ssctx.beginPath();ssctx.moveTo(167,188.6);ssctx.bezierCurveTo(167,224.8,244.7,224.8,244.7,188.6);ssctx.bezierCurveTo(244.7,136.8,167,136.8,167,188.6);ssctx.closePath();ssctx.stroke();ssctx.beginPath();ssctx.moveTo(244.7,188.6);ssctx.lineTo(244.7,224.8);ssctx.bezierCurveTo(244.7,261.1,167,261.1,167,224.8);ssctx.lineTo(177.4,224.8);ssctx.stroke();ssctx.beginPath();ssctx.moveTo(368.9,188.6);ssctx.lineTo(368.9,250.7);ssctx.lineTo(379.3,250.7);ssctx.stroke();ssctx.beginPath();ssctx.moveTo(446.6,188.6);ssctx.bezierCurveTo(446.6,224.8,368.9,224.8,368.9,188.6);ssctx.bezierCurveTo(368.9,136.8,446.6,136.8,446.6,188.6);ssctx.closePath();ssctx.stroke();ssctx.beginPath();ssctx.moveTo(565.7,214.5);ssctx.lineTo(555.3,214.5);ssctx.lineTo(555.3,188.6);ssctx.bezierCurveTo(555.3,136.8,633,136.8,633,188.6);ssctx.stroke();ssctx.beginPath();ssctx.moveTo(353.4,147.2);ssctx.lineTo(353.4,224.8);ssctx.bezierCurveTo(353.4,261.1,275.7,261.1,275.7,224.8);ssctx.lineTo(286.1,224.8);ssctx.stroke();ssctx.beginPath();ssctx.moveTo(275.7,188.6);ssctx.bezierCurveTo(275.7,224.8,353.3,224.8,353.3,188.6);ssctx.lineWidth=10.2;ssctx.stroke();ssctx.beginPath();ssctx.moveTo(275.7,189.8);ssctx.lineTo(275.7,152.3);ssctx.lineTo(286.1,152.3);ssctx.lineWidth=10.5;ssctx.stroke();ssctx.beginPath();ssctx.moveTo(472.5,121.3);ssctx.lineTo(462.1,121.3);ssctx.lineTo(462.1,214.5);ssctx.lineTo(472.5,214.5);ssctx.stroke();ssctx.beginPath();ssctx.moveTo(462.1,188.6);ssctx.bezierCurveTo(462.1,136.8,539.8,136.8,539.8,188.6);ssctx.lineTo(539.8,219.6);ssctx.stroke();ssctx.restore();ssctx.save();ssctx.fillStyle=_UI.colors.accent_light;ssctx.beginPath();ssctx.moveTo(554.2,240.1);ssctx.bezierCurveTo(553.2,240.1,552.4,240,551.6,239.8);ssctx.bezierCurveTo(550.9,239.6,550.3,239.3,549.6,239);ssctx.lineTo(549.6,236.6);ssctx.lineTo(549.8,236.6);ssctx.bezierCurveTo(550.4,237.2,551.1,237.7,551.9,238);ssctx.bezierCurveTo(552.6,238.3,553.4,238.5,554.1,238.5);ssctx.bezierCurveTo(555.2,238.5,555.9,238.2,556.5,237.8);ssctx.bezierCurveTo(557,237.4,557.3,236.8,557.3,236.1);ssctx.bezierCurveTo(557.3,235.5,557.1,235.1,556.8,234.7);ssctx.bezierCurveTo(556.6,234.4,556.1,234.1,555.5,233.9);ssctx.bezierCurveTo(555.1,233.8,554.7,233.7,554.3,233.6);ssctx.bezierCurveTo(554,233.6,553.5,233.4,553,233.3);ssctx.bezierCurveTo(552.5,233.2,552.1,233,551.7,232.8);ssctx.bezierCurveTo(551.3,232.6,550.9,232.4,550.6,232.1);ssctx.bezierCurveTo(550.4,231.7,550.1,231.4,550,231);ssctx.bezierCurveTo(549.8,230.5,549.7,230.1,549.7,229.5);ssctx.bezierCurveTo(549.7,228.4,550.2,227.4,551.1,226.6);ssctx.bezierCurveTo(551.9,225.9,553.1,225.5,554.5,225.5);ssctx.bezierCurveTo(555.3,225.5,556,225.6,556.7,225.7);ssctx.bezierCurveTo(557.4,225.9,558.1,226.1,558.7,226.4);ssctx.lineTo(558.7,228.6);ssctx.lineTo(558.5,228.6);ssctx.bezierCurveTo(558.1,228.2,557.5,227.9,556.8,227.6);ssctx.bezierCurveTo(556.1,227.3,555.4,227.1,554.6,227.1);ssctx.bezierCurveTo(553.7,227.1,553,227.3,552.5,227.7);ssctx.bezierCurveTo(551.9,228.1,551.7,228.6,551.7,229.3);ssctx.bezierCurveTo(551.7,229.9,551.8,230.4,552.1,230.7);ssctx.bezierCurveTo(552.5,231.1,552.9,231.4,553.5,231.5);ssctx.bezierCurveTo(553.9,231.6,554.4,231.7,555,231.9);ssctx.bezierCurveTo(555.6,232,556,232.1,556.4,232.3);ssctx.bezierCurveTo(557.4,232.6,558.1,233,558.5,233.6);ssctx.bezierCurveTo(559,234.2,559.2,234.9,559.2,235.8);ssctx.bezierCurveTo(559.2,236.4,559.1,236.9,558.9,237.4);ssctx.bezierCurveTo(558.6,238,558.3,238.4,557.9,238.8);ssctx.bezierCurveTo(557.5,239.2,557,239.5,556.4,239.7);ssctx.bezierCurveTo(555.8,240,555.1,240.1,554.2,240.1);ssctx.closePath();ssctx.fill();ssctx.beginPath();ssctx.moveTo(564.4,239.8);ssctx.lineTo(564.4,227.4);ssctx.lineTo(559.7,227.4);ssctx.lineTo(559.7,225.7);ssctx.lineTo(571,225.7);ssctx.lineTo(571,227.4);ssctx.lineTo(566.3,227.4);ssctx.lineTo(566.3,239.8);ssctx.lineTo(564.4,239.8);ssctx.closePath();ssctx.fill();ssctx.beginPath();ssctx.moveTo(577.4,240.1);ssctx.bezierCurveTo(576.5,240.1,575.8,240,575.2,239.8);ssctx.bezierCurveTo(574.6,239.6,574,239.3,573.6,238.8);ssctx.bezierCurveTo(573.1,238.3,572.8,237.7,572.6,237.1);ssctx.bezierCurveTo(572.4,236.4,572.3,235.5,572.3,234.5);ssctx.lineTo(572.3,225.7);ssctx.lineTo(574.1,225.7);ssctx.lineTo(574.1,234.5);ssctx.bezierCurveTo(574.1,235.2,574.2,235.7,574.3,236.2);ssctx.bezierCurveTo(574.3,236.6,574.5,237,574.7,237.4);ssctx.bezierCurveTo(575,237.7,575.3,238,575.8,238.2);ssctx.bezierCurveTo(576.2,238.4,576.7,238.5,577.4,238.5);ssctx.bezierCurveTo(577.9,238.5,578.5,238.4,578.9,238.2);ssctx.bezierCurveTo(579.4,238,579.7,237.7,580,237.4);ssctx.bezierCurveTo(580.2,237,580.4,236.6,580.5,236.2);ssctx.bezierCurveTo(580.5,235.7,580.6,235.2,580.6,234.6);ssctx.lineTo(580.6,225.7);ssctx.lineTo(582.5,225.7);ssctx.lineTo(582.5,234.5);ssctx.bezierCurveTo(582.5,235.5,582.4,236.3,582.2,237);ssctx.bezierCurveTo(582,237.7,581.6,238.3,581.1,238.8);ssctx.bezierCurveTo(580.7,239.3,580.1,239.6,579.5,239.8);ssctx.bezierCurveTo(578.9,240,578.2,240.1,577.4,240.1);ssctx.closePath();ssctx.fill();ssctx.beginPath();ssctx.moveTo(596.3,232.8);ssctx.bezierCurveTo(596.3,234.1,596,235.2,595.5,236.3);ssctx.bezierCurveTo(595,237.3,594.3,238.1,593.4,238.7);ssctx.bezierCurveTo(592.7,239.1,591.9,239.4,591.2,239.6);ssctx.bezierCurveTo(590.5,239.7,589.5,239.8,588.4,239.8);ssctx.lineTo(585.1,239.8);ssctx.lineTo(585.1,225.7);ssctx.lineTo(588.4,225.7);ssctx.bezierCurveTo(589.7,225.7,590.7,225.8,591.5,226);ssctx.bezierCurveTo(592.2,226.2,592.9,226.5,593.4,226.9);ssctx.bezierCurveTo(594.3,227.5,595,228.2,595.5,229.2);ssctx.bezierCurveTo(596,230.2,596.3,231.4,596.3,232.8);ssctx.closePath();ssctx.moveTo(594.3,232.8);ssctx.bezierCurveTo(594.3,231.7,594.1,230.8,593.8,230);ssctx.bezierCurveTo(593.4,229.2,592.9,228.6,592.2,228.2);ssctx.bezierCurveTo(591.7,227.9,591.1,227.7,590.6,227.5);ssctx.bezierCurveTo(590,227.4,589.3,227.3,588.4,227.3);ssctx.lineTo(587,227.3);ssctx.lineTo(587,238.2);ssctx.lineTo(588.4,238.2);ssctx.bezierCurveTo(589.3,238.2,590,238.1,590.6,238);ssctx.bezierCurveTo(591.3,237.9,591.8,237.6,592.3,237.3);ssctx.bezierCurveTo(593,236.8,593.5,236.2,593.8,235.5);ssctx.bezierCurveTo(594.1,234.8,594.3,233.9,594.3,232.8);ssctx.closePath();ssctx.fill();ssctx.beginPath();ssctx.moveTo(603.2,239.8);ssctx.lineTo(597.7,239.8);ssctx.lineTo(597.7,238.4);ssctx.lineTo(599.5,238.4);ssctx.lineTo(599.5,227.2);ssctx.lineTo(597.7,227.2);ssctx.lineTo(597.7,225.7);ssctx.lineTo(603.2,225.7);ssctx.lineTo(603.2,227.2);ssctx.lineTo(601.4,227.2);ssctx.lineTo(601.4,238.4);ssctx.lineTo(603.2,238.4);ssctx.lineTo(603.2,239.8);ssctx.closePath();ssctx.fill();ssctx.beginPath();ssctx.moveTo(615.5,227.4);ssctx.bezierCurveTo(616,228,616.4,228.7,616.7,229.7);ssctx.bezierCurveTo(617,230.6,617.2,231.6,617.2,232.8);ssctx.bezierCurveTo(617.2,233.9,617,235,616.7,235.9);ssctx.bezierCurveTo(616.4,236.8,616,237.6,615.5,238.2);ssctx.bezierCurveTo(614.9,238.9,614.2,239.3,613.5,239.6);ssctx.bezierCurveTo(612.7,240,611.9,240.1,610.9,240.1);ssctx.bezierCurveTo(610,240.1,609.1,240,608.4,239.6);ssctx.bezierCurveTo(607.6,239.3,606.9,238.8,606.4,238.2);ssctx.bezierCurveTo(605.9,237.6,605.4,236.8,605.1,235.9);ssctx.bezierCurveTo(604.9,235,604.7,233.9,604.7,232.8);ssctx.bezierCurveTo(604.7,231.6,604.9,230.6,605.2,229.7);ssctx.bezierCurveTo(605.4,228.8,605.9,228,606.4,227.4);ssctx.bezierCurveTo(606.9,226.7,607.6,226.3,608.4,225.9);ssctx.bezierCurveTo(609.1,225.6,610,225.4,610.9,225.4);ssctx.bezierCurveTo(611.9,225.4,612.8,225.6,613.5,225.9);ssctx.bezierCurveTo(614.3,226.3,614.9,226.7,615.5,227.4);ssctx.closePath();ssctx.moveTo(615.2,232.8);ssctx.bezierCurveTo(615.2,231.9,615.1,231,614.9,230.3);ssctx.bezierCurveTo(614.7,229.6,614.4,229,614.1,228.5);ssctx.bezierCurveTo(613.7,228,613.2,227.7,612.7,227.4);ssctx.bezierCurveTo(612.2,227.2,611.6,227.1,610.9,227.1);ssctx.bezierCurveTo(610.3,227.1,609.7,227.2,609.2,227.4);ssctx.bezierCurveTo(608.7,227.7,608.2,228,607.8,228.5);ssctx.bezierCurveTo(607.4,229,607.2,229.6,607,230.3);ssctx.bezierCurveTo(606.8,231,606.7,231.9,606.7,232.8);ssctx.bezierCurveTo(606.7,234.6,607,236,607.8,237);ssctx.bezierCurveTo(608.6,238,609.6,238.5,610.9,238.5);ssctx.bezierCurveTo(612.3,238.5,613.3,238,614.1,237);ssctx.bezierCurveTo(614.8,236,615.2,234.6,615.2,232.8);ssctx.closePath();ssctx.fill();ssctx.restore();ssctx.restore()}function draw_primaryNav_navigate(lctx,fill){lctx.fillStyle=fill;lctx.strokeStyle=fill;lctx.save();lctx.beginPath();lctx.moveTo(24,0);lctx.lineTo(29,19);lctx.lineTo(24,24);lctx.lineTo(24,0);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(24,0);lctx.lineTo(19,19);lctx.lineTo(24,24);lctx.lineTo(24,0);lctx.closePath();lctx.lineWidth=.3;lctx.stroke();lctx.beginPath();lctx.moveTo(10,10);lctx.lineTo(19,19);lctx.lineTo(15,20);lctx.lineTo(10,10);lctx.closePath();lctx.stroke();lctx.beginPath();lctx.moveTo(10,38);lctx.lineTo(19,29);lctx.lineTo(20,33);lctx.lineTo(10,38);lctx.closePath();lctx.stroke();lctx.beginPath();lctx.moveTo(24,48);lctx.lineTo(29,29);lctx.lineTo(24,24);lctx.lineTo(24,48);lctx.closePath();lctx.stroke();lctx.beginPath();lctx.moveTo(48,24);lctx.lineTo(29,19);lctx.lineTo(24,24);lctx.lineTo(48,24);lctx.closePath();lctx.stroke();lctx.beginPath();lctx.moveTo(0,24);lctx.lineTo(19,29);lctx.lineTo(24,24);lctx.lineTo(0,24);lctx.closePath();lctx.stroke();lctx.beginPath();lctx.moveTo(24,24);lctx.lineTo(48,24);lctx.lineTo(29,29);lctx.lineTo(24,24);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(24,24);lctx.lineTo(24,48);lctx.lineTo(19,29);lctx.lineTo(24,24);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(24,24);lctx.lineTo(0,24);lctx.lineTo(19,19);lctx.lineTo(24,24);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(20,15);lctx.lineTo(10,10);lctx.lineTo(19,19);lctx.lineTo(20,15);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(15,28);lctx.lineTo(10,38);lctx.lineTo(19,29);lctx.lineTo(15,28);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(28,33);lctx.lineTo(38,38);lctx.lineTo(29,29);lctx.lineTo(28,33);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(33,20);lctx.lineTo(38,10);lctx.lineTo(29,19);lctx.lineTo(33,20);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(29,19);lctx.lineTo(38,10);lctx.lineTo(28,15);lctx.lineTo(29,19);lctx.closePath();lctx.stroke();lctx.beginPath();lctx.moveTo(38,38);lctx.lineTo(29,29);lctx.lineTo(33,28);lctx.lineTo(38,38);lctx.closePath();lctx.stroke();lctx.restore()}function draw_primaryNav_character(lctx,fill){lctx.fillStyle=fill;lctx.beginPath();lctx.moveTo(13.6,17.2);lctx.lineTo(13.6,19.6);lctx.lineTo(8.9,19.6);lctx.lineTo(8.9,17.9);lctx.bezierCurveTo(7.6,19.2,6.2,19.8,4.6,19.8);lctx.bezierCurveTo(3.4,19.8,2.3,19.4,1.4,18.6);lctx.bezierCurveTo(.5,17.8,0,16.7,0,15.5);lctx.bezierCurveTo(0,14.2,.5,13.2,1.5,12.3);lctx.bezierCurveTo(2.4,11.5,3.6,11.1,5,11.1);lctx.bezierCurveTo(6.2,11.1,7.5,11.5,8.7,12.2);lctx.lineTo(8.7,10.9);lctx.bezierCurveTo(8.7,10.2,8.6,9.7,8.5,9.3);lctx.bezierCurveTo(8.3,8.9,8,8.6,7.5,8.3);lctx.bezierCurveTo(7.1,8,6.4,7.8,5.7,7.8);lctx.bezierCurveTo(4.3,7.8,3.3,8.4,2.7,9.4);lctx.lineTo(.2,8.7);lctx.bezierCurveTo(1.3,6.6,3.3,5.6,6.1,5.6);lctx.bezierCurveTo(7.1,5.6,8,5.7,8.7,6);lctx.bezierCurveTo(9.5,6.3,10,6.6,10.4,7.1);lctx.bezierCurveTo(10.7,7.5,11,8,11.1,8.5);lctx.bezierCurveTo(11.2,9,11.3,9.8,11.3,10.9);lctx.lineTo(11.3,17.2);lctx.lineTo(13.6,17.2);lctx.closePath();lctx.moveTo(8.7,14.5);lctx.bezierCurveTo(7.5,13.6,6.3,13.2,5.2,13.2);lctx.bezierCurveTo(4.4,13.2,3.8,13.4,3.3,13.8);lctx.bezierCurveTo(2.8,14.2,2.6,14.8,2.6,15.5);lctx.bezierCurveTo(2.6,16.1,2.8,16.6,3.2,17.1);lctx.bezierCurveTo(3.7,17.5,4.2,17.7,5,17.7);lctx.bezierCurveTo(6.3,17.7,7.5,17.2,8.7,16.1);lctx.lineTo(8.7,14.5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(16,19.6);lctx.lineTo(16,17.2);lctx.lineTo(18.4,17.2);lctx.lineTo(18.4,2.4);lctx.lineTo(16,2.4);lctx.lineTo(16,0);lctx.lineTo(21,0);lctx.lineTo(21,7.9);lctx.bezierCurveTo(22.4,6.3,24,5.6,26,5.6);lctx.bezierCurveTo(27.8,5.6,29.4,6.2,30.7,7.5);lctx.bezierCurveTo(32,8.8,32.6,10.5,32.6,12.6);lctx.bezierCurveTo(32.6,14.6,32,16.3,30.7,17.7);lctx.bezierCurveTo(29.5,19.1,27.9,19.8,26,19.8);lctx.bezierCurveTo(24.9,19.8,23.9,19.6,23,19.1);lctx.bezierCurveTo(22.1,18.6,21.4,18.1,21,17.5);lctx.lineTo(21,19.6);lctx.lineTo(16,19.6);lctx.closePath();lctx.moveTo(21.1,12.8);lctx.bezierCurveTo(21.1,14.2,21.6,15.3,22.4,16.2);lctx.bezierCurveTo(23.3,17,24.3,17.4,25.4,17.4);lctx.bezierCurveTo(26.6,17.4,27.6,17,28.5,16.1);lctx.bezierCurveTo(29.4,15.2,29.8,14,29.8,12.5);lctx.bezierCurveTo(29.8,11.1,29.4,10,28.5,9.2);lctx.bezierCurveTo(27.7,8.4,26.6,8,25.5,8);lctx.bezierCurveTo(24.4,8,23.3,8.4,22.5,9.2);lctx.bezierCurveTo(21.6,10.1,21.1,11.2,21.1,12.8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(47.6,5.8);lctx.lineTo(47.6,10.9);lctx.lineTo(45.2,10.9);lctx.bezierCurveTo(45.1,9.9,44.6,9.2,44,8.7);lctx.bezierCurveTo(43.3,8.1,42.5,7.9,41.6,7.9);lctx.bezierCurveTo(40.4,7.9,39.4,8.3,38.7,9.2);lctx.bezierCurveTo(37.9,10,37.5,11.1,37.5,12.5);lctx.bezierCurveTo(37.5,13.8,37.9,14.9,38.6,15.9);lctx.bezierCurveTo(39.3,16.9,40.4,17.4,41.7,17.4);lctx.bezierCurveTo(43.6,17.4,44.9,16.5,45.8,14.7);lctx.lineTo(48,15.7);lctx.bezierCurveTo(46.8,18.4,44.6,19.8,41.6,19.8);lctx.bezierCurveTo(39.4,19.8,37.7,19.1,36.5,17.6);lctx.bezierCurveTo(35.3,16.1,34.6,14.4,34.6,12.5);lctx.bezierCurveTo(34.6,10.4,35.3,8.7,36.7,7.4);lctx.bezierCurveTo(38,6.1,39.6,5.4,41.3,5.4);lctx.bezierCurveTo(42.9,5.4,44.1,5.8,45.2,6.7);lctx.lineTo(45.2,5.8);lctx.lineTo(47.6,5.8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(7.8,33);lctx.lineTo(5.1,36);lctx.lineTo(6.9,36);lctx.lineTo(6.9,38.4);lctx.lineTo(.3,38.4);lctx.lineTo(.3,36);lctx.lineTo(2.3,36);lctx.lineTo(6.3,31.4);lctx.lineTo(2.4,27.2);lctx.lineTo(.6,27.2);lctx.lineTo(.6,24.8);lctx.lineTo(7,24.8);lctx.lineTo(7,27.2);lctx.lineTo(5.3,27.2);lctx.lineTo(7.7,29.8);lctx.lineTo(10.1,27.2);lctx.lineTo(8.7,27.2);lctx.lineTo(8.7,24.8);lctx.lineTo(15.2,24.8);lctx.lineTo(15.2,27.2);lctx.lineTo(12.9,27.2);lctx.lineTo(9.2,31.4);lctx.lineTo(13.4,36);lctx.lineTo(15.2,36);lctx.lineTo(15.2,38.4);lctx.lineTo(8.7,38.4);lctx.lineTo(8.7,36);lctx.lineTo(10.6,36);lctx.lineTo(7.8,33);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(25,38.2);lctx.lineTo(20.5,27.2);lctx.lineTo(18.3,27.2);lctx.lineTo(18.3,24.8);lctx.lineTo(25,24.8);lctx.lineTo(25,27.2);lctx.lineTo(23.4,27.2);lctx.lineTo(26.3,34.7);lctx.lineTo(29.2,27.2);lctx.lineTo(27.4,27.2);lctx.lineTo(27.4,24.8);lctx.lineTo(34,24.8);lctx.lineTo(34,27.2);lctx.lineTo(32,27.2);lctx.lineTo(25.2,44.5);lctx.lineTo(20.7,44.5);lctx.lineTo(20.7,42.2);lctx.lineTo(23.4,42.2);lctx.lineTo(25,38.2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(36.3,38.4);lctx.lineTo(36.3,36.2);lctx.lineTo(44.8,27);lctx.lineTo(39.2,27);lctx.lineTo(39.2,29.6);lctx.lineTo(36.9,29.6);lctx.lineTo(36.9,24.8);lctx.lineTo(48,24.8);lctx.lineTo(48,27.2);
lctx.lineTo(39.4,36.2);lctx.lineTo(45.7,36.2);lctx.lineTo(45.7,33.4);lctx.lineTo(48,33.4);lctx.lineTo(48,38.4);lctx.lineTo(36.3,38.4);lctx.closePath();lctx.fill()}function draw_primaryNav_layers(lctx,fill){lctx.fillStyle=fill;lctx.save();lctx.beginPath();lctx.moveTo(24,21);lctx.lineTo(0,10.5);lctx.lineTo(24,0);lctx.lineTo(48,10.5);lctx.lineTo(24,21);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(24,30);lctx.lineTo(0,19.5);lctx.lineTo(8,16);lctx.lineTo(24,23);lctx.lineTo(40,16);lctx.lineTo(48,19.5);lctx.lineTo(24,30);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(24,39);lctx.lineTo(0,28.5);lctx.lineTo(8,25);lctx.lineTo(24,32);lctx.lineTo(40,25);lctx.lineTo(48,28.5);lctx.lineTo(24,39);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(24,48);lctx.lineTo(0,37.5);lctx.lineTo(8,34);lctx.lineTo(24,41);lctx.lineTo(40,34);lctx.lineTo(48,37.5);lctx.lineTo(24,48);lctx.closePath();lctx.fill();lctx.restore()}function draw_primaryNav_attributes(lctx,fill){lctx.fillStyle=fill;lctx.beginPath();lctx.moveTo(1,7);lctx.lineTo(8,14);lctx.lineTo(17,3);lctx.lineTo(14,0);lctx.lineTo(8,8);lctx.lineTo(4,4);lctx.lineTo(1,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(19,43);lctx.lineTo(0,43);lctx.lineTo(0,44);lctx.lineTo(19,44);lctx.lineTo(19,43);lctx.lineTo(19,43);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(19,35);lctx.lineTo(0,35);lctx.lineTo(0,36);lctx.lineTo(19,36);lctx.lineTo(19,35);lctx.lineTo(19,35);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(19,39);lctx.lineTo(0,39);lctx.lineTo(0,40);lctx.lineTo(19,40);lctx.lineTo(19,39);lctx.lineTo(19,39);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(19,26);lctx.lineTo(0,26);lctx.lineTo(0,27);lctx.lineTo(19,27);lctx.lineTo(19,26);lctx.lineTo(19,26);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(19,18);lctx.lineTo(0,18);lctx.lineTo(0,19);lctx.lineTo(19,19);lctx.lineTo(19,18);lctx.lineTo(19,18);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(19,22);lctx.lineTo(0,22);lctx.lineTo(0,23);lctx.lineTo(19,23);lctx.lineTo(19,22);lctx.lineTo(19,22);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(48,10);lctx.lineTo(19,10);lctx.lineTo(19,11);lctx.lineTo(48,11);lctx.lineTo(48,10);lctx.lineTo(48,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(48,2);lctx.lineTo(19,2);lctx.lineTo(19,3);lctx.lineTo(48,3);lctx.lineTo(48,2);lctx.lineTo(48,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(48,6);lctx.lineTo(19,6);lctx.lineTo(19,7);lctx.lineTo(48,7);lctx.lineTo(48,6);lctx.lineTo(48,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(23,16);lctx.lineTo(23,29);lctx.lineTo(48,29);lctx.lineTo(48,16);lctx.lineTo(23,16);lctx.closePath();lctx.moveTo(25,25);lctx.lineTo(30,20);lctx.lineTo(35,25);lctx.lineTo(25,25);lctx.closePath();lctx.moveTo(41,25);lctx.lineTo(36,20);lctx.lineTo(46,20);lctx.lineTo(41,25);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(23,33);lctx.lineTo(23,46);lctx.lineTo(48,46);lctx.lineTo(48,33);lctx.lineTo(23,33);lctx.closePath();lctx.moveTo(25,42);lctx.lineTo(30,37);lctx.lineTo(35,42);lctx.lineTo(25,42);lctx.closePath();lctx.moveTo(41,42);lctx.lineTo(36,37);lctx.lineTo(46,37);lctx.lineTo(41,42);lctx.closePath();lctx.fill()}function draw_primaryNav_save(lctx,fill){lctx.fillStyle=fill;lctx.save();lctx.beginPath();lctx.moveTo(18,27);lctx.lineTo(19,27);lctx.lineTo(19,32);lctx.lineTo(18,32);lctx.lineTo(18,27);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(32,16);lctx.lineTo(36,16);lctx.lineTo(36,18);lctx.lineTo(32,18);lctx.lineTo(32,16);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(18,12);lctx.lineTo(20,12);lctx.lineTo(20,23);lctx.lineTo(18,23);lctx.lineTo(18,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(28,12);lctx.lineTo(30,12);lctx.lineTo(30,23);lctx.lineTo(28,23);lctx.lineTo(28,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(18,22);lctx.lineTo(30,22);lctx.lineTo(30,24);lctx.lineTo(18,24);lctx.lineTo(18,22);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(21,27);lctx.lineTo(30,27);lctx.lineTo(30,32);lctx.lineTo(21,32);lctx.lineTo(21,27);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(18,27);lctx.lineTo(29,27);lctx.lineTo(29,28);lctx.lineTo(18,28);lctx.lineTo(18,27);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(18,31);lctx.lineTo(29,31);lctx.lineTo(29,32);lctx.lineTo(18,32);lctx.lineTo(18,31);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(17,34);lctx.lineTo(14,31);lctx.lineTo(14,14);lctx.lineTo(36,14);lctx.lineTo(36,12);lctx.lineTo(12,12);lctx.lineTo(12,31.8);lctx.lineTo(16.2,36);lctx.lineTo(36,36);lctx.lineTo(36,34);lctx.lineTo(17,34);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(36,12);lctx.lineTo(34,12);lctx.lineTo(34,14);lctx.lineTo(34,34);lctx.lineTo(34,36);lctx.lineTo(36,36);lctx.lineTo(36,12);lctx.closePath();lctx.fill();lctx.restore()}function drawNewPathButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(8,10);lctx.lineTo(4,10);lctx.lineTo(4,6);lctx.lineTo(8,6);lctx.lineTo(8,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,9);lctx.lineTo(8,9);lctx.lineTo(8,6);lctx.lineTo(10,6);lctx.lineTo(10,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,4);lctx.lineTo(9,4);lctx.lineTo(9,3);lctx.lineTo(10,3);lctx.lineTo(10,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,2);lctx.lineTo(0,2);lctx.lineTo(0,1);lctx.lineTo(2,1);lctx.lineTo(2,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,9);lctx.lineTo(10,9);lctx.lineTo(10,8);lctx.lineTo(11,8);lctx.lineTo(11,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,6);lctx.lineTo(9,6);lctx.lineTo(9,5);lctx.lineTo(10,5);lctx.lineTo(10,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,6);lctx.lineTo(1,6);lctx.lineTo(1,5);lctx.lineTo(4,5);lctx.lineTo(4,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,10);lctx.lineTo(2,10);lctx.lineTo(2,7);lctx.lineTo(4,7);lctx.lineTo(4,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,11);lctx.lineTo(3,11);lctx.lineTo(3,10);lctx.lineTo(5,10);lctx.lineTo(5,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,5);lctx.lineTo(1,5);lctx.lineTo(1,2);lctx.lineTo(9,2);lctx.lineTo(9,5);lctx.closePath();lctx.fill();lctx.fillStyle=outlinecolor;lctx.beginPath();lctx.moveTo(12,15);lctx.lineTo(7,15);lctx.lineTo(7,14);lctx.lineTo(12,14);lctx.lineTo(12,15);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,17);lctx.lineTo(9,17);lctx.lineTo(9,12);lctx.lineTo(10,12);lctx.lineTo(10,17);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,2);lctx.lineTo(9,2);lctx.lineTo(9,1);lctx.lineTo(2,1);lctx.lineTo(2,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(0,1);lctx.lineTo(2,1);lctx.lineTo(2,0);lctx.lineTo(0,0);lctx.lineTo(0,1);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,6);lctx.lineTo(9,6);lctx.lineTo(9,5);lctx.lineTo(4,5);lctx.lineTo(4,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,7);lctx.lineTo(4,7);lctx.lineTo(4,6);lctx.lineTo(2,6);lctx.lineTo(2,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,11);lctx.lineTo(8,11);lctx.lineTo(8,10);lctx.lineTo(5,10);lctx.lineTo(5,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,10);lctx.lineTo(11,10);lctx.lineTo(11,9);lctx.lineTo(8,9);lctx.lineTo(8,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,3);lctx.lineTo(10,3);lctx.lineTo(10,2);lctx.lineTo(9,2);lctx.lineTo(9,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,4);lctx.lineTo(11,4);lctx.lineTo(11,3);lctx.lineTo(10,3);lctx.lineTo(10,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(1,10);lctx.lineTo(2,10);lctx.lineTo(2,7);lctx.lineTo(1,7);lctx.lineTo(1,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,5);lctx.lineTo(10,5);lctx.lineTo(10,4);lctx.lineTo(9,4);lctx.lineTo(9,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,11);lctx.lineTo(3,11);lctx.lineTo(3,10);lctx.lineTo(2,10);lctx.lineTo(2,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,11);lctx.lineTo(12,11);lctx.lineTo(12,10);lctx.lineTo(11,10);lctx.lineTo(11,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,12);lctx.lineTo(5,12);lctx.lineTo(5,11);lctx.lineTo(3,11);lctx.lineTo(3,12);lctx.closePath();lctx.fill()}function drawNewOvalButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(8,2);lctx.lineTo(4,2);lctx.lineTo(4,1);lctx.lineTo(8,1);lctx.lineTo(8,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,10);lctx.lineTo(4,10);lctx.lineTo(4,9);lctx.lineTo(8,9);lctx.lineTo(8,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,7);lctx.lineTo(1,7);lctx.lineTo(1,4);lctx.lineTo(2,4);lctx.lineTo(2,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,7);lctx.lineTo(10,7);lctx.lineTo(10,4);lctx.lineTo(11,4);lctx.lineTo(11,7);lctx.closePath();lctx.fill();lctx.save();lctx.beginPath();lctx.moveTo(10,9);lctx.lineTo(2,9);lctx.lineTo(2,2);lctx.lineTo(10,2);lctx.lineTo(10,9);lctx.closePath();lctx.fill();lctx.fillStyle=outlinecolor;lctx.beginPath();lctx.moveTo(8,1);lctx.lineTo(4,1);lctx.lineTo(4,0);lctx.lineTo(8,0);lctx.lineTo(8,1);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,2);lctx.lineTo(2,2);lctx.lineTo(2,1);lctx.lineTo(4,1);lctx.lineTo(4,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,11);lctx.lineTo(4,11);lctx.lineTo(4,10);lctx.lineTo(8,10);lctx.lineTo(8,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(1,7);lctx.lineTo(0,7);lctx.lineTo(0,4);lctx.lineTo(1,4);lctx.lineTo(1,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,4);lctx.lineTo(1,4);lctx.lineTo(1,2);lctx.lineTo(2,2);lctx.lineTo(2,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,2);lctx.lineTo(10,2);lctx.lineTo(10,1);lctx.lineTo(8,1);lctx.lineTo(8,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,4);lctx.lineTo(11,4);lctx.lineTo(11,2);lctx.lineTo(10,2);lctx.lineTo(10,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,9);lctx.lineTo(2,9);lctx.lineTo(2,10);lctx.lineTo(4,10);lctx.lineTo(4,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,7);lctx.lineTo(1,7);lctx.lineTo(1,9);lctx.lineTo(2,9);lctx.lineTo(2,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,9);lctx.lineTo(10,9);lctx.lineTo(10,10);lctx.lineTo(8,10);lctx.lineTo(8,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,7);lctx.lineTo(11,7);lctx.lineTo(11,9);lctx.lineTo(10,9);lctx.lineTo(10,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,7);lctx.lineTo(11,7);lctx.lineTo(11,4);lctx.lineTo(12,4);lctx.lineTo(12,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,15);lctx.lineTo(7,15);lctx.lineTo(7,14);lctx.lineTo(12,14);lctx.lineTo(12,15);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,17);lctx.lineTo(9,17);lctx.lineTo(9,12);lctx.lineTo(10,12);lctx.lineTo(10,17);lctx.closePath();lctx.fill()}function drawNewRectButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(11,10);lctx.lineTo(1,10);lctx.lineTo(1,1);lctx.lineTo(11,1);lctx.lineTo(11,10);lctx.closePath();lctx.fill();lctx.fillStyle=outlinecolor;lctx.beginPath();lctx.moveTo(12,1);lctx.lineTo(0,1);lctx.lineTo(0,0);lctx.lineTo(12,0);lctx.lineTo(12,1);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,11);lctx.lineTo(0,11);lctx.lineTo(0,10);lctx.lineTo(12,10);lctx.lineTo(12,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,15);lctx.lineTo(7,15);lctx.lineTo(7,14);lctx.lineTo(12,14);lctx.lineTo(12,15);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(1,10);lctx.lineTo(0,10);lctx.lineTo(0,1);lctx.lineTo(1,1);lctx.lineTo(1,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,10);lctx.lineTo(11,10);lctx.lineTo(11,1);lctx.lineTo(12,1);lctx.lineTo(12,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,17);lctx.lineTo(9,17);lctx.lineTo(9,12);lctx.lineTo(10,12);lctx.lineTo(10,17);lctx.closePath();lctx.fill()}function drawShapeResizeButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.save();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(0,4);lctx.lineTo(0,0);lctx.lineTo(4,0);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,9);lctx.lineTo(5,9);lctx.lineTo(5,5);lctx.lineTo(9,5);lctx.lineTo(9,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,14);lctx.lineTo(10,14);lctx.lineTo(10,10);lctx.lineTo(14,10);lctx.lineTo(14,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,4);lctx.lineTo(10,4);lctx.lineTo(10,0);lctx.lineTo(14,0);lctx.lineTo(14,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,14);lctx.lineTo(0,14);lctx.lineTo(0,10);lctx.lineTo(4,10);lctx.lineTo(4,14);lctx.closePath();lctx.fill();lctx.fillStyle=outlinecolor;lctx.beginPath();lctx.moveTo(12,11);lctx.lineTo(11,11);lctx.lineTo(11,3);lctx.lineTo(12,3);lctx.lineTo(12,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,12);lctx.lineTo(3,12);lctx.lineTo(3,11);lctx.lineTo(11,11);lctx.lineTo(11,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,3);lctx.lineTo(3,3);lctx.lineTo(3,2);lctx.lineTo(11,2);lctx.lineTo(11,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,11);lctx.lineTo(2,11);lctx.lineTo(2,3);lctx.lineTo(3,3);lctx.lineTo(3,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,1);lctx.lineTo(0,1);lctx.lineTo(0,0);lctx.lineTo(4,0);lctx.lineTo(4,1);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(0,4);lctx.lineTo(0,3);lctx.lineTo(4,3);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(1,4);lctx.lineTo(0,4);lctx.lineTo(0,0);lctx.lineTo(1,0);lctx.lineTo(1,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(3,4);lctx.lineTo(3,0);lctx.lineTo(4,0);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,1);lctx.lineTo(10,1);lctx.lineTo(10,0);lctx.lineTo(14,0);lctx.lineTo(14,1);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,4);lctx.lineTo(10,4);lctx.lineTo(10,3);lctx.lineTo(14,3);lctx.lineTo(14,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,4);lctx.lineTo(10,4);lctx.lineTo(10,0);lctx.lineTo(11,0);lctx.lineTo(11,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,4);lctx.lineTo(13,4);lctx.lineTo(13,0);lctx.lineTo(14,0);lctx.lineTo(14,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,11);lctx.lineTo(10,11);lctx.lineTo(10,10);lctx.lineTo(14,10);lctx.lineTo(14,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,14);lctx.lineTo(10,14);lctx.lineTo(10,13);lctx.lineTo(14,13);lctx.lineTo(14,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,14);lctx.lineTo(10,14);lctx.lineTo(10,10);lctx.lineTo(11,10);lctx.lineTo(11,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,14);lctx.lineTo(13,14);lctx.lineTo(13,10);lctx.lineTo(14,10);lctx.lineTo(14,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,11);lctx.lineTo(0,11);lctx.lineTo(0,10);lctx.lineTo(4,10);lctx.lineTo(4,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,14);lctx.lineTo(0,14);lctx.lineTo(0,13);lctx.lineTo(4,13);lctx.lineTo(4,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(1,14);lctx.lineTo(0,14);lctx.lineTo(0,10);lctx.lineTo(1,10);lctx.lineTo(1,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,14);lctx.lineTo(3,14);lctx.lineTo(3,10);lctx.lineTo(4,10);lctx.lineTo(4,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,6);lctx.lineTo(5,6);lctx.lineTo(5,5);lctx.lineTo(9,5);lctx.lineTo(9,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,9);lctx.lineTo(5,9);lctx.lineTo(5,8);lctx.lineTo(9,8);lctx.lineTo(9,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,9);lctx.lineTo(5,9);lctx.lineTo(5,5);lctx.lineTo(6,5);lctx.lineTo(6,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,9);lctx.lineTo(8,9);lctx.lineTo(8,5);lctx.lineTo(9,5);lctx.lineTo(9,9);lctx.closePath();lctx.fill()}function drawPathEditButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(8,18);lctx.lineTo(7,18);lctx.lineTo(7,14);lctx.lineTo(8,14);lctx.lineTo(8,18);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,18);lctx.lineTo(8,18);lctx.lineTo(8,16);lctx.lineTo(9,16);lctx.lineTo(9,18);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,14);lctx.lineTo(5,14);lctx.lineTo(5,12);lctx.lineTo(6,12);lctx.lineTo(6,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,4);lctx.lineTo(1,4);lctx.lineTo(1,3);lctx.lineTo(3,3);lctx.lineTo(3,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(7,16);lctx.lineTo(6,16);lctx.lineTo(6,7);lctx.lineTo(7,7);lctx.lineTo(7,16);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,12);lctx.lineTo(1,12);lctx.lineTo(1,6);lctx.lineTo(6,6);lctx.lineTo(6,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,12);lctx.lineTo(8,12);lctx.lineTo(8,9);lctx.lineTo(9,9);lctx.lineTo(9,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,12);lctx.lineTo(7,12);lctx.lineTo(7,8);lctx.lineTo(8,8);lctx.lineTo(8,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,12);lctx.lineTo(10,12);lctx.lineTo(10,11);lctx.lineTo(11,11);lctx.lineTo(11,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,12);lctx.lineTo(9,12);lctx.lineTo(9,10);lctx.lineTo(10,10);lctx.lineTo(10,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,16);lctx.lineTo(1,16);lctx.lineTo(1,15);lctx.lineTo(2,15);lctx.lineTo(2,16);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,3);lctx.lineTo(1,3);lctx.lineTo(1,2);lctx.lineTo(2,2);lctx.lineTo(2,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,15);lctx.lineTo(1,15);lctx.lineTo(1,14);lctx.lineTo(3,14);lctx.lineTo(3,15);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,14);lctx.lineTo(1,14);lctx.lineTo(1,13);lctx.lineTo(4,13);lctx.lineTo(4,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,5);lctx.lineTo(1,5);lctx.lineTo(1,4);lctx.lineTo(4,4);lctx.lineTo(4,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,13);lctx.lineTo(1,13);lctx.lineTo(1,12);lctx.lineTo(5,12);lctx.lineTo(5,13);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,6);lctx.lineTo(1,6);lctx.lineTo(1,5);lctx.lineTo(5,5);lctx.lineTo(5,6);lctx.closePath();lctx.fill();lctx.fillStyle=outlinecolor;lctx.beginPath();lctx.moveTo(1,17);lctx.lineTo(0,17);lctx.lineTo(0,0);lctx.lineTo(1,0);lctx.lineTo(1,17);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,2);lctx.lineTo(1,2);lctx.lineTo(1,1);lctx.lineTo(2,1);lctx.lineTo(2,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(3,4);lctx.lineTo(3,3);lctx.lineTo(4,3);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,3);lctx.lineTo(2,3);lctx.lineTo(2,2);lctx.lineTo(3,2);lctx.lineTo(3,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,6);lctx.lineTo(5,6);lctx.lineTo(5,5);lctx.lineTo(6,5);lctx.lineTo(6,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,5);lctx.lineTo(4,5);lctx.lineTo(4,4);lctx.lineTo(5,4);lctx.lineTo(5,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,8);lctx.lineTo(7,8);lctx.lineTo(7,7);lctx.lineTo(8,7);lctx.lineTo(8,8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(7,7);lctx.lineTo(6,7);lctx.lineTo(6,6);lctx.lineTo(7,6);lctx.lineTo(7,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,13);lctx.lineTo(7,13);lctx.lineTo(7,12);lctx.lineTo(12,12);lctx.lineTo(12,13);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,9);lctx.lineTo(8,9);lctx.lineTo(8,8);lctx.lineTo(9,8);lctx.lineTo(9,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,10);lctx.lineTo(9,10);lctx.lineTo(9,9);lctx.lineTo(10,9);lctx.lineTo(10,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,11);lctx.lineTo(10,11);lctx.lineTo(10,10);lctx.lineTo(11,10);lctx.lineTo(11,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,12);lctx.lineTo(11,12);lctx.lineTo(11,11);lctx.lineTo(12,11);lctx.lineTo(12,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,19);lctx.lineTo(7,19);lctx.lineTo(7,18);lctx.lineTo(9,18);lctx.lineTo(9,19);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,17);lctx.lineTo(1,17);lctx.lineTo(1,16);lctx.lineTo(2,16);lctx.lineTo(2,17);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,16);lctx.lineTo(2,16);lctx.lineTo(2,15);lctx.lineTo(3,15);lctx.lineTo(3,16);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,15);lctx.lineTo(3,15);lctx.lineTo(3,14);lctx.lineTo(4,14);lctx.lineTo(4,15);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,14);lctx.lineTo(4,14);lctx.lineTo(4,13);lctx.lineTo(5,13);lctx.lineTo(5,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,14);lctx.lineTo(6,14);lctx.lineTo(6,16);lctx.lineTo(5,16);lctx.lineTo(5,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,16);lctx.lineTo(7,16);lctx.lineTo(7,18);lctx.lineTo(6,18);lctx.lineTo(6,16);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(7,12);lctx.lineTo(8,12);lctx.lineTo(8,14);lctx.lineTo(7,14);lctx.lineTo(7,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,14);lctx.lineTo(9,14);lctx.lineTo(9,16);lctx.lineTo(8,16);lctx.lineTo(8,14);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,16);lctx.lineTo(10,16);lctx.lineTo(10,18);lctx.lineTo(9,18);lctx.lineTo(9,16);lctx.closePath();lctx.fill()}function drawPanButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(9,7);lctx.lineTo(7,7);lctx.lineTo(7,2);lctx.lineTo(9,2);lctx.lineTo(9,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,3);lctx.lineTo(5,3);lctx.lineTo(5,2);lctx.lineTo(11,2);lctx.lineTo(11,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,2);lctx.lineTo(6,2);lctx.lineTo(6,1);lctx.lineTo(10,1);lctx.lineTo(10,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,1);lctx.lineTo(7,1);lctx.lineTo(7,0);lctx.lineTo(9,0);lctx.lineTo(9,1);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,7);lctx.lineTo(7,7);lctx.lineTo(7,12);lctx.lineTo(9,12);lctx.lineTo(9,7);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,11);lctx.lineTo(5,11);lctx.lineTo(5,12);lctx.lineTo(11,12);lctx.lineTo(11,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,12);lctx.lineTo(6,12);lctx.lineTo(6,13);lctx.lineTo(10,13);lctx.lineTo(10,12);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,13);lctx.lineTo(7,13);lctx.lineTo(7,14);lctx.lineTo(9,14);lctx.lineTo(9,13);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,6);lctx.lineTo(8,8);lctx.lineTo(13,8);lctx.lineTo(13,6);lctx.lineTo(8,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,4);lctx.lineTo(12,10);lctx.lineTo(13,10);lctx.lineTo(13,4);lctx.lineTo(12,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(13,5);lctx.lineTo(13,9);lctx.lineTo(14,9);lctx.lineTo(14,5);lctx.lineTo(13,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,6);lctx.lineTo(14,8);lctx.lineTo(15,8);lctx.lineTo(15,6);lctx.lineTo(14,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,6);lctx.lineTo(8,8);lctx.lineTo(3,8);lctx.lineTo(3,6);lctx.lineTo(8,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(4,10);lctx.lineTo(3,10);lctx.lineTo(3,4);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,5);lctx.lineTo(3,9);lctx.lineTo(2,9);lctx.lineTo(2,5);lctx.lineTo(3,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,6);lctx.lineTo(2,8);lctx.lineTo(1,8);lctx.lineTo(1,6);lctx.lineTo(2,6);lctx.closePath();lctx.fill()}function drawZoomInButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(9,3);lctx.lineTo(7,3);lctx.lineTo(7,13);lctx.lineTo(9,13);lctx.lineTo(9,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(13,7);lctx.lineTo(13,9);lctx.lineTo(3,9);lctx.lineTo(3,7);lctx.lineTo(13,7);lctx.closePath();lctx.fill()}function drawZoomOutButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(13,7);lctx.lineTo(13,9);lctx.lineTo(3,9);lctx.lineTo(3,7);lctx.lineTo(13,7);lctx.closePath();lctx.fill()}function drawZoom1to1Button(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.beginPath();lctx.moveTo(5,3);lctx.lineTo(3,3);lctx.lineTo(3,13);lctx.lineTo(5,13);lctx.lineTo(5,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,3);lctx.lineTo(12,3);lctx.lineTo(12,13);lctx.lineTo(14,13);lctx.lineTo(14,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,3);lctx.lineTo(11,3);lctx.lineTo(11,5);lctx.lineTo(12,5);lctx.lineTo(12,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,3);lctx.lineTo(2,3);lctx.lineTo(2,5);lctx.lineTo(3,5);lctx.lineTo(3,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,9);lctx.lineTo(7,9);lctx.lineTo(7,11);lctx.lineTo(9,11);lctx.lineTo(9,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,5);lctx.lineTo(7,5);lctx.lineTo(7,7);lctx.lineTo(9,7);lctx.lineTo(9,5);lctx.closePath();lctx.fill()}function drawZoomEmButton(lctx,bgcolor,outlinecolor){lctx.fillStyle=bgcolor;lctx.save();lctx.beginPath();lctx.moveTo(1,0);lctx.lineTo(0,0);lctx.lineTo(0,11);lctx.lineTo(1,11);lctx.lineTo(1,0);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,2);lctx.lineTo(2,2);lctx.lineTo(2,10);lctx.lineTo(4,10);lctx.lineTo(4,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(12,2);lctx.lineTo(10,2);lctx.lineTo(10,10);lctx.lineTo(12,10);lctx.lineTo(12,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,3);lctx.lineTo(9,3);lctx.lineTo(9,5);lctx.lineTo(11,5);lctx.lineTo(11,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,4);lctx.lineTo(8,4);lctx.lineTo(8,6);lctx.lineTo(10,6);lctx.lineTo(10,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,6);lctx.lineTo(6,6);lctx.lineTo(6,8);lctx.lineTo(8,8);lctx.lineTo(8,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,4);lctx.lineTo(4,4);lctx.lineTo(4,6);lctx.lineTo(6,6);lctx.lineTo(6,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,5);lctx.lineTo(5,5);lctx.lineTo(5,7);lctx.lineTo(9,7);lctx.lineTo(9,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,3);lctx.lineTo(3,3);lctx.lineTo(3,5);lctx.lineTo(5,5);lctx.lineTo(5,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,0);lctx.lineTo(13,0);lctx.lineTo(13,11);lctx.lineTo(14,11);lctx.lineTo(14,0);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,11);lctx.lineTo(0,11);lctx.lineTo(0,12);lctx.lineTo(14,12);lctx.lineTo(14,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(14,0);lctx.lineTo(0,0);lctx.lineTo(0,1);lctx.lineTo(14,1);lctx.lineTo(14,0);lctx.closePath();lctx.fill()}function drawPointCornerButton(lctx,c){lctx.fillStyle=c;lctx.beginPath();lctx.moveTo(6,8);lctx.lineTo(5,8);lctx.lineTo(5,5);lctx.lineTo(6,5);lctx.lineTo(6,8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,5);lctx.lineTo(7,5);lctx.lineTo(7,8);lctx.lineTo(8,8);lctx.lineTo(8,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,6);lctx.lineTo(8,6);lctx.lineTo(8,5);lctx.lineTo(5,5);lctx.lineTo(5,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,8);lctx.lineTo(8,8);lctx.lineTo(8,7);lctx.lineTo(5,7);lctx.lineTo(5,8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,5);lctx.lineTo(4,5);lctx.lineTo(4,4);lctx.lineTo(5,4);lctx.lineTo(5,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(3,4);lctx.lineTo(3,3);lctx.lineTo(4,3);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,3);lctx.lineTo(2,3);lctx.lineTo(2,2);lctx.lineTo(3,2);lctx.lineTo(3,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,9);lctx.lineTo(4,9);lctx.lineTo(4,8);lctx.lineTo(5,8);lctx.lineTo(5,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,10);lctx.lineTo(3,10);lctx.lineTo(3,9);lctx.lineTo(4,9);lctx.lineTo(4,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,11);lctx.lineTo(2,11);lctx.lineTo(2,10);lctx.lineTo(3,10);lctx.lineTo(3,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,2);lctx.lineTo(0,2);lctx.lineTo(0,0);lctx.lineTo(2,0);lctx.lineTo(2,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,13);lctx.lineTo(0,13);lctx.lineTo(0,11);lctx.lineTo(2,11);lctx.lineTo(2,13);lctx.closePath();lctx.fill()}function drawPointFlatButton(lctx,c){lctx.fillStyle=c;lctx.beginPath();lctx.moveTo(6,8);lctx.lineTo(5,8);lctx.lineTo(5,5);lctx.lineTo(6,5);lctx.lineTo(6,8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,5);lctx.lineTo(7,5);lctx.lineTo(7,8);lctx.lineTo(8,8);lctx.lineTo(8,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,6);lctx.lineTo(8,6);lctx.lineTo(8,5);lctx.lineTo(5,5);lctx.lineTo(5,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,8);lctx.lineTo(7,8);lctx.lineTo(7,7);lctx.lineTo(6,7);lctx.lineTo(6,8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,5);lctx.lineTo(4,5);lctx.lineTo(4,4);lctx.lineTo(5,4);lctx.lineTo(5,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,9);lctx.lineTo(8,9);lctx.lineTo(8,8);lctx.lineTo(9,8);lctx.lineTo(9,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(3,4);lctx.lineTo(3,3);lctx.lineTo(4,3);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,3);lctx.lineTo(2,3);lctx.lineTo(2,2);lctx.lineTo(3,2);lctx.lineTo(3,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,2);lctx.lineTo(0,2);lctx.lineTo(0,0);lctx.lineTo(2,0);lctx.lineTo(2,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,11);lctx.lineTo(9,11);lctx.lineTo(9,9);lctx.lineTo(11,9);lctx.lineTo(11,11);lctx.closePath();lctx.fill()}function drawPointSymmetricButton(lctx,c){lctx.fillStyle=c;lctx.beginPath();lctx.moveTo(5,5);lctx.lineTo(4,5);lctx.lineTo(4,4);lctx.lineTo(5,4);lctx.lineTo(5,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(4,4);lctx.lineTo(3,4);lctx.lineTo(3,3);lctx.lineTo(4,3);lctx.lineTo(4,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(3,3);lctx.lineTo(2,3);lctx.lineTo(2,2);lctx.lineTo(3,2);lctx.lineTo(3,3);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,2);lctx.lineTo(0,2);lctx.lineTo(0,0);lctx.lineTo(2,0);lctx.lineTo(2,2);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(11,11);lctx.lineTo(10,11);lctx.lineTo(10,10);lctx.lineTo(11,10);lctx.lineTo(11,11);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(10,10);lctx.lineTo(9,10);lctx.lineTo(9,9);lctx.lineTo(10,9);lctx.lineTo(10,10);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(9,9);lctx.lineTo(8,9);lctx.lineTo(8,8);lctx.lineTo(9,8);lctx.lineTo(9,9);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(13,13);lctx.lineTo(11,13);lctx.lineTo(11,11);lctx.lineTo(13,11);lctx.lineTo(13,13);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(6,8);lctx.lineTo(5,8);lctx.lineTo(5,5);lctx.lineTo(6,5);lctx.lineTo(6,8);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,5);lctx.lineTo(7,5);lctx.lineTo(7,8);lctx.lineTo(8,8);lctx.lineTo(8,5);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,6);lctx.lineTo(8,6);lctx.lineTo(8,5);lctx.lineTo(5,5);lctx.lineTo(5,6);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(8,8);lctx.lineTo(5,8);lctx.lineTo(5,7);lctx.lineTo(8,7);lctx.lineTo(8,8);lctx.closePath();lctx.fill()}function drawLockButton(obj,c){var lctx=obj.getContext("2d");lctx.fillStyle=c;lctx.beginPath();lctx.moveTo(7,4);lctx.lineTo(0,4);lctx.lineTo(0,9);lctx.lineTo(7,9);lctx.lineTo(7,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(2,4);lctx.lineTo(1,4);lctx.lineTo(1,1);lctx.lineTo(2,1);lctx.lineTo(2,4);lctx.closePath();lctx.fill();lctx.beginPath();
lctx.moveTo(5,4);lctx.lineTo(6,4);lctx.lineTo(6,1);lctx.lineTo(5,1);lctx.lineTo(5,4);lctx.closePath();lctx.fill();lctx.beginPath();lctx.moveTo(5,1);lctx.lineTo(2,1);lctx.lineTo(2,0);lctx.lineTo(5,0);lctx.lineTo(5,1);lctx.closePath();lctx.fill()}function drawCheckbox(obj,ischecked){var lctx=obj.getContext("2d");lctx.fillStyle=_UI.colors.text_light;lctx.beginPath();lctx.moveTo(12,15);lctx.lineTo(0,15);lctx.lineTo(0,3);lctx.lineTo(12,3);lctx.lineTo(12,15);lctx.closePath();lctx.fill();if(ischecked){lctx.fillStyle=_UI.colors.accent;lctx.beginPath();lctx.moveTo(0,9);lctx.lineTo(5.5,15);lctx.lineTo(15,3.5);lctx.lineTo(13,0);lctx.lineTo(5.5,11);lctx.lineTo(2,6.5);lctx.lineTo(0,9);lctx.closePath();lctx.fill()}}_UI.eventhandlers={temppathdragshape:false,mousex:0,mousey:0,ismouseovercec:false,corner:false,toolhandoff:false,lastx:-100,lasty:-100,firstx:-100,firsty:-100,uqhaschanged:false,eh_shapesel:false,eh_shaperesize:false,eh_pantool:false,eh_addpath:false,lastTool:"pathedit",iskeydown:false};function initEventHandlers(){var tool=new pathedit;_UI.eventhandlers.eh_addrectoval=new newbasicShape;_UI.eventhandlers.eh_shapesel=new pathedit;_UI.eventhandlers.eh_shaperesize=new shaperesize;_UI.eventhandlers.eh_pantool=new pantool;_UI.eventhandlers.eh_addpath=new newPath;_UI.eventhandlers.eh_addrectoval=new newbasicShape;_UI.chareditcanvas.addEventListener("mousedown",ev_canvas,false);_UI.chareditcanvas.addEventListener("mousemove",ev_canvas,false);_UI.chareditcanvas.addEventListener("mouseup",ev_canvas,false);_UI.chareditcanvas.onmouseover=mouseovercec;_UI.chareditcanvas.onmouseout=mouseoutcec;document.onkeypress=keypress;document.onkeydown=keydown;document.onkeyup=keyup;document.onmousewheel=mousewheel;window.addEventListener("DOMMouseScroll",mousewheel,false);function ev_canvas(ev){mouseovercec();document.onselectstart=function(){return false};if(ev.layerX||ev.layerX){_UI.eventhandlers.mousex=ev.layerX-470;_UI.eventhandlers.mousey=ev.layerY}if(ev.offsetX||ev.offsetX){_UI.eventhandlers.mousex=ev.offsetX;_UI.eventhandlers.mousey=ev.offsetY}resetCursor();switch(_UI.selectedtool){case"pathedit":tool=_UI.eventhandlers.eh_shapesel;break;case"shaperesize":tool=_UI.eventhandlers.eh_shaperesize;break;case"pan":document.body.style.cursor="move";tool=_UI.eventhandlers.eh_pantool;break;case"newpath":document.body.style.cursor="crosshair";tool=_UI.eventhandlers.eh_addpath;break;case"newrect":case"newoval":document.body.style.cursor="crosshair";tool=_UI.eventhandlers.eh_addrectoval;break}tool[ev.type](ev)}}function newPath(){this.dragging=false;this.firstpoint=true;this.currpt;this.mousedown=function(ev){var newpoint=new PathPoint({P:new Coord({x:cx_sx(_UI.eventhandlers.mousex),y:cy_sy(_UI.eventhandlers.mousey)}),H1:new Coord({x:cx_sx(_UI.eventhandlers.mousex-100),y:cy_sy(_UI.eventhandlers.mousey)}),H2:new Coord({x:cx_sx(_UI.eventhandlers.mousex+100),y:cy_sy(_UI.eventhandlers.mousey)}),type:"flat",selected:true,useh1:false,useh2:false});if(this.firstpoint){var newpath=new Path({pathpoints:[newpoint]});var newshape=addShape(new Shape({name:"path "+(_UI.shapelayers.length+1),path:newpath}));newshape.path.selectPathPoint(0)}else{var currpath=ss("Event Handler New Path").path;var ccp=currpath.isOverControlPoint(cx_sx(_UI.eventhandlers.mousex),cy_sy(_UI.eventhandlers.mousey));if(ccp=="P"&&currpath.pathpoints.length>1){var p=currpath.pathpoints[0];var hp=_GP.projectsettings.pointsize/getView("Event Handler newPath mousedown").dz;if(p.P.x+hp>cx_sx(_UI.eventhandlers.mousex)&&p.P.x-hp<cx_sx(_UI.eventhandlers.mousex)&&p.P.y+hp>cy_sy(_UI.eventhandlers.mousey)&&p.P.y-hp<cy_sy(_UI.eventhandlers.mousey)){_UI.selectedtool="pathedit";_UI.eventhandlers.eh_shapesel.moving=true;_UI.eventhandlers.eh_shapesel.controlpoint="H2";_UI.eventhandlers.toolhandoff=true;this.dragging=false;this.firstmove=false;_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey;currpath.clockwise=findClockwise(currpath.pathpoints);redraw("Event Handler newPath mousedown");return}}currpath.addPathPoint(newpoint,false)}this.currpt=ss("Event Handler New Path").path.sp(false,"Event Handler New Path");this.firstpoint=false;this.dragging=true;_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey};this.mouseup=function(){this.dragging=false;this.firstmove=false;_UI.eventhandlers.lastx=-100;_UI.eventhandlers.lasty=-100;updateCurrentCharWidth();putundoq("New Path tool");redraw("Event Handler newPath mouseup")};this.mousemove=function(ev){if(this.dragging){if(Math.abs(this.currpt.P.x-cx_sx(_UI.eventhandlers.mousex))>_GP.projectsettings.pointsize*2||Math.abs(this.currpt.P.y-cy_sy(_UI.eventhandlers.mousey))>_GP.projectsettings.pointsize*2){this.currpt.useh1=true;this.currpt.useh2=true;this.currpt.H2.x=cx_sx(_UI.eventhandlers.mousex);this.currpt.H2.y=cy_sy(_UI.eventhandlers.mousey);this.currpt.makeSymmetric("H2")}else{}_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey;redraw("Event Handler newPath mousemove")}}}function newbasicShape(){this.mousedown=function(ev){var newshape=new Shape({visible:false});newshape.name=_UI.selectedtool=="newrect"?"rect "+(_UI.shapelayers.length+1):"oval "+(_UI.shapelayers.length+1);newshape=addShape(newshape);newshape.path.setLeftX(cx_sx(_UI.eventhandlers.mousex));newshape.path.setTopY(cy_sy(_UI.eventhandlers.mousey));_UI.eventhandlers.temppathdragshape={leftx:cx_sx(_UI.eventhandlers.mousex),rightx:cx_sx(_UI.eventhandlers.mousex),topy:cy_sy(_UI.eventhandlers.mousey),bottomy:cy_sy(_UI.eventhandlers.mousey)};this.dragging=true;_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey;_UI.eventhandlers.firstx=_UI.eventhandlers.mousex;_UI.eventhandlers.firsty=_UI.eventhandlers.mousey;redraw("Event Handler newbasicshape mousedown")};this.mouseup=function(){var s=ss("eventHandler - newbasicshape mouseup");if(Math.abs(_UI.eventhandlers.lastx-_UI.eventhandlers.firstx)<_GP.projectsettings.pointsize&&Math.abs(_UI.eventhandlers.lasty-_UI.eventhandlers.firsty)<_GP.projectsettings.pointsize){_UI.eventhandlers.temppathdragshape={leftx:s.path.leftx,rightx:s.path.rightx,topy:s.path.topy,bottomy:s.path.bottomy}}if(_UI.selectedtool=="newrect"){s.path=rectPathFromCorners(_UI.eventhandlers.temppathdragshape)}else{s.path=ovalPathFromCorners(_UI.eventhandlers.temppathdragshape)}s.visible=true;this.dragging=false;_UI.eventhandlers.lastx=-100;_UI.eventhandlers.lasty=-100;_UI.eventhandlers.firstx=-100;_UI.eventhandlers.firsty=-100;_UI.eventhandlers.temppathdragshape=false;updateCurrentCharWidth();putundoq("New Basic Shape tool");_UI.eventhandlers.uqhaschanged=false;clicktool("pathedit")};this.mousemove=function(ev){if(this.dragging){var s=ss("eventHandler - newbasicshape mousemove");evHanShapeResize(s,"se");_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey;_UI.eventhandlers.uqhaschanged=true;redraw("Event Handler newbasicshape mousemove")}}}function pathedit(){this.moving=false;this.controlpoint=false;this.mousedown=function(ev){var s=ss("Path Edit - Mouse Down");this.controlpoint=s?s.path.isOverControlPoint(cx_sx(_UI.eventhandlers.mousex),cy_sy(_UI.eventhandlers.mousey)):false;if(this.controlpoint){this.moving=true;_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey}else if(clickSelectShape(_UI.eventhandlers.mousex,_UI.eventhandlers.mousey)){_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey}else{if(s){s.path.calcMaxes()}clickEmptySpace()}redraw("Event Handler pathedit mousedown")};this.mouseup=function(){this.moving=false;_UI.eventhandlers.lastx=-100;_UI.eventhandlers.lasty=-100;if(_UI.eventhandlers.uqhaschanged){ss("Path Edit - Mouse Up").path.calcMaxes();updateCurrentCharWidth();putundoq("Path Edit tool");_UI.eventhandlers.uqhaschanged=false;redraw("Event Handler pathedit mouseup")}};this.mousemove=function(ev){if(this.moving){var s=ss("Path Edit - Mouse Move");var sp=s.path.sp();if(_UI.eventhandlers.toolhandoff){sp.H2.x=cx_sx(_UI.eventhandlers.mousex);sp.H2.y=cy_sy(_UI.eventhandlers.mousey);_UI.eventhandlers.toolhandoff=false}var dx=0;var dy=0;var dz=getView("Event Handler pathedit mousemove").dz;switch(this.controlpoint){case"P":if(!sp.P.xlock)dx=(_UI.eventhandlers.mousex-_UI.eventhandlers.lastx)/dz;if(!sp.P.ylock)dy=(_UI.eventhandlers.lasty-_UI.eventhandlers.mousey)/dz;break;case"H1":if(!sp.H1.xlock)dx=(_UI.eventhandlers.mousex-_UI.eventhandlers.lastx)/dz;if(!sp.H1.ylock)dy=(_UI.eventhandlers.lasty-_UI.eventhandlers.mousey)/dz;break;case"H2":if(!sp.H2.xlock)dx=(_UI.eventhandlers.mousex-_UI.eventhandlers.lastx)/dz;if(!sp.H2.ylock)dy=(_UI.eventhandlers.lasty-_UI.eventhandlers.mousey)/dz;break}sp.updatePointPosition(this.controlpoint,dx,dy);_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey;_UI.eventhandlers.uqhaschanged=true;redraw("Event Handler pathedit mousemove")}}}function shaperesize(){this.dragging=false;this.resizing=false;_UI.eventhandlers.corner=false;this.mousedown=function(ev){var s=ss("eventHandler - mousedown");_UI.eventhandlers.corner=s?s.isOverHandle(_UI.eventhandlers.mousex,_UI.eventhandlers.mousey):false;_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.firstx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey;_UI.eventhandlers.firsty=_UI.eventhandlers.mousey;if(_UI.eventhandlers.corner){this.resizing=true;this.dragging=false;if(_GP.projectsettings.quickpathupdating){_UI.eventhandlers.temppathdragshape={leftx:s.path.leftx,rightx:s.path.rightx,topy:s.path.topy,bottomy:s.path.bottomy};s.hidden=true}}else if(clickSelectShape(_UI.eventhandlers.mousex,_UI.eventhandlers.mousey)){this.dragging=true;this.resizing=false;redraw("Event Handler shaperesize mousedown")}else{clickEmptySpace()}};this.mouseup=function(){resetCursor();var s=ss("eventHandler - mouseup");if(_UI.eventhandlers.temppathdragshape){_UI.eventhandlers.temppathdragshape=false;s.hidden=false;_UI.eventhandlers.lastx=_UI.eventhandlers.firstx;_UI.eventhandlers.lasty=_UI.eventhandlers.firsty;evHanShapeResize(s,_UI.eventhandlers.corner)}if(this.resizing)s.path.calcMaxes();updateCurrentCharWidth();this.dragging=false;this.resizing=false;_UI.eventhandlers.lastx=-100;_UI.eventhandlers.lasty=-100;_UI.eventhandlers.firstx=-100;_UI.eventhandlers.firsty=-100;_UI.eventhandlers.uqhaschanged?putundoq("Path Edit tool"):true;_UI.eventhandlers.uqhaschanged=false;redraw("Event Handler shaperesize mouseup")};this.mousemove=function(ev){var s=ss("eventHandler - shaperesize mousemove");var didstuff=false;var dz=getView("Event Handler shaperesize mousemove").dz;if(s.link){if(this.dragging&&!s.uselinkedshapexy){s.xpos+=Math.round((_UI.eventhandlers.mousex-_UI.eventhandlers.lastx)/dz);s.ypos+=Math.round((_UI.eventhandlers.lasty-_UI.eventhandlers.mousey)/dz);didstuff=true;resetCursor()}}else{if(this.dragging){var dx=s.xlock?0:dx=Math.round((_UI.eventhandlers.mousex-_UI.eventhandlers.lastx)/dz);var dy=s.ylock?0:dy=Math.round((_UI.eventhandlers.lasty-_UI.eventhandlers.mousey)/dz);s.path.updatePathPosition(dx,dy);resetCursor();didstuff=true}else if(this.resizing){evHanShapeResize(s,_UI.eventhandlers.corner);didstuff=true}s?s.isOverHandle(_UI.eventhandlers.mousex,_UI.eventhandlers.mousey):false}if(didstuff){_UI.eventhandlers.lastx=_UI.eventhandlers.mousex;_UI.eventhandlers.lasty=_UI.eventhandlers.mousey;_UI.eventhandlers.uqhaschanged=true;redraw("Event Handler shaperesize mousemove")}}}function pantool(){this.dragging=false;this.deltax=0;this.deltay=0;this.mousedown=function(ev){var v=getView("Event Handler pantool mousedown");this.deltax=_UI.eventhandlers.mousex-v.dx;this.deltay=_UI.eventhandlers.mousey-v.dy;this.dragging=true};this.mouseup=function(){this.dragging=false;this.deltax=0;this.deltay=0};this.mousemove=function(ev){if(this.dragging){setView({dx:_UI.eventhandlers.mousex-this.deltax,dy:_UI.eventhandlers.mousey-this.deltay});redraw("Event Handler pantool mousemove")}}}function cx_sx(cx){var v=getView("cx_sx");return Math.round((cx-v.dx)/v.dz)}function cy_sy(cy){var v=getView("cy_sy");return Math.round((v.dy-cy)/v.dz)}function clickEmptySpace(){var s=ss("Click Empty Space");if(s){s.path.selectPathPoint(false);s.path.calcMaxes()}_UI.selectedshape=-1}function evHanShapeResize(s,pcorner){var mx=cx_sx(_UI.eventhandlers.mousex);var my=cy_sy(_UI.eventhandlers.mousey);var lx=cx_sx(_UI.eventhandlers.lastx);var ly=cy_sy(_UI.eventhandlers.lasty);switch(pcorner){case"nw":if(canResize("nw")){var dh=my-ly;var dw=mx-lx;if(_UI.eventhandlers.temppathdragshape){updateTPDS(dw,dh,dw*-1,dh*-1)}else{s.path.updatePathSize(dw*-1,dh);s.path.updatePathPosition(dw,0)}}break;case"n":if(canResize("n")){var dh=my-ly;if(_UI.eventhandlers.temppathdragshape){updateTPDS(0,dh,0,dh*-1)}else{s.path.updatePathSize(0,dh)}}break;case"ne":if(canResize("ne")){var dh=my-ly;var dw=mx-lx;if(_UI.eventhandlers.temppathdragshape){updateTPDS(0,dh,dw,dh*-1)}else{s.path.updatePathSize(dw,dh)}}break;case"e":if(canResize("e")){var dw=mx-lx;if(_UI.eventhandlers.temppathdragshape){updateTPDS(0,0,dw,0)}else{s.path.updatePathSize(dw,0)}}break;case"se":if(canResize("se")){var dh=(ly-my)*-1;var dw=mx-lx;if(_UI.eventhandlers.temppathdragshape){updateTPDS(0,0,dw,dh)}else{s.path.updatePathSize(dw,dh*-1);s.path.updatePathPosition(0,dh)}}break;case"s":if(canResize("s")){var dh=(ly-my)*-1;if(_UI.eventhandlers.temppathdragshape){updateTPDS(0,0,0,dh)}else{s.path.updatePathSize(0,dh*-1);s.path.updatePathPosition(0,dh)}}break;case"sw":if(canResize("sw")){var dw=mx-lx;var dh=(ly-my)*-1;if(_UI.eventhandlers.temppathdragshape){updateTPDS(dw,0,dw*-1,dh)}else{s.path.updatePathSize(dw*-1,dh*-1);s.path.updatePathPosition(dw,dh)}}break;case"w":if(canResize("w")){var dw=mx-lx;if(_UI.eventhandlers.temppathdragshape){updateTPDS(dw,0,dw*-1,0)}else{s.path.updatePathSize(dw*-1,0);s.path.updatePathPosition(dw,0)}}break}}function updateTPDS(dx,dy,dw,dh){_UI.eventhandlers.temppathdragshape.leftx+=Math.round(dx);_UI.eventhandlers.temppathdragshape.topy+=Math.round(dy);_UI.eventhandlers.temppathdragshape.rightx+=Math.round(dw+dx);_UI.eventhandlers.temppathdragshape.bottomy+=Math.round(dh+dy)}function canResize(pc){var s=ss("canResize");switch(pc){case"nw":return!s.ylock&&!s.hlock&&!s.xlock&&!s.wlock;case"n":return!s.ylock&&!s.hlock;case"ne":return!s.ylock&&!s.hlock&&!s.wlock;case"e":return!s.wlock;case"se":return!s.hlock&&!s.wlock;case"s":return!s.hlock;case"sw":return!s.hlock&&!s.xlock&&!s.wlock;case"w":return!s.xlock&&!s.wlock}return true}function mousewheel(event){var delta=event.detail?event.detail*-120:event.wheelDelta;var canscroll=_UI.navhere=="character edit"||_UI.navhere=="linked shapes";canscroll=canscroll&&document.getElementById("dialog_box").style.display!="block";if(canscroll){if(delta>0){viewZoom(1.1)}else{viewZoom(.9)}}}function mouseovercec(){_UI.eventhandlers.ismouseovercec=true;document.onselectstart=function(){return false}}function mouseoutcec(){_UI.eventhandlers.ismouseovercec=false;document.onselectstart=function(){};resetCursor()}function keydown(event){if(event.keyCode==32&&_UI.eventhandlers.ismouseovercec){if(!_UI.eventhandlers.iskeydown){_UI.eventhandlers.lastTool=_UI.selectedtool;_UI.selectedtool="pan";_UI.eventhandlers.iskeydown=true;document.body.style.cursor="move";redraw("Event Handler - Keydown Spacebar for pan toggle")}}}function keyup(event){if(event.keyCode==32&&_UI.eventhandlers.ismouseovercec){_UI.selectedtool=_UI.eventhandlers.lastTool;_UI.eventhandlers.iskeydown=false;resetCursor();redraw("Event Handler - Keyup Spacebar for pan toggle")}}function keypress(event){}function triggerProjectFileDownload(){var jsonString=JSON.stringify(_GP,undefined,"	");jsonString=jsonString.replace(/\n/g,"\r\n");var fblob=new Blob([jsonString],{type:"text/plain;charset=utf-8",endings:"native"});var fname=_GP.projectsettings.name+" - Glyphr Project - "+genDateStampSuffix()+".txt";try{window.navigator.msSaveBlob(fblob,fname)}catch(err){var link=document.createElement("a");link.href=window.URL.createObjectURL(fblob);link.download=fname;var event=document.createEvent("MouseEvents");event.initEvent("click",true,false);link.dispatchEvent(event)}setProjectAsSaved()}function genDateStampSuffix(){var d=new Date;var yr=d.getFullYear();var mo=d.getMonth()+1;var day=d.getDate();var hr=d.getHours();var min=(d.getMinutes()<10?"0":"")+d.getMinutes();var sec=(d.getSeconds()<10?"0":"")+d.getSeconds();return""+yr+"."+mo+"."+day+"-"+hr+"."+min+"."+sec}function triggerTTXFileDownload(){var ttxstring=generateTTXXML();ttxstring=ttxstring.replace(/\n/g,"\r\n");var blob=new Blob([ttxstring],{type:"text/plain;charset=utf-8"});var link=document.createElement("a");link.href=window.URL.createObjectURL(blob);link.download="TTX Data - "+_GP.projectsettings.name+" - "+genDateStampSuffix()+".ttx";link.click()}function generateTTXXML(){var maxes=calcFontMaxes();var con='<?xml version="1.0" encoding="ISO-8859-1"?>\n';con+='<ttFont sfntVersion="OTTO" ttLibVersion="2.3">\n\n';con+=genTable_glyphorder({});con+=genTable_head({});con+=genTable_hhea(maxes);con+=genTable_maxp({});con+=genTable_os_2(maxes);con+=genTable_name({});con+=genTable_cmap({});con+=genTable_post({});con+=genTable_cff({});con+=genTable_hmtx({});con+="</ttFont>";return con}function calcFontMaxes(){var fm=_UI.fontmetrics;var cm={};for(var c=0;c<_GP.fontchars.length;c++){if(_GP.fontchars[c]&&_GP.fontchars[c].charshapes){cm=_GP.fontchars[c].calcCharMaxes();fm.xmax=Math.max(cm.xmax,fm.xmax);fm.xmin=Math.min(cm.xmin,fm.xmin);fm.ymax=Math.max(cm.ymax,fm.ymax);fm.ymin=Math.min(cm.ymin,fm.ymin)}}var proportion=fm.ymax/(fm.ymax-fm.ymin);var total=fm.ymax+Math.abs(fm.ymin)+_GP.projectsettings.linegap;fm.hhea_ascent=Math.round(total*proportion);fm.hhea_descent=fm.hhea_ascent-total;debug("CALCFONTMAXES - returns "+JSON.stringify(fm))}function genTable_glyphorder(oa){var con="<GlyphOrder>\n";con+='	<GlyphID name=".notdef"/>\n';var count=0;for(var tc=32;tc<_GP.fontchars.length;tc++){con+='	<GlyphID name="'+_GP.fontchars[tc].charname+'"/>\n';count++}con+="</GlyphOrder>\n\n";return con}function genTable_head(oa){var con="<head>\n";con+='	<tableVersion value="1.0"/>\n';con+='	<fontRevision value="'+getOTprop("head","fontRevision")+'"/>\n';con+='	<checkSumAdjustment value="0xfd4639aa"/>\n';con+='	<magicNumber value="0x5f0f3cf5"/>\n';con+='	<flags value="00000000 00000011"/>\n';con+='	<unitsPerEm value="'+_GP.projectsettings.upm+'"/>\n';con+='	<created value="'+getOTprop("head","created")+'"/>\n';con+='	<modified value="'+ttxDateString()+'"/>\n';con+='	<xMin value="-100"/>\n';con+='	<yMin value="-100"/>\n';con+='	<xMax value="4048"/>\n';con+='	<yMax value="4048"/>\n';con+='	<macStyle value="00000000 00000000"/>\n';con+='	<lowestRecPPEM value="3"/>\n';con+='	<fontDirectionHint value="2"/>\n';con+='	<indexToLocFormat value="0"/>\n';con+='	<glyphDataFormat value="0"/>\n';con+="</head>\n\n";return con}function ttxDateString(){var d=new Date;var t=d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();d=d.toDateString().split(" ");d.splice(3,0,t);var re=d.join(" ");return re}function genTable_hhea(oa){var fm=_UI.fontmetrics;var con="<hhea>\n";con+='	<tableVersion value="1.0"/>\n';con+='	<ascent value="'+fm.hhea_ascent+'"/>\n';con+='	<descent value="'+fm.hhea_descent+'"/>\n';con+='	<lineGap value="0"/>\n';con+='	<advanceWidthMax value="1000"/>\n';con+='	<minLeftSideBearing value="'+fm.xmin+'"/>\n';con+='	<minRightSideBearing value="0"/>\n';con+='	<xMaxExtent value="1000"/>\n';con+='	<caretSlopeRise value="1"/>\n';con+='	<caretSlopeRun value="0"/>\n';con+='	<caretOffset value="0"/>\n';con+='	<reserved0 value="0"/>\n';con+='	<reserved1 value="0"/>\n';con+='	<reserved2 value="0"/>\n';con+='	<reserved3 value="0"/>\n';con+='	<metricDataFormat value="0"/>\n';con+='	<numberOfHMetrics value="95"/>\n';con+="</hhea>\n\n";return con}function genTable_maxp(oa){var con="<maxp>\n";con+='	<tableVersion value="0x5000"/>\n';con+='	<numGlyphs value="95"/>\n';con+="</maxp>\n\n";return con}function genTable_os_2(oa){var gp=_GP.projectsettings;var fm=_UI.fontmetrics;var con="<OS_2>\n";con+='	<version value="3"/>\n';con+='	<xAvgCharWidth value="2100"/>\n';con+='	<usWeightClass value="'+getOTprop("os_2","usWeightClass")+'"/>\n';con+='	<usWidthClass value="'+getOTprop("os_2","usWidthClass")+'"/>\n';con+='	<fsType value="00000000 00001000"/>\n';con+='	<ySubscriptXSize value="650"/>\n';con+='	<ySubscriptYSize value="600"/>\n';con+='	<ySubscriptXOffset value="0"/>\n';con+='	<ySubscriptYOffset value="75"/>\n';con+='	<ySuperscriptXSize value="650"/>\n';con+='	<ySuperscriptYSize value="600"/>\n';con+='	<ySuperscriptXOffset value="0"/>\n';con+='	<ySuperscriptYOffset value="350"/>\n';con+='	<yStrikeoutSize value="50"/>\n';con+='	<yStrikeoutPosition value="384"/>\n';con+='	<sFamilyClass value="0"/>\n';con+="	<panose>\n";con+='		<bFamilyType value="2"/>\n';con+='		<bSerifStyle value="0"/>\n';con+='		<bWeight value="0"/>\n';con+='		<bProportion value="0"/>\n';con+='		<bContrast value="0"/>\n';con+='		<bStrokeVariation value="0"/>\n';con+='		<bArmStyle value="0"/>\n';con+='		<bLetterForm value="0"/>\n';con+='		<bMidline value="0"/>\n';con+='		<bXHeight value="0"/>\n';con+="	</panose>\n";con+='	<ulUnicodeRange1 value="00000000 00000000 00000000 00000001"/>\n';con+='	<ulUnicodeRange2 value="00000000 00000000 00000000 00000000"/>\n';con+='	<ulUnicodeRange3 value="00000000 00000000 00000000 00000000"/>\n';con+='	<ulUnicodeRange4 value="00000000 00000000 00000000 00000000"/>\n';con+='	<achVendID value=""/>\n';con+='	<fsSelection value="00000000 00000000"/>\n';con+='	<fsFirstCharIndex value="32"/>\n';con+='	<fsLastCharIndex value="64258"/>\n';con+='	<sTypoAscender value="'+gp.ascent+'"/>\n';con+='	<sTypoDescender value="'+(gp.ascent-gp.upm)+'"/>\n';con+='	<sTypoLineGap value="'+gp.linegap+'"/>\n';con+='	<usWinAscent value="'+fm.hhea_ascent+'"/>\n';con+='	<usWinDescent value="'+Math.abs(fm.hhea_descent)+'"/>\n';con+='	<ulCodePageRange1 value="00100000 00000000 00000000 00000001"/>\n';con+='	<ulCodePageRange2 value="00000000 00000000 00000000 00000000"/>\n';con+='	<sxHeight value="'+gp.xheight+'"/>\n';con+='	<sCapHeight value="'+gp.ascent+'"/>\n';con+='	<usDefaultChar value="0"/>\n';con+='	<usBreakChar value="32"/>\n';con+='	<usMaxContex value="4"/>\n';con+="</OS_2>\n\n";return con}function genTable_name(oa){var otsn=_GP.opentypeproperties.name;var con="<name>\n";con+='	<namerecord nameID="0" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[0].val+"\n	</namerecord>\n";con+='	<namerecord nameID="1" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[1].val+"\n	</namerecord>\n";con+='	<namerecord nameID="2" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[2].val+"\n	</namerecord>\n";con+='	<namerecord nameID="3" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[3].val+"\n	</namerecord>\n";con+='	<namerecord nameID="4" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[4].val+"\n	</namerecord>\n";con+='	<namerecord nameID="5" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[5].val+"\n	</namerecord>\n";con+='	<namerecord nameID="6" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[6].val+"\n	</namerecord>\n";con+='	<namerecord nameID="8" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[8].val+"\n	</namerecord>\n";con+='	<namerecord nameID="9" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[9].val+"\n	</namerecord>\n";con+='	<namerecord nameID="10" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[10].val+"\n	</namerecord>\n";con+='	<namerecord nameID="11" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[11].val+"\n	</namerecord>\n";con+='	<namerecord nameID="12" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[12].val+"\n	</namerecord>\n";con+='	<namerecord nameID="13" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[13].val+"\n	</namerecord>\n";con+='	<namerecord nameID="14" platformID="1" platEncID="0" langID="0x0">\n		'+otsn[14].val+"\n	</namerecord>\n";con+='	<namerecord nameID="0" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[0].val+"\n	</namerecord>\n";con+='	<namerecord nameID="1" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[1].val+"\n	</namerecord>\n";con+='	<namerecord nameID="2" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[2].val+"\n	</namerecord>\n";con+='	<namerecord nameID="3" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[3].val+"\n	</namerecord>\n";con+='	<namerecord nameID="4" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[4].val+"\n	</namerecord>\n";con+='	<namerecord nameID="5" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[5].val+"\n	</namerecord>\n";con+='	<namerecord nameID="6" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[6].val+"\n	</namerecord>\n";con+='	<namerecord nameID="8" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[8].val+"\n	</namerecord>\n";con+='	<namerecord nameID="9" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[9].val+"\n	</namerecord>\n";con+='	<namerecord nameID="10" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[10].val+"\n	</namerecord>\n";con+='	<namerecord nameID="11" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[11].val+"\n	</namerecord>\n";con+='	<namerecord nameID="12" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[12].val+"\n	</namerecord>\n";con+='	<namerecord nameID="13" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[13].val+"\n	</namerecord>\n";con+='	<namerecord nameID="14" platformID="3" platEncID="1" langID="0x409">\n		'+otsn[14].val+"\n	</namerecord>\n";con+="</name>\n\n";return con}function genTable_cmap(oa){var cmapbody="";for(var tc=32;tc<_GP.fontchars.length;tc++){cmapbody+='		<map code="'+_GP.fontchars[tc].cmapcode+'" name="'+_GP.fontchars[tc].charname+'"/>\n'}var con="<cmap>\n";con+='<tableVersion version="0"/>\n';con+='	<cmap_format_4 platformID="0" platEncID="3" language="0">\n';con+=cmapbody;con+="	</cmap_format_4>\n";con+='	<cmap_format_6 platformID="1" platEncID="0" language="0">\n';con+=cmapbody;con+="	</cmap_format_6>\n";con+='	<cmap_format_4 platformID="3" platEncID="1" language="0">\n';con+=cmapbody;con+="	</cmap_format_4>\n";con+="</cmap>\n\n";return con}function genTable_post(oa){var con="<post>\n";con+='	<formatType value="3.0"/>\n';con+='	<italicAngle value="'+getOTprop("post","italicAngle")+'"/>\n';con+='	<underlinePosition value="'+getOTprop("post","underlinePosition")+'"/>\n';con+='	<underlineThickness value="'+getOTprop("post","underlineThickness")+'"/>\n';con+='	<isFixedPitch value="0"/>\n';con+='	<minMemType42 value="0"/>\n';con+='	<maxMemType42 value="0"/>\n';con+='	<minMemType1 value="0"/>\n';con+='	<maxMemType1 value="0"/>\n';con+="</post>\n\n";return con}function genTable_cff(oa){var md=_GP.opentypeproperties;var con="<CFF>\n";con+='	<CFFFont name="'+md.name[1].val+'">\n';con+='		<version value="002.000"/>\n';con+='		<Notice value="'+getOTprop("cff","Notice")+'"/>\n';con+='		<FullName value="'+getOTprop("cff","FullName")+'"/>\n';con+='		<FamilyName value="'+getOTprop("cff","FamilyName")+'"/>\n';con+='		<Weight value="'+getOTprop("cff","Weight")+'"/>\n';con+='		<isFixedPitch value="0"/>\n';con+='		<ItalicAngle value="0"/>\n';con+='		<UnderlineThickness value="50"/>\n';con+='		<PaintType value="0"/>\n';con+='		<CharstringType value="2"/>\n';con+='		<FontMatrix value="0.001 0 0 0.001 0 0"/>\n';con+='		<FontBBox value="0 0 0 0"/>\n';con+='		<StrokeWidth value="0"/>\n';con+='		<Encoding name="StandardEncoding"/>\n';con+="		<Private>\n";con+="		</Private>\n";con+="		<CharStrings>\n";con+=genCharStringsPostScript();con+="		</CharStrings>\n";con+="	</CFFFont>\n";con+="</CFF>\n\n";return con}function genCharStringsPostScript(){var con='			<CharString name=".notdef">\n				endchar\n			</CharString>\n';var lastx,lasty;for(var tc=32;tc<_GP.fontchars.length;tc++){con+='			<CharString name="'+_GP.fontchars[tc].charname+'">\n';lastx=0;lasty=0;rvar={};for(var ts=0;ts<_GP.fontchars[tc].charshapes.length;ts++){rvar=_GP.fontchars[tc].charshapes[ts].genPostScript(lastx,lasty);con+=rvar.re;lastx=rvar.lastx;lasty=rvar.lasty}con+="				endchar\n";con+="			</CharString>\n"}return con}function genTable_hmtx(oa){var con="<hmtx>\n";con+='	<mtx name=".notdef" width="2100" lsb="0"/>\n';var lsb,curr;for(var tc=32;tc<_GP.fontchars.length;tc++){curr=_GP.fontchars[tc];lsb=curr.leftsidebearing===false?_GP.projectsettings.defaultlsb:curr.leftsidebearing;con+='	<mtx name="'+curr.charname+'" width="'+(lsb+curr.charwidth)+'" lsb="'+lsb+'"/>\n'}con+="</hmtx>\n\n";return con}
	</script>	
</head>
<body onload="setup();">
<div id="mainwrapper"><div id="mainpane">
	<div style="margin:70px; font-size:20px;">
		<h2>Wah wah.</h2><br/>
		It looks like there was a JavaScript error.<br/> If, by chance, there was a dialog box with some error text,<br/> please <a style="font-size:20px;" href="mailto:mail@glyphrstudio.com&subject=Issue%20Report%20-%20Breaking%20JavaScript%20Error">send an issue report to the Glyphr team</a>.<br/>
	</div>
</div></div>
<div id="navprimarypane" onMouseOver="mouseoutcec();"></div>
<div id="navtargetpane" onMouseOver="mouseoutcec();"></div>
<div id="dialog_box">
<table cellpadding=0 cellspacing=0 border=0><tr>
	<td id='dialogLeftBar'><input type='button' class='dialogCloseButton' value='&times;' onclick='closeDialog();'></td>
	<td id='dialogRightContent'></td>
</tr></table></div>
<div id="dialog_bg" onclick="closeDialog();"></div>
<canvas id="logocanvas" height="60" width="190"><h3>Hey there!</h3>You'll need a modern browser that supports HTML5 in order for this to work.</canvas>
<canvas id="ishereghostcanvas" height=10 width=10 ></canvas>
</body>
</html>